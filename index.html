<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BreatheFreely ‚Äî Your Quit Vaping Journey</title>

<!-- Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="./favicon.png">
<link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">

<!-- PWA -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#db2777">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="BreatheFreely">
<link rel="apple-touch-icon" href="./icon-192.png">

<!-- Open Graph for sharing -->
<meta property="og:title" content="BreatheFreely ‚Äî Quit Vaping Journey">
<meta property="og:description" content="A free, science-backed app to help you quit vaping gradually ‚Äî with anxiety support, craving tools, and daily tracking.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://mariajose-rgb.github.io/breathefreely/">
<meta property="og:image" content="https://mariajose-rgb.github.io/breathefreely/icon-512.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap');

  :root {
    --bg: #faf9f7;
    --surface: #ffffff;
    --surface2: #f3f1ee;
    --surface3: #ebe8e3;
    --accent: #db2777;
    --accent2: #ec4899;
    --accent-light: #fce7f3;
    --accent-glow: rgba(219,39,119,0.15);
    --green: #16a34a;
    --green-light: #dcfce7;
    --green-bg: #f0fdf4;
    --orange: #d97706;
    --orange-light: #fef3c7;
    --red: #dc2626;
    --red-light: #fee2e2;
    --teal: #0d9488;
    --teal-light: #ccfbf1;
    --pink: #db2777;
    --pink-light: #fce7f3;
    --text: #1e1b2e;
    --text-mid: #4a4560;
    --text-dim: #8c87a0;
    --border: #e8e5df;
    --radius: 16px;
    --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04);
    --shadow-lg: 0 4px 20px rgba(0,0,0,0.08);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  .app { max-width: 900px; margin: 0 auto; padding: 20px; }

  /* Header */
  .header {
    text-align: center;
    padding: 50px 20px 20px;
  }
  .header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2.8em;
    background: linear-gradient(135deg, var(--accent), var(--teal));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 8px;
  }
  .header p {
    color: var(--text-dim);
    font-size: 1.1em;
    font-weight: 300;
  }

  /* Motivational banner */
  .motiv-banner {
    background: linear-gradient(135deg, var(--accent), #f472b6, var(--teal));
    border-radius: var(--radius);
    padding: 24px 28px;
    margin: 20px 0;
    color: white;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
  }
  .motiv-banner::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle at 30% 50%, rgba(255,255,255,0.1) 0%, transparent 50%);
  }
  .motiv-banner .motiv-text {
    position: relative;
    font-size: 1.15em;
    font-weight: 500;
    line-height: 1.6;
  }
  .motiv-banner .motiv-text strong {
    font-weight: 700;
    text-decoration: underline;
    text-decoration-color: rgba(255,255,255,0.4);
    text-underline-offset: 3px;
  }
  .motiv-sub {
    position: relative;
    font-size: 0.85em;
    opacity: 0.85;
    margin-top: 8px;
  }

  /* Stats bar */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin: 20px 0;
  }
  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px 16px;
    text-align: center;
    transition: all 0.3s;
    box-shadow: var(--shadow);
  }
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
  .stat-number {
    font-size: 2em;
    font-weight: 800;
    color: var(--text);
    line-height: 1;
  }
  .stat-label {
    font-size: 0.7em;
    color: var(--text-dim);
    margin-top: 6px;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
  }
  .stat-card.highlight .stat-number { color: var(--green); }
  .stat-card.accent .stat-number { color: var(--accent); }
  .stat-card.teal .stat-number { color: var(--teal); }

  /* Navigation tabs */
  .nav-tabs {
    display: flex;
    gap: 4px;
    margin: 20px 0;
    background: var(--surface2);
    border-radius: 14px;
    padding: 5px;
    overflow-x: auto;
  }
  .nav-tab {
    flex: 1;
    padding: 12px 8px;
    border: none;
    background: none;
    color: var(--text-dim);
    font-family: 'Inter', sans-serif;
    font-size: 0.82em;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
  }
  .nav-tab:hover { color: var(--text); background: rgba(255,255,255,0.6); }
  .nav-tab.active {
    background: var(--surface);
    color: var(--accent);
    box-shadow: var(--shadow);
  }

  /* Panels */
  .panel { display: none; animation: fadeIn 0.4s ease; }
  .panel.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }

  /* Cards */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 28px;
    margin-bottom: 16px;
    box-shadow: var(--shadow);
  }
  .card h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.4em;
    color: var(--text);
    margin-bottom: 14px;
  }
  .card h3 {
    font-size: 1em;
    color: var(--accent);
    margin: 18px 0 10px;
    font-weight: 700;
  }
  .card p, .card li {
    color: var(--text-mid);
    line-height: 1.75;
    font-size: 0.95em;
  }
  .card ul { padding-left: 20px; }
  .card li { margin-bottom: 6px; }
  .card .callout {
    background: var(--green-bg);
    border-left: 4px solid var(--green);
    border-radius: 0 12px 12px 0;
    padding: 16px 20px;
    margin: 16px 0;
    color: #15803d;
    font-weight: 500;
    font-size: 0.95em;
    line-height: 1.6;
  }
  .card .callout-accent {
    background: var(--accent-light);
    border-left: 4px solid var(--accent);
    border-radius: 0 12px 12px 0;
    padding: 16px 20px;
    margin: 16px 0;
    color: #9d174d;
    font-weight: 500;
    font-size: 0.95em;
    line-height: 1.6;
  }

  /* Checkin items */
  .checkin-grid { display: grid; gap: 10px; margin-top: 14px; }
  .checkin-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 18px;
    background: var(--surface2);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    border: 2px solid transparent;
    user-select: none;
  }
  .checkin-item:hover { border-color: var(--accent-light); background: #fdf2f8; }
  .checkin-item.checked {
    border-color: var(--green);
    background: var(--green-bg);
  }
  .check-circle {
    width: 26px; height: 26px;
    border-radius: 50%;
    border: 2px solid var(--text-dim);
    display: flex; align-items: center; justify-content: center;
    transition: all 0.3s;
    flex-shrink: 0;
  }
  .checkin-item.checked .check-circle {
    background: var(--green);
    border-color: var(--green);
  }
  .check-circle svg { opacity: 0; transition: 0.3s; }
  .checkin-item.checked .check-circle svg { opacity: 1; }
  .checkin-text { font-weight: 500; color: var(--text); font-size: 0.92em; }
  .checkin-item.checked .checkin-text { color: var(--green); }

  /* Sliders */
  .slider-group { margin: 18px 0; }
  .slider-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9em;
  }
  .slider-label span:first-child { color: var(--text); font-weight: 600; }
  .slider-label span:last-child { color: var(--accent); font-weight: 800; font-size: 1.2em; }
  input[type="range"] {
    width: 100%;
    -webkit-appearance: none;
    height: 8px;
    border-radius: 4px;
    background: var(--surface3);
    outline: none;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px; height: 24px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 2px 8px var(--accent-glow);
  }

  /* Buttons */
  .btn-primary {
    padding: 12px 28px;
    background: var(--accent);
    border: none;
    border-radius: 10px;
    color: white;
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: 0.95em;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 2px 12px var(--accent-glow);
  }
  .btn-primary:hover { background: var(--accent2); transform: translateY(-1px); }
  .btn-full { width: 100%; margin-top: 16px; }

  /* Breathing */
  .breath-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
  }
  .breath-circle-outer {
    width: 220px; height: 220px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    background: conic-gradient(from 0deg, var(--accent), var(--teal), var(--accent2), var(--accent));
    padding: 4px;
    transition: transform 4s ease-in-out, box-shadow 4s ease-in-out;
  }
  .breath-circle-outer.inhale {
    transform: scale(1.3);
    box-shadow: 0 0 40px var(--accent-glow), 0 0 80px rgba(219,39,119,0.15);
  }
  .breath-circle-outer.exhale {
    transform: scale(0.85);
    box-shadow: 0 0 10px var(--accent-glow);
  }
  .breath-circle-outer.hold-in {
    transform: scale(1.3);
    animation: holdThrob 1s ease-in-out infinite;
  }
  .breath-circle-outer.hold-out {
    transform: scale(0.85);
    animation: holdThrob 1s ease-in-out infinite;
  }
  @keyframes holdThrob {
    0%, 100% { box-shadow: 0 0 15px var(--accent-glow); }
    50% { box-shadow: 0 0 35px var(--accent-glow), 0 0 60px rgba(219,39,119,0.2); }
  }
  .breath-circle {
    width: 100%; height: 100%;
    border-radius: 50%;
    background: var(--bg);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
  }
  .breath-text {
    font-size: 1.3em; font-weight: 700; color: var(--text);
    animation: none;
  }
  .breath-text.pulsing { animation: textPulse 1s ease-in-out infinite; }
  @keyframes textPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(0.95); }
  }
  .breath-timer { font-size: 2.5em; font-weight: 800; color: var(--accent); margin-top: 4px; }
  .breath-btn {
    margin-top: 30px;
    padding: 14px 44px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 50px;
    color: white;
    font-family: 'Inter', sans-serif;
    font-size: 1em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 20px var(--accent-glow);
  }
  .breath-btn:hover { transform: scale(1.05); }
  .breath-rounds { margin-top: 16px; color: var(--text-dim); font-size: 0.9em; }

  /* SOS */
  .sos-btn {
    width: 100%;
    padding: 22px;
    background: linear-gradient(135deg, #dc2626, #e11d48, #be123c);
    border: none;
    border-radius: var(--radius);
    color: white;
    font-family: 'Inter', sans-serif;
    font-size: 1.15em;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 20px rgba(220,38,38,0.25);
    margin-bottom: 16px;
    letter-spacing: 0.5px;
  }
  .sos-btn:hover { transform: scale(1.02); box-shadow: 0 6px 30px rgba(220,38,38,0.35); }
  .sos-btn:active { transform: scale(0.98); }
  .sos-tips { display: none; animation: fadeIn 0.5s ease; }
  .sos-tips.visible { display: block; }
  .sos-tip {
    background: var(--surface2);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 10px;
    display: flex;
    align-items: flex-start;
    gap: 14px;
    border: 1px solid var(--border);
  }
  .sos-tip .icon { font-size: 1.5em; flex-shrink: 0; }
  .sos-tip h4 { color: var(--text); font-size: 0.95em; margin-bottom: 4px; }
  .sos-tip p { color: var(--text-mid); font-size: 0.85em; line-height: 1.6; }

  /* Week calendar */
  .week-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
    margin: 14px 0;
  }
  .week-day {
    aspect-ratio: 1;
    border-radius: 12px;
    background: var(--surface2);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    transition: all 0.3s;
    cursor: pointer;
    border: 2px solid transparent;
  }
  .week-day .day-name { color: var(--text-dim); font-size: 0.7em; font-weight: 700; text-transform: uppercase; }
  .week-day .day-num { color: var(--text); font-weight: 800; font-size: 1.2em; margin-top: 2px; }
  .week-day.today { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-light); }
  .week-day.logged { background: var(--green-light); border-color: var(--green); }
  .week-day.logged .day-num { color: var(--green); }

  /* Toolkit cards */
  .toolkit-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 22px;
    margin-bottom: 12px;
    border-left: 4px solid var(--accent);
    transition: all 0.3s;
    box-shadow: var(--shadow);
  }
  .toolkit-card:hover { border-left-color: var(--teal); transform: translateX(3px); box-shadow: var(--shadow-lg); }
  .toolkit-card h4 { color: var(--text); margin-bottom: 8px; font-size: 1em; }
  .toolkit-card p { font-size: 0.9em; color: var(--text-mid); line-height: 1.7; }
  .tag {
    display: inline-block;
    padding: 3px 12px;
    border-radius: 20px;
    font-size: 0.72em;
    font-weight: 700;
    margin-top: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .tag-purple { background: var(--accent-light); color: var(--accent); }
  .tag-green { background: var(--green-light); color: var(--green); }
  .tag-teal { background: var(--teal-light); color: var(--teal); }
  .tag-orange { background: var(--orange-light); color: var(--orange); }
  .tag-pink { background: var(--pink-light); color: var(--pink); }

  /* Habit replacement grid */
  .habit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 12px;
    margin-top: 14px;
  }
  .habit-card {
    background: var(--surface2);
    border-radius: 14px;
    padding: 20px;
    border: 1px solid var(--border);
    transition: all 0.3s;
  }
  .habit-card:hover { background: white; box-shadow: var(--shadow-lg); transform: translateY(-2px); }
  .habit-card .habit-icon { font-size: 2em; margin-bottom: 10px; }
  .habit-card h4 { color: var(--text); font-size: 0.95em; margin-bottom: 6px; }
  .habit-card p { color: var(--text-mid); font-size: 0.82em; line-height: 1.6; }
  .habit-card .habit-when {
    margin-top: 10px;
    font-size: 0.75em;
    font-weight: 700;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Milestones */
  .milestone {
    display: flex; align-items: center; gap: 16px;
    padding: 16px;
    background: var(--surface2);
    border-radius: 12px;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
    border: 1px solid var(--border);
  }
  .milestone-bar {
    position: absolute;
    left: 0; top: 0; bottom: 0;
    background: linear-gradient(90deg, var(--green-light), transparent);
    transition: width 1s ease;
  }
  .milestone-icon { font-size: 1.8em; z-index: 1; }
  .milestone-info { z-index: 1; flex: 1; }
  .milestone-info h4 { font-size: 0.9em; color: var(--text); margin-bottom: 2px; }
  .milestone-info p { font-size: 0.8em; color: var(--text-dim); }
  .milestone-time { z-index: 1; font-size: 0.75em; color: var(--green); font-weight: 700; text-align: right; }

  /* Timeline */
  .timeline { margin-top: 16px; }
  .timeline-item { display: flex; gap: 16px; padding-bottom: 24px; position: relative; }
  .timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 15px; top: 36px; bottom: 0;
    width: 2px;
    background: var(--surface3);
  }
  .timeline-item.completed:not(:last-child)::after { background: var(--green); }
  .timeline-dot {
    width: 32px; height: 32px;
    border-radius: 50%;
    background: var(--surface2);
    border: 2px solid var(--text-dim);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    font-size: 0.8em;
    font-weight: 700;
  }
  .timeline-item.completed .timeline-dot { background: var(--green); border-color: var(--green); color: white; }
  .timeline-item.current .timeline-dot {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
    box-shadow: 0 0 0 4px var(--accent-light);
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%,100% { box-shadow: 0 0 0 4px var(--accent-light); }
    50% { box-shadow: 0 0 0 8px rgba(219,39,119,0.1); }
  }
  .timeline-content h4 { color: var(--text); font-size: 0.95em; margin-bottom: 4px; }
  .timeline-content p { font-size: 0.85em; color: var(--text-dim); }

  /* Journal */
  .journal-input {
    width: 100%;
    min-height: 120px;
    background: var(--surface2);
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 16px;
    color: var(--text);
    font-family: 'Inter', sans-serif;
    font-size: 0.95em;
    resize: vertical;
    outline: none;
    transition: border-color 0.3s;
  }
  .journal-input:focus { border-color: var(--accent); }
  .journal-input::placeholder { color: var(--text-dim); }
  .journal-entries { margin-top: 20px; }
  .journal-entry {
    background: var(--surface2);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 10px;
    border-left: 4px solid var(--accent);
  }
  .journal-entry .date { font-size: 0.75em; color: var(--accent); margin-bottom: 6px; font-weight: 700; }
  .journal-entry .text { color: var(--text-mid); font-size: 0.9em; line-height: 1.6; white-space: pre-wrap; }

  /* Schedule table */
  .schedule-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 6px;
    margin: 12px 0;
  }
  .schedule-table th {
    text-align: left;
    padding: 10px 14px;
    font-size: 0.72em;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
  }
  .schedule-table td {
    padding: 14px;
    background: var(--surface2);
    font-size: 0.9em;
    color: var(--text);
  }
  .schedule-table tr td:first-child { border-radius: 10px 0 0 10px; font-weight: 700; color: var(--accent); }
  .schedule-table tr td:last-child { border-radius: 0 10px 10px 0; }

  .badge {
    display: inline-block;
    padding: 3px 12px;
    border-radius: 20px;
    font-size: 0.72em;
    font-weight: 700;
  }
  .badge-green { background: var(--green-light); color: var(--green); }
  .badge-orange { background: var(--orange-light); color: var(--orange); }
  .badge-purple { background: var(--accent-light); color: var(--accent); }
  .badge-teal { background: var(--teal-light); color: var(--teal); }

  /* Puff counter */
  .puff-counter {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    padding: 20px;
    background: var(--surface2);
    border-radius: 14px;
    margin: 16px 0;
    border: 1px solid var(--border);
  }
  .puff-counter button {
    width: 50px; height: 50px;
    border-radius: 50%;
    border: 2px solid var(--border);
    background: var(--surface);
    font-size: 1.5em;
    font-weight: 700;
    color: var(--text);
    cursor: pointer;
    transition: all 0.2s;
  }
  .puff-counter button:hover { background: var(--accent-light); border-color: var(--accent); color: var(--accent); }
  .puff-count {
    text-align: center;
  }
  .puff-count .number { font-size: 2.5em; font-weight: 800; color: var(--text); }
  .puff-baseline { font-size: 0.5em; font-weight: 600; color: var(--text-dim); vertical-align: baseline; }
  .puff-count .label { font-size: 0.75em; color: var(--text-dim); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
  .puff-target { text-align: center; margin-top: 8px; font-size: 0.85em; color: var(--text-dim); }
  .puff-target strong { color: var(--accent); }

  /* Quote bar */
  .quote-bar {
    text-align: center;
    padding: 28px 20px;
    font-style: italic;
    color: var(--text-mid);
    font-size: 0.95em;
    border-top: 1px solid var(--border);
    margin-top: 30px;
    line-height: 1.6;
  }
  .quote-bar strong { color: var(--accent); font-style: normal; }

  /* Reset */
  .reset-link {
    display: block;
    text-align: center;
    margin-top: 30px;
    padding: 20px;
    color: var(--text-dim);
    font-size: 0.8em;
    cursor: pointer;
    opacity: 0.4;
    transition: opacity 0.3s;
  }
  .reset-link:hover { opacity: 1; color: var(--red); }

  /* Confetti overlay */
  .confetti-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 999;
  }

  /* Success toast */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--green);
    color: white;
    padding: 14px 28px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 0.95em;
    box-shadow: 0 4px 20px rgba(22,163,74,0.3);
    z-index: 1000;
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
    font-family: 'Inter', sans-serif;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Currency buttons */
  .currency-btn {
    padding: 8px 16px;
    border: 2px solid var(--border);
    border-radius: 8px;
    background: var(--surface2);
    font-family: 'Inter', sans-serif;
    font-size: 0.85em;
    font-weight: 600;
    color: var(--text-mid);
    cursor: pointer;
    transition: all 0.2s;
  }
  .currency-btn:hover { border-color: var(--accent); color: var(--accent); }
  .currency-btn.active { border-color: var(--accent); background: var(--accent-light); color: var(--accent); }

  /* Setback section */
  .setback-toggle label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 0.95em;
    font-weight: 500;
    color: var(--text-mid);
    margin-top: 14px;
  }
  .setback-toggle input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--orange);
    cursor: pointer;
  }
  #setbackNote {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 12px;
    font-family: 'Inter', sans-serif;
    font-size: 0.9em;
    color: var(--text);
    background: var(--surface2);
    resize: vertical;
    outline: none;
    transition: border-color 0.2s;
  }
  #setbackNote:focus { border-color: var(--orange); }
  .setback-affirmation {
    margin-top: 12px;
    padding: 14px 16px;
    background: var(--orange-light);
    border-radius: 10px;
    font-size: 0.88em;
    color: var(--orange);
    font-style: italic;
    font-weight: 500;
    line-height: 1.5;
  }

  /* History & Setback Log */
  .history-entry {
    padding: 14px 16px;
    border-radius: 12px;
    background: var(--surface2);
    margin-bottom: 10px;
    border-left: 3px solid transparent;
    transition: background 0.2s;
  }
  .history-entry.setback-day {
    border-left-color: var(--orange);
    background: #fffbf5;
  }
  .history-date-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    font-size: 0.9em;
    color: var(--text);
    margin-bottom: 8px;
  }
  .setback-badge {
    font-size: 0.72em;
    font-weight: 700;
    background: var(--orange-light);
    color: var(--orange);
    padding: 2px 8px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .history-stats {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .history-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: var(--surface);
    border-radius: 8px;
    padding: 6px 12px;
    min-width: 52px;
  }
  .history-stat .stat-label {
    font-size: 0.72em;
    color: var(--text-dim);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .history-stat .stat-val {
    font-size: 1.05em;
    font-weight: 700;
    color: var(--text);
    margin-top: 2px;
  }
  .history-note {
    margin-top: 8px;
    font-size: 0.85em;
    color: var(--text-mid);
    font-style: italic;
    padding-left: 4px;
  }
  .setback-entry {
    padding: 12px 14px;
    border-radius: 10px;
    background: var(--orange-light);
    margin-bottom: 10px;
  }
  .setback-entry-date {
    font-weight: 600;
    font-size: 0.88em;
    color: var(--orange);
    margin-bottom: 4px;
  }
  .setback-entry-puffs {
    font-size: 0.85em;
    color: var(--text-mid);
  }
  .setback-entry-note {
    margin-top: 6px;
    font-size: 0.85em;
    color: var(--text-mid);
    font-style: italic;
  }
  .history-empty {
    text-align: center;
    color: var(--text-dim);
    padding: 20px;
    font-size: 0.9em;
  }

  /* Responsive */
  @media (max-width: 600px) {
    .stats-bar { grid-template-columns: repeat(2, 1fr); }
    .header h1 { font-size: 2em; }
    .nav-tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .nav-tab { flex: none; padding: 12px 14px; }
    .habit-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="app">
  <div class="header">
    <h1 data-i18n="app.title">BreatheFreely</h1>
    <p data-i18n="app.subtitle">Your personal journey to freedom ‚Äî one breath at a time</p>
  </div>

  <!-- Motivational banner - changes daily -->
  <div class="motiv-banner">
    <div class="motiv-text" id="motivText"></div>
    <div class="motiv-sub" id="motivSub"></div>
  </div>

  <!-- Stats -->
  <div class="stats-bar">
    <div class="stat-card highlight">
      <div class="stat-number" id="daysFree">0</div>
      <div class="stat-label" data-i18n="stat.daysOnPlan">Days on Plan</div>
    </div>
    <div class="stat-card accent">
      <div class="stat-number" id="moneySaved">$0</div>
      <div class="stat-label" data-i18n="stat.moneySaved">Money Saved</div>
    </div>
    <div class="stat-card teal">
      <div class="stat-number" id="cravingsBeaten">0</div>
      <div class="stat-label" data-i18n="stat.cravingsBeaten">Cravings Beaten</div>
    </div>
    <div class="stat-card highlight">
      <div class="stat-number" id="currentPhase">‚Äî</div>
      <div class="stat-label" data-i18n="stat.currentPhase">Current Phase</div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPanel('today',this)" data-i18n="nav.today">Today</button>
    <button class="nav-tab" onclick="showPanel('breathe',this)" data-i18n="nav.breathe">Breathe</button>
    <button class="nav-tab" onclick="showPanel('cravings',this)" data-i18n="nav.cravings">Cravings</button>
    <button class="nav-tab" onclick="showPanel('plan',this)" data-i18n="nav.plan">My Plan</button>
    <button class="nav-tab" onclick="showPanel('social',this)" data-i18n="nav.social">Social Kit</button>
    <button class="nav-tab" onclick="showPanel('journal',this)" data-i18n="nav.journal">Journal</button>
    <button class="nav-tab" onclick="showPanel('progress',this)" data-i18n="nav.progress">Progress</button>
    <button class="nav-tab" onclick="showPanel('settings',this)" data-i18n="nav.settings">Settings</button>
  </div>

  <!-- ====== TODAY ====== -->
  <div class="panel active" id="panel-today">
    <div class="card">
      <h2 data-i18n="today.thisWeek">This Week</h2>
      <div class="week-grid" id="weekGrid"></div>
    </div>

    <div class="card">
      <h2 data-i18n="today.puffTracker">Today's Puff Tracker</h2>
      <p data-i18n="today.puffDesc">Track how many times you vape today. The goal is to gradually reduce this number week by week ‚Äî no pressure, just awareness.</p>
      <div class="puff-counter">
        <button onclick="changePuffs(-1)">-</button>
        <div class="puff-count">
          <div class="number"><span id="puffCount">0</span><span class="puff-baseline" id="puffBaseline"></span></div>
          <div class="label" data-i18n="today.puffsToday">Puffs today</div>
        </div>
        <button onclick="changePuffs(1)">+</button>
      </div>
      <div class="puff-target" id="puffTarget"></div>
    </div>

    <div class="card">
      <h2 data-i18n="today.dailyCheckin">Daily Check-in</h2>
      <div class="slider-group">
        <div class="slider-label">
          <span data-i18n="today.anxietyLevel">Anxiety Level</span>
          <span id="anxietyVal">5</span>
        </div>
        <input type="range" min="1" max="10" value="5" id="anxietySlider" oninput="document.getElementById('anxietyVal').textContent=this.value">
      </div>
      <div class="slider-group">
        <div class="slider-label">
          <span data-i18n="today.cravingIntensity">Craving Intensity</span>
          <span id="cravingVal">5</span>
        </div>
        <input type="range" min="1" max="10" value="5" id="cravingSlider" oninput="document.getElementById('cravingVal').textContent=this.value">
      </div>
      <div class="checkin-grid" id="checkinGrid"></div>
      <button class="btn-primary btn-full" onclick="saveDailyCheckin()" data-i18n="today.saveCheckin">Save Today's Check-in</button>
    </div>

    <div class="card">
      <h2 data-i18n="today.cravingNow">Craving Right Now?</h2>
      <button class="sos-btn" onclick="triggerSOS()" data-i18n="today.sosBtn">SOS ‚Äî I Need Help Right Now</button>
      <div class="sos-tips" id="sosTips">
        <div class="sos-tip">
          <div class="icon">üßä</div>
          <div>
            <h4 data-i18n="sos.ice.title">Ice Cube Trick</h4>
            <p data-i18n="sos.ice.desc">Hold ice in your hand or press it to your neck. The cold activates your dive reflex and drops your heart rate in 30 seconds. Focus entirely on the sensation.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon">ü´Å</div>
          <div>
            <h4 data-i18n="sos.box.title">Box Breathing ‚Äî Do It Now</h4>
            <p data-i18n-html="sos.box.desc">Go to the <strong>Breathe</strong> tab. 4 rounds = 4 minutes. The deep inhale you crave from vaping? You get it here ‚Äî without the nicotine.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon">üö∂</div>
          <div>
            <h4 data-i18n="sos.move.title">Move for 5 Minutes</h4>
            <p data-i18n="sos.move.desc">Walk, stretch, pace ‚Äî anything. Taylor et al. (2007) found brief walking cuts cravings by 50%. Your body needs to burn off the restless energy.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon">‚úä</div>
          <div>
            <h4 data-i18n="sos.squeeze.title">Squeeze Something</h4>
            <p data-i18n="sos.squeeze.desc">Grab a stress ball, rubber band, or just clench your fist hard for 10 seconds then release. This redirects the physical tension your body is feeling.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon">‚è±Ô∏è</div>
          <div>
            <h4 data-i18n="sos.wait.title">Wait 5 Minutes</h4>
            <p data-i18n="sos.wait.desc">"I'll wait just 5 more minutes." Most cravings peak and fade within 3-5 minutes. Set a timer. You'll be surprised how fast it passes.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon">üß†</div>
          <div>
            <h4 data-i18n="sos.reframe.title">Reframe the Thought</h4>
            <p data-i18n="sos.reframe.desc">"I need to vape" ‚Üí "My brain is requesting nicotine. This uncomfortable feeling IS the addiction losing its grip. Each time I resist, it gets weaker. I am winning right now."</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon">üç¨</div>
          <div>
            <h4 data-i18n="sos.oral.title">Oral Substitute ‚Äî Now</h4>
            <p data-i18n="sos.oral.desc">Pop a mint, chew gum, bite a toothpick, eat a crunchy carrot. The oral fixation is real ‚Äî satisfy it without nicotine.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="today.healthTimeline">Health Recovery Timeline</h2>
      <div id="milestones"></div>
    </div>

    <div class="card">
      <h2>üå± Had a Setback?</h2>
      <p style="font-size:0.9em;color:var(--text-mid);margin-bottom:4px">Setbacks are part of recovery ‚Äî not the end of it. Logging them honestly is what change is made of. Your streak stays intact.</p>
      <div class="setback-toggle">
        <label>
          <input type="checkbox" id="setbackToggle" onchange="toggleSetbackForm(this.checked)">
          <span>Log today as a setback</span>
        </label>
      </div>
      <div id="setbackForm" style="display:none;margin-top:16px">
        <textarea id="setbackNote" placeholder="What happened? What triggered it? (optional ‚Äî just for you)" rows="3"></textarea>
        <div class="setback-affirmation" id="setbackAffirmation"></div>
        <button class="btn-primary btn-full" onclick="saveSetback()" style="margin-top:12px">Save</button>
      </div>
    </div>
  </div>

  <!-- ====== BREATHE ====== -->
  <div class="panel" id="panel-breathe">
    <div class="card">
      <h2 data-i18n="breathe.title">Box Breathing Exercise</h2>
      <p data-i18n="breathe.desc">Your body's built-in calm-down switch. Used by Navy SEALs, recommended by anxiety researchers. Do this whenever you'd reach for the vape ‚Äî the deep inhale satisfies the same physical urge.</p>
      <div class="breath-container">
        <div class="breath-circle-outer" id="breathOuter">
          <div class="breath-circle" id="breathCircle">
            <div class="breath-text" id="breathText">Ready</div>
            <div class="breath-timer" id="breathTimer">4:4:4:4</div>
          </div>
        </div>
        <button class="breath-btn" id="breathBtn" onclick="toggleBreathing()" data-i18n="breathe.start">Start Breathing</button>
        <div class="breath-rounds">Round: <strong id="breathRounds">0 / 4</strong></div>
      </div>
    </div>
    <div class="card">
      <h2 data-i18n="breathe.whyTitle">Why This Replaces Vaping</h2>
      <p data-i18n-html="breathe.whyDesc">Here's what most people don't realize: when you vape, the calming effect comes partly from the <strong>breathing pattern itself</strong> ‚Äî slow, deep inhales. Nicotine gets the credit, but your lungs do the real work.</p>
      <div class="callout" data-i18n="breathe.callout">Box breathing gives you the same parasympathetic activation without the 50+ chemicals. After 2-3 weeks of practice, your brain rewires to use this as the default stress response.</div>
      <h3 data-i18n="breathe.science">The Science</h3>
      <ul>
        <li data-i18n="breathe.sci1">Extended exhales stimulate the vagus nerve, lowering heart rate instantly (Gerritsen & Band, 2018)</li>
        <li data-i18n="breathe.sci2">4 rounds reduce cortisol by up to 20% (Ma et al., 2017)</li>
        <li data-i18n="breathe.sci3">Regular practice physically rewires your stress response in 2-3 weeks</li>
        <li data-i18n="breathe.sci4">This is literally what your body was doing when you vaped ‚Äî minus the poison</li>
      </ul>
    </div>
  </div>

  <!-- ====== CRAVINGS & HABITS ====== -->
  <div class="panel" id="panel-cravings">
    <div class="card">
      <h2 data-i18n="cravings.title">Understanding Your Cravings</h2>
      <p data-i18n-html="cravings.desc">A craving is a <strong>wave</strong> ‚Äî it rises, peaks, and falls in 3-5 minutes. You don't need to fight it. You just need to <strong>surf it</strong>. The technique is called "urge surfing" (Marlatt, 1985) and it's one of the most effective tools in addiction research.</p>
      <div class="callout-accent" data-i18n="cravings.callout">Every single craving you ride out without vaping physically weakens the neural pathway. Your brain literally rewires. It's not willpower ‚Äî it's neuroscience.</div>
      <h3 data-i18n="cravings.wave">The Craving Wave</h3>
      <ul>
        <li data-i18n-html="cravings.wave1"><strong>0-1 min:</strong> Trigger hits. You feel the pull. This is the steepest part.</li>
        <li data-i18n-html="cravings.wave2"><strong>1-3 min:</strong> Peak intensity. Your brain is screaming. This is where most people give in.</li>
        <li data-i18n-html="cravings.wave3"><strong>3-5 min:</strong> It starts fading. You made it through the worst.</li>
        <li data-i18n-html="cravings.wave4"><strong>5+ min:</strong> Gone. You won. The neural pathway just got weaker.</li>
      </ul>
    </div>

    <div class="card">
      <h2 data-i18n="cravings.habits">Hand-to-Mouth Habit Replacements</h2>
      <p data-i18n-html="cravings.habitsDesc">Vaping isn't just nicotine ‚Äî it's a <strong>physical habit</strong>. Your hand reaches for it automatically. Here are proven replacements that satisfy the same motor pattern:</p>
      <div class="habit-grid">
        <div class="habit-card">
          <div class="habit-icon">üñäÔ∏è</div>
          <h4 data-i18n="habit.pen.title">Pen / Pencil Fidget</h4>
          <p data-i18n="habit.pen.desc">Keep a pen in your hand. Click it, twirl it, hold it between your fingers like a vape. Same hand movement, zero nicotine.</p>
          <div class="habit-when" data-i18n="habit.pen.when">When: Working, sitting, thinking</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon">üç¨</div>
          <h4 data-i18n="habit.mints.title">Mints & Hard Candy</h4>
          <p data-i18n="habit.mints.desc">Strong mints (Altoids, cinnamon) work best. The intense flavor distracts your brain and satisfies the oral fixation.</p>
          <div class="habit-when" data-i18n="habit.mints.when">When: After meals, social events</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon">ü•ï</div>
          <h4 data-i18n="habit.snacks.title">Crunchy Snacks</h4>
          <p data-i18n="habit.snacks.desc">Carrots, celery, sunflower seeds, apple slices. The chewing and crunching engages your jaw and satisfies the oral need.</p>
          <div class="habit-when" data-i18n="habit.snacks.when">When: At home, watching TV</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon">üí™</div>
          <h4 data-i18n="habit.stress.title">Stress Ball / Grip</h4>
          <p data-i18n="habit.stress.desc">Squeeze a stress ball or hand gripper. Channels the physical tension somewhere productive. Bonus: builds forearm strength.</p>
          <div class="habit-when" data-i18n="habit.stress.when">When: Anxious moments, meetings</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon">üßä</div>
          <h4 data-i18n="habit.water.title">Cold Water Bottle</h4>
          <p data-i18n="habit.water.desc">Sip ice water through a straw. The cold, the sipping motion, and the hand-holding all mimic vaping sensations.</p>
          <div class="habit-when" data-i18n="habit.water.when">When: Driving, desk work</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon">ü™•</div>
          <h4 data-i18n="habit.toothpick.title">Flavored Toothpick</h4>
          <p data-i18n="habit.toothpick.desc">Cinnamon or tea tree toothpicks give you something in your mouth and hands. Many ex-smokers swear by this.</p>
          <div class="habit-when" data-i18n="habit.toothpick.when">When: Social events, bars</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon">üìø</div>
          <h4 data-i18n="habit.fidget.title">Fidget Ring / Worry Stone</h4>
          <p data-i18n="habit.fidget.desc">A spinner ring or smooth stone you roll between your fingers. Keeps your hands busy without thinking about it.</p>
          <div class="habit-when" data-i18n="habit.fidget.when">When: Anywhere, anytime</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon">ü´Å</div>
          <h4 data-i18n="habit.straw.title">Deep Breath Through a Straw</h4>
          <p data-i18n="habit.straw.desc">Inhale slowly through a straw ‚Äî mimics the exact draw sensation of vaping. Exhale slowly through your nose. Repeat 5x.</p>
          <div class="habit-when" data-i18n="habit.straw.when">When: Intense cravings</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="cravings.triggerMap">Trigger Map</h2>
      <p data-i18n="cravings.triggerDesc">Most vaping happens on autopilot. Identify your triggers so you can prepare:</p>
      <div class="checkin-grid" id="triggerChecklist"></div>
      <p style="margin-top:14px;font-size:0.85em;color:var(--text-dim)" data-i18n="cravings.triggerHelp">Check the ones that apply to you. For each trigger you identify, plan a specific replacement action. Writing "When X happens, I will do Y instead" (implementation intentions) doubles your success rate (Gollwitzer, 1999).</p>
    </div>

    <div class="card">
      <h2 data-i18n="cravings.evidenceTitle">Things That Actually Help (Evidence-Based)</h2>
      <ul>
        <li data-i18n-html="cravings.ev1"><strong>Nicotine gum/lozenges (NRT):</strong> Available over the counter. Use for breakthrough cravings, especially in social situations. Clinically proven to improve quit rates by 50-70% (Stead et al., 2012)</li>
        <li data-i18n-html="cravings.ev2"><strong>Exercise:</strong> Even 10 minutes reduces cravings significantly. The endorphins replace the dopamine hit from nicotine</li>
        <li data-i18n-html="cravings.ev3"><strong>Sleep:</strong> Poor sleep increases cravings 40%. Prioritize 7+ hours</li>
        <li data-i18n-html="cravings.ev4"><strong>Water:</strong> Dehydration intensifies cravings. Drink a full glass when a craving hits</li>
        <li data-i18n-html="cravings.ev5"><strong>CBT (therapy):</strong> The gold standard for anxiety + cessation. Many therapists offer it online. This is the single most effective intervention available</li>
      </ul>
    </div>
  </div>

  <!-- ====== PLAN ====== -->
  <div class="panel" id="panel-plan">
    <div class="card">
      <h2 data-i18n="plan.title">Your Frequency Reduction Plan</h2>
      <p data-i18n-html="plan.desc">Since you're using a 5% nicotine vape with no lower option, the strategy shifts to <strong>reducing how often you use it</strong>. This is called "scheduled reduction" and research shows it's effective ‚Äî especially for anxious quitters, because it avoids the shock of going cold turkey (Cinciripini et al., 1995).</p>
      <table class="schedule-table">
        <thead>
          <tr><th data-i18n="plan.weeks">Weeks</th><th data-i18n="plan.goal">Goal</th><th data-i18n="plan.strategy">Strategy</th><th data-i18n="plan.phase">Phase</th></tr>
        </thead>
        <tbody>
          <tr><td>1 ‚Äî 2</td><td data-i18n="plan.r1.goal">Track baseline</td><td data-i18n="plan.r1.strategy">Count every puff. No reduction yet ‚Äî just observe.</td><td><span class="badge badge-purple" data-i18n="plan.r1.phase">Awareness</span></td></tr>
          <tr><td>3 ‚Äî 4</td><td data-i18n="plan.r2.goal">Reduce 25%</td><td data-i18n="plan.r2.strategy">If you average 40 puffs/day, target 30. Cut the "automatic" ones first.</td><td><span class="badge badge-orange" data-i18n="plan.r2.phase">Reduce</span></td></tr>
          <tr><td>5 ‚Äî 6</td><td data-i18n="plan.r3.goal">Reduce 50%</td><td data-i18n="plan.r3.strategy">Target half your baseline. Add 10-min delays before each session.</td><td><span class="badge badge-orange" data-i18n="plan.r2.phase">Reduce</span></td></tr>
          <tr><td>7 ‚Äî 8</td><td data-i18n="plan.r4.goal">Reduce 75%</td><td data-i18n="plan.r4.strategy">Vape only at designated times (after meals, before bed). Max 3 sessions/day.</td><td><span class="badge badge-teal" data-i18n="plan.r4.phase">Structure</span></td></tr>
          <tr><td>9 ‚Äî 10</td><td data-i18n="plan.r5.goal">1-2x per day</td><td data-i18n="plan.r5.strategy">Only vape once or twice. Use NRT gum for breakthroughs.</td><td><span class="badge badge-teal" data-i18n="plan.r4.phase">Structure</span></td></tr>
          <tr><td>11 ‚Äî 12</td><td data-i18n="plan.r6.goal">Zero</td><td data-i18n="plan.r6.strategy">Full stop. Use every tool in this app. You're ready.</td><td><span class="badge badge-green" data-i18n="plan.r6.phase">Freedom</span></td></tr>
        </tbody>
      </table>
      <div class="callout" data-i18n="plan.callout">Key principle: Don't try to resist a craving with nothing. Always have a REPLACEMENT ready ‚Äî gum, breathing, a fidget, a walk. Willpower alone fails. Systems win.</div>
    </div>

    <div class="card">
      <h2 data-i18n="plan.anxietyTitle">The Truth About Anxiety + Nicotine</h2>
      <p data-i18n="plan.anxietyIntro">This is the most important thing you'll read in this app:</p>
      <p data-i18n-html="plan.anxietyDesc">Nicotine <strong>feels</strong> like it helps your anxiety. But the science shows it actually <strong>makes it worse</strong>:</p>
      <ul>
        <li data-i18n-html="plan.anx1">Nicotine withdrawal creates anxiety symptoms ‚Üí the next hit "relieves" it ‚Üí you think it helped ‚Üí this <strong>increases your baseline anxiety</strong> over time (Moylan et al., 2013)</li>
        <li data-i18n-html="plan.anx2">People who quit experience <strong>reduced anxiety equal to taking medication</strong> within 1-3 months (Taylor et al., 2014)</li>
        <li data-i18n="plan.anx3">The hardest window is days 3-14 after full cessation. After that, it improves every week</li>
      </ul>
      <div class="callout" style="background:#fdf2f8;border-color:var(--accent);color:#9d174d;">
        <span data-i18n="plan.anxCallout">You're not losing a coping tool. You're breaking free from something that was quietly making your anxiety worse every single day. The person you'll be in 3 months will be calmer, more present, and genuinely less anxious. That person is worth fighting for.</span>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="plan.checklistTitle">Getting Started Checklist</h2>
      <p data-i18n="plan.checklistDesc">Complete these to begin your journey:</p>
      <div class="checkin-grid" id="setupChecklist"></div>
    </div>
  </div>

  <!-- ====== SOCIAL KIT ====== -->
  <div class="panel" id="panel-social">
    <div class="card">
      <h2 data-i18n="social.title">Social Situations Toolkit</h2>
      <p data-i18n-html="social.desc">This is your hardest trigger ‚Äî so it gets the most preparation. These strategies are based on CBT principles for social anxiety and substance use. You're not broken for finding this hard. <strong>Everyone</strong> does.</p>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.before.title">Before You Arrive</h4>
      <p data-i18n-html="social.before.desc">Vape <strong>before</strong> the event so you arrive satisfied. Set one rule: "I won't vape in the first 30 minutes." This breaks the automatic link between "social = vape." After a few events, the association weakens permanently.</p>
      <span class="tag tag-purple" data-i18n="social.before.tag">Pre-event</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.hand.title">The Dominant Hand Trick</h4>
      <p data-i18n="social.hand.desc">Keep a drink in your dominant hand the entire time. This physically blocks the hand-to-mouth reflex. It's stupidly simple ‚Äî and that's why it works.</p>
      <span class="tag tag-teal" data-i18n="social.hand.tag">During event</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.response.title">Your Pre-Loaded Response</h4>
      <p data-i18n-html="social.response.desc">When someone offers or asks, use: <strong>"I'm cutting back"</strong> ‚Äî three words, no debate, no awkwardness. Practice saying it out loud before you go. CBT research shows rehearsed responses dramatically reduce social anxiety about refusal.</p>
      <span class="tag tag-orange" data-i18n="social.response.tag">Key phrase</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.weapons.title">Your Secret Weapons: Pocket Kit</h4>
      <p data-i18n-html="social.weapons.desc">Bring a small kit to every social event: <strong>strong mints, a fidget ring or worry stone, and nicotine gum (just in case).</strong> Having backups reduces anxiety because you know you're prepared. You may not even use them ‚Äî but knowing they're there is the point.</p>
      <span class="tag tag-pink" data-i18n="social.weapons.tag">Game changer</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.buddy.title">Find Your Accountability Buddy</h4>
      <p data-i18n-html="social.buddy.desc">Tell <strong>one</strong> friend about your goal. Not for a lecture ‚Äî just someone who knows. When you feel the pull, text them or make eye contact. Social support increases quit success by 30% (Westmaas et al., 2010).</p>
      <span class="tag tag-green" data-i18n="social.buddy.tag">Support</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.swap.title">The Step-Away Swap</h4>
      <p data-i18n-html="social.swap.desc">When you feel the pull to go outside and vape, <strong>still step away</strong> ‚Äî but do 2 minutes of box breathing or walk around the block instead. You keep the break from socializing (which is what you actually need), just without nicotine.</p>
      <span class="tag tag-teal" data-i18n="social.swap.tag">Replacement</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.reframe.title">The Reframe</h4>
      <p data-i18n-html="social.reframe.desc"><em>"I can't socialize without nicotine"</em> ‚Üí You did it as a child, a teenager before vaping, and in many situations now. Nicotine withdrawal mimics social anxiety (racing heart, restlessness) but <strong>isn't the same thing</strong>. After 2-4 weeks, most people feel more comfortable socially, not less.</p>
      <span class="tag tag-purple" data-i18n="social.reframe.tag">Mindset</span>
    </div>

    <div class="card" style="border-left:4px solid var(--green);">
      <h2 data-i18n="social.setback.title">Setback Protocol</h2>
      <p data-i18n-html="social.setback.intro">If you slip at a party ‚Äî <strong>read this:</strong></p>
      <ul>
        <li data-i18n="social.setback1">One slip is NOT a relapse. The Abstinence Violation Effect ("I already failed, might as well keep going") is the real enemy</li>
        <li data-i18n="social.setback2">Log it in your journal ‚Äî what triggered it, how you felt</li>
        <li data-i18n="social.setback3">Do NOT reset your mental timeline</li>
        <li data-i18n-html="social.setback4">One slip in a month = you succeeded <strong>29 out of 30 days</strong>. That's a 97% success rate</li>
        <li data-i18n="social.setback5">Resume the plan tomorrow as if nothing happened. Because nothing did ‚Äî you're still on track</li>
      </ul>
      <div class="callout" data-i18n="social.setbackCallout">Perfection isn't the goal. Progress is. And progress isn't linear ‚Äî it's messy and human. Just like you. Keep going.</div>
    </div>
  </div>

  <!-- ====== JOURNAL ====== -->
  <div class="panel" id="panel-journal">
    <div class="card">
      <h2 data-i18n="journal.title">Your Journal</h2>
      <p data-i18n="journal.desc">Writing about cravings, victories, and feelings improves quit outcomes by 25% (Pennebaker, 1997). This is private and stays on your device only.</p>
      <textarea class="journal-input" id="journalInput" data-i18n-placeholder="journal.placeholder" placeholder="How are you feeling today? What triggered a craving? What are you proud of? Write anything..."></textarea>
      <button class="btn-primary btn-full" onclick="saveJournalEntry()" data-i18n="journal.save">Save Entry</button>
      <div class="journal-entries" id="journalEntries"></div>
    </div>
  </div>

  <!-- ====== PROGRESS ====== -->
  <div class="panel" id="panel-progress">
    <div class="card">
      <h2 data-i18n="progress.timeline">Your Journey Timeline</h2>
      <div class="timeline" id="progressTimeline"></div>
    </div>
    <div class="card">
      <h2 data-i18n="progress.trend">Craving & Anxiety Trend</h2>
      <canvas id="trendChart" height="200"></canvas>
      <p style="margin-top:12px;font-size:0.85em;color:var(--text-dim)" data-i18n-html="progress.trendDesc">Your daily scores over the last 14 days. Fluctuations are normal ‚Äî the <strong>overall downward trend</strong> is what matters. Some days will be harder. That's not failure, that's the process.</p>
    </div>
    <div class="card">
      <h2 data-i18n="progress.achievements">Achievements</h2>
      <div id="achievements"></div>
    </div>
    <div class="card">
      <h2>üå± Setback Log</h2>
      <p style="font-size:0.9em;color:var(--text-dim);margin-bottom:14px">Every hard day you logged ‚Äî and got through.</p>
      <div id="setbackLog"></div>
    </div>
    <div class="card">
      <h2>üìÖ Daily History</h2>
      <p style="font-size:0.9em;color:var(--text-dim);margin-bottom:14px">All your check-in days, newest first.</p>
      <div id="historyLog"></div>
    </div>
  </div>

  <!-- ====== SETTINGS ====== -->
  <div class="panel" id="panel-settings">
    <div class="card">
      <h2 data-i18n="settings.title">Your Settings</h2>
      <p data-i18n="settings.desc">Personalize BreatheFreely to match your situation.</p>

      <h3 data-i18n="settings.language">Language</h3>
      <div style="margin:14px 0">
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px">
          <button class="currency-btn lang-btn" onclick="setLanguage('en')">English</button>
          <button class="currency-btn lang-btn" onclick="setLanguage('es')">Espa√±ol</button>
        </div>
      </div>

      <h3 data-i18n="settings.name">Your Name</h3>
      <div style="margin:14px 0">
        <input type="text" id="userName" placeholder="e.g. Majo" maxlength="30" style="width:100%;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-family:'Inter',sans-serif;font-size:1em;color:var(--text);background:var(--surface2);outline:none" oninput="this.style.borderColor='var(--accent)'">
        <p style="margin-top:8px;font-size:0.82em;color:var(--text-dim)" data-i18n="settings.nameDesc">Used to personalize greetings and motivational messages throughout the app.</p>
      </div>

      <h3 data-i18n="settings.money">Money Tracking</h3>
      <div style="margin:14px 0">
        <label style="display:block;font-weight:600;font-size:0.9em;color:var(--text);margin-bottom:6px" data-i18n="settings.currency">Currency Symbol</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px">
          <button class="currency-btn" onclick="setCurrency('$','USD')">$ USD</button>
          <button class="currency-btn" onclick="setCurrency('COP$','COP')">COP$ Pesos</button>
          <button class="currency-btn" onclick="setCurrency('‚Ç¨','EUR')">‚Ç¨ EUR</button>
          <button class="currency-btn" onclick="setCurrency('¬£','GBP')">¬£ GBP</button>
          <button class="currency-btn" onclick="setCurrency('MX$','MXN')">MX$ MXN</button>
        </div>
        <label style="display:block;font-weight:600;font-size:0.9em;color:var(--text);margin-bottom:6px" data-i18n="settings.weeklySpend">How much do you spend per WEEK on vaping?</label>
        <div style="display:flex;gap:10px;align-items:center">
          <span id="currencyLabel" style="font-weight:700;font-size:1.2em;color:var(--accent)">$</span>
          <input type="number" id="weeklySpend" placeholder="e.g. 50000" style="flex:1;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-family:'Inter',sans-serif;font-size:1em;color:var(--text);background:var(--surface2);outline:none;-moz-appearance:textfield" oninput="this.style.borderColor='var(--accent)'">
          <span style="color:var(--text-dim);font-size:0.85em;font-weight:500" data-i18n="settings.perWeek">/ week</span>
        </div>
        <p style="margin-top:8px;font-size:0.82em;color:var(--text-dim)" data-i18n="settings.moneyDesc">This calculates how much you're saving as you reduce. Your daily cost = weekly spend / 7.</p>
      </div>

      <h3 data-i18n="settings.puffBaseline">Puff Baseline</h3>
      <div style="margin:14px 0">
        <label style="display:block;font-weight:600;font-size:0.9em;color:var(--text);margin-bottom:6px" data-i18n="settings.puffLabel">Average puffs per day (your starting point)</label>
        <input type="number" id="baselinePuffsInput" placeholder="e.g. 40" style="width:120px;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-family:'Inter',sans-serif;font-size:1em;color:var(--text);background:var(--surface2);outline:none;-moz-appearance:textfield">
        <p style="margin-top:8px;font-size:0.82em;color:var(--text-dim)" data-i18n="settings.puffDesc">This sets your reduction targets. If you're not sure, track for a few days first and come back.</p>
      </div>

      <button class="btn-primary btn-full" onclick="saveSettings()" data-i18n="settings.save">Save Settings</button>
    </div>

    <div class="card" style="border-left:4px solid var(--red);">
      <h2 data-i18n="settings.danger">Danger Zone</h2>
      <p data-i18n="settings.dangerDesc">This permanently deletes all your data ‚Äî check-ins, journal entries, achievements, everything.</p>
      <button class="btn-primary btn-full" style="background:var(--red);margin-top:12px" onclick="resetApp()" data-i18n="settings.reset">Reset All Data</button>
    </div>
  </div>

  <div class="quote-bar" id="quoteBar"></div>
</div>

<div class="toast" id="toast"></div>

<script>
// ===== DATA =====
const STORAGE_KEY = 'breathefreely_v2';
const defaultData = () => ({
  startDate: new Date().toISOString().split('T')[0],
  dailyCheckins: {},
  lang: 'en',
  journal: [],
  cravingsBeaten: 0,
  setupDone: {},
  triggersDone: {},
  breathRoundsTotal: 0,
  costPerDay: 7,
  baselinePuffs: 40,
  currency: '$',
  currencyCode: 'USD',
  weeklySpend: 49,
  userName: ''
});

function loadData() {
  try {
    const d = JSON.parse(localStorage.getItem(STORAGE_KEY));
    if (d && d.startDate) return d;
  } catch(e) {}
  const d = defaultData();
  saveData(d);
  return d;
}
function saveData(d) { localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }
let data = loadData();

// ===== i18n TRANSLATIONS =====
function t(key) {
  const entry = T[key];
  if (!entry) return key;
  return entry[data.lang] || entry.en || key;
}

const T = {
  // Header
  'app.title': { en: 'BreatheFreely', es: 'RespiraLibre' },
  'app.subtitle': { en: 'Your personal journey to freedom ‚Äî one breath at a time', es: 'Tu viaje personal hacia la libertad ‚Äî una respiraci√≥n a la vez' },
  'app.subtitle.name': { en: ', your personal journey to freedom ‚Äî one breath at a time', es: ', tu viaje personal hacia la libertad ‚Äî una respiraci√≥n a la vez' },
  // Stats
  'stat.daysOnPlan': { en: 'Days on Plan', es: 'D√≠as en Plan' },
  'stat.moneySaved': { en: 'Money Saved', es: 'Dinero Ahorrado' },
  'stat.cravingsBeaten': { en: 'Cravings Beaten', es: 'Antojos Vencidos' },
  'stat.currentPhase': { en: 'Current Phase', es: 'Fase Actual' },
  // Nav
  'nav.today': { en: 'Today', es: 'Hoy' },
  'nav.breathe': { en: 'Breathe', es: 'Respira' },
  'nav.cravings': { en: 'Cravings', es: 'Antojos' },
  'nav.plan': { en: 'My Plan', es: 'Mi Plan' },
  'nav.social': { en: 'Social Kit', es: 'Kit Social' },
  'nav.journal': { en: 'Journal', es: 'Diario' },
  'nav.progress': { en: 'Progress', es: 'Progreso' },
  'nav.settings': { en: 'Settings', es: 'Ajustes' },
  // Today panel
  'today.thisWeek': { en: 'This Week', es: 'Esta Semana' },
  'today.puffTracker': { en: "Today's Puff Tracker", es: 'Contador de Caladas' },
  'today.puffDesc': { en: 'Track how many times you vape today. The goal is to gradually reduce this number week by week ‚Äî no pressure, just awareness.', es: 'Registra cu√°ntas veces vapeas hoy. El objetivo es reducir gradualmente este n√∫mero semana a semana ‚Äî sin presi√≥n, solo consciencia.' },
  'today.puffsToday': { en: 'Puffs today', es: 'Caladas hoy' },
  'today.dailyCheckin': { en: 'Daily Check-in', es: 'Check-in Diario' },
  'today.anxietyLevel': { en: 'Anxiety Level', es: 'Nivel de Ansiedad' },
  'today.cravingIntensity': { en: 'Craving Intensity', es: 'Intensidad del Antojo' },
  'today.saveCheckin': { en: "Save Today's Check-in", es: 'Guardar Check-in de Hoy' },
  'today.cravingNow': { en: 'Craving Right Now?', es: '¬øAntojo Ahora Mismo?' },
  'today.sosBtn': { en: 'SOS ‚Äî I Need Help Right Now', es: 'SOS ‚Äî Necesito Ayuda Ahora' },
  'today.healthTimeline': { en: 'Health Recovery Timeline', es: 'L√≠nea de Recuperaci√≥n de Salud' },
  // SOS tips
  'sos.ice.title': { en: 'Ice Cube Trick', es: 'Truco del Hielo' },
  'sos.ice.desc': { en: 'Hold ice in your hand or press it to your neck. The cold activates your dive reflex and drops your heart rate in 30 seconds. Focus entirely on the sensation.', es: 'Sost√©n hielo en tu mano o presi√≥nalo contra tu cuello. El fr√≠o activa tu reflejo de inmersi√≥n y reduce tu ritmo card√≠aco en 30 segundos. Conc√©ntrate totalmente en la sensaci√≥n.' },
  'sos.box.title': { en: 'Box Breathing ‚Äî Do It Now', es: 'Respiraci√≥n Cuadrada ‚Äî Hazla Ahora' },
  'sos.box.desc': { en: 'Go to the <strong>Breathe</strong> tab. 4 rounds = 4 minutes. The deep inhale you crave from vaping? You get it here ‚Äî without the nicotine.', es: 'Ve a la pesta√±a <strong>Respira</strong>. 4 rondas = 4 minutos. ¬øLa inhalaci√≥n profunda que deseas del vape? La obtienes aqu√≠ ‚Äî sin nicotina.' },
  'sos.move.title': { en: 'Move for 5 Minutes', es: 'Mu√©vete 5 Minutos' },
  'sos.move.desc': { en: "Walk, stretch, pace ‚Äî anything. Taylor et al. (2007) found brief walking cuts cravings by 50%. Your body needs to burn off the restless energy.", es: 'Camina, est√≠rate, pasea ‚Äî lo que sea. Taylor et al. (2007) encontr√≥ que caminar brevemente reduce los antojos un 50%. Tu cuerpo necesita quemar la energ√≠a inquieta.' },
  'sos.squeeze.title': { en: 'Squeeze Something', es: 'Aprieta Algo' },
  'sos.squeeze.desc': { en: 'Grab a stress ball, rubber band, or just clench your fist hard for 10 seconds then release. This redirects the physical tension your body is feeling.', es: 'Agarra una pelota antiestr√©s, una liga, o simplemente aprieta tu pu√±o fuerte por 10 segundos y suelta. Esto redirige la tensi√≥n f√≠sica que siente tu cuerpo.' },
  'sos.wait.title': { en: 'Wait 5 Minutes', es: 'Espera 5 Minutos' },
  'sos.wait.desc': { en: '"I\'ll wait just 5 more minutes." Most cravings peak and fade within 3-5 minutes. Set a timer. You\'ll be surprised how fast it passes.', es: '"Esperar√© solo 5 minutos m√°s." La mayor√≠a de los antojos llegan al pico y se desvanecen en 3-5 minutos. Pon un temporizador. Te sorprender√° lo r√°pido que pasa.' },
  'sos.reframe.title': { en: 'Reframe the Thought', es: 'Reencuadra el Pensamiento' },
  'sos.reframe.desc': { en: '"I need to vape" ‚Üí "My brain is requesting nicotine. This uncomfortable feeling IS the addiction losing its grip. Each time I resist, it gets weaker. I am winning right now."', es: '"Necesito vapear" ‚Üí "Mi cerebro est√° pidiendo nicotina. Esta sensaci√≥n inc√≥moda ES la adicci√≥n perdiendo su control. Cada vez que resisto, se debilita. Estoy ganando ahora mismo."' },
  'sos.oral.title': { en: 'Oral Substitute ‚Äî Now', es: 'Sustituto Oral ‚Äî Ahora' },
  'sos.oral.desc': { en: 'Pop a mint, chew gum, bite a toothpick, eat a crunchy carrot. The oral fixation is real ‚Äî satisfy it without nicotine.', es: 'Come una menta, mastica chicle, muerde un palillo, come una zanahoria crujiente. La fijaci√≥n oral es real ‚Äî satisf√°cela sin nicotina.' },
  // Breathe panel
  'breathe.title': { en: 'Box Breathing Exercise', es: 'Ejercicio de Respiraci√≥n Cuadrada' },
  'breathe.desc': { en: "Your body's built-in calm-down switch. Used by Navy SEALs, recommended by anxiety researchers. Do this whenever you'd reach for the vape ‚Äî the deep inhale satisfies the same physical urge.", es: 'El interruptor de calma incorporado de tu cuerpo. Usado por Navy SEALs, recomendado por investigadores de ansiedad. Haz esto cada vez que busques el vape ‚Äî la inhalaci√≥n profunda satisface la misma necesidad f√≠sica.' },
  'breathe.start': { en: 'Start Breathing', es: 'Comenzar Respiraci√≥n' },
  'breathe.stop': { en: 'Stop', es: 'Detener' },
  'breathe.ready': { en: 'Ready', es: 'Listo' },
  'breathe.round': { en: 'Round:', es: 'Ronda:' },
  'breathe.whyTitle': { en: 'Why This Replaces Vaping', es: 'Por Qu√© Esto Reemplaza al Vape' },
  'breathe.whyDesc': { en: "Here's what most people don't realize: when you vape, the calming effect comes partly from the <strong>breathing pattern itself</strong> ‚Äî slow, deep inhales. Nicotine gets the credit, but your lungs do the real work.", es: 'Esto es lo que la mayor√≠a no sabe: cuando vapeas, el efecto calmante viene en parte del <strong>patr√≥n de respiraci√≥n</strong> ‚Äî inhalaciones lentas y profundas. La nicotina se lleva el cr√©dito, pero tus pulmones hacen el trabajo real.' },
  'breathe.callout': { en: 'Box breathing gives you the same parasympathetic activation without the 50+ chemicals. After 2-3 weeks of practice, your brain rewires to use this as the default stress response.', es: 'La respiraci√≥n cuadrada te da la misma activaci√≥n parasimp√°tica sin los 50+ qu√≠micos. Despu√©s de 2-3 semanas de pr√°ctica, tu cerebro se reconfigura para usar esto como respuesta predeterminada al estr√©s.' },
  'breathe.science': { en: 'The Science', es: 'La Ciencia' },
  'breathe.sci1': { en: 'Extended exhales stimulate the vagus nerve, lowering heart rate instantly (Gerritsen & Band, 2018)', es: 'Las exhalaciones prolongadas estimulan el nervio vago, reduciendo el ritmo card√≠aco instant√°neamente (Gerritsen & Band, 2018)' },
  'breathe.sci2': { en: '4 rounds reduce cortisol by up to 20% (Ma et al., 2017)', es: '4 rondas reducen el cortisol hasta un 20% (Ma et al., 2017)' },
  'breathe.sci3': { en: 'Regular practice physically rewires your stress response in 2-3 weeks', es: 'La pr√°ctica regular reconfigura f√≠sicamente tu respuesta al estr√©s en 2-3 semanas' },
  'breathe.sci4': { en: 'This is literally what your body was doing when you vaped ‚Äî minus the poison', es: 'Esto es literalmente lo que tu cuerpo hac√≠a cuando vapeabas ‚Äî menos el veneno' },
  // Cravings panel
  'cravings.title': { en: 'Understanding Your Cravings', es: 'Entendiendo Tus Antojos' },
  'cravings.desc': { en: 'A craving is a <strong>wave</strong> ‚Äî it rises, peaks, and falls in 3-5 minutes. You don\'t need to fight it. You just need to <strong>surf it</strong>. The technique is called "urge surfing" (Marlatt, 1985) and it\'s one of the most effective tools in addiction research.', es: 'Un antojo es una <strong>ola</strong> ‚Äî sube, llega al pico y baja en 3-5 minutos. No necesitas luchar contra √©l. Solo necesitas <strong>surfear la ola</strong>. La t√©cnica se llama "surfeo de impulsos" (Marlatt, 1985) y es una de las herramientas m√°s efectivas en investigaci√≥n de adicciones.' },
  'cravings.callout': { en: "Every single craving you ride out without vaping physically weakens the neural pathway. Your brain literally rewires. It's not willpower ‚Äî it's neuroscience.", es: 'Cada antojo que superas sin vapear debilita f√≠sicamente la v√≠a neuronal. Tu cerebro literalmente se reconfigura. No es fuerza de voluntad ‚Äî es neurociencia.' },
  'cravings.wave': { en: 'The Craving Wave', es: 'La Ola del Antojo' },
  'cravings.wave1': { en: '<strong>0-1 min:</strong> Trigger hits. You feel the pull. This is the steepest part.', es: '<strong>0-1 min:</strong> El disparador golpea. Sientes el impulso. Esta es la parte m√°s intensa.' },
  'cravings.wave2': { en: '<strong>1-3 min:</strong> Peak intensity. Your brain is screaming. This is where most people give in.', es: '<strong>1-3 min:</strong> Intensidad m√°xima. Tu cerebro est√° gritando. Aqu√≠ es donde la mayor√≠a cede.' },
  'cravings.wave3': { en: '<strong>3-5 min:</strong> It starts fading. You made it through the worst.', es: '<strong>3-5 min:</strong> Empieza a desvanecerse. Pasaste lo peor.' },
  'cravings.wave4': { en: '<strong>5+ min:</strong> Gone. You won. The neural pathway just got weaker.', es: '<strong>5+ min:</strong> Se fue. Ganaste. La v√≠a neuronal se acaba de debilitar.' },
  'cravings.habits': { en: 'Hand-to-Mouth Habit Replacements', es: 'Reemplazos del H√°bito Mano-a-Boca' },
  'cravings.habitsDesc': { en: "Vaping isn't just nicotine ‚Äî it's a <strong>physical habit</strong>. Your hand reaches for it automatically. Here are proven replacements that satisfy the same motor pattern:", es: 'Vapear no es solo nicotina ‚Äî es un <strong>h√°bito f√≠sico</strong>. Tu mano lo busca autom√°ticamente. Aqu√≠ hay reemplazos probados que satisfacen el mismo patr√≥n motor:' },
  'habit.pen.title': { en: 'Pen / Pencil Fidget', es: 'Jugar con un Lapicero' },
  'habit.pen.desc': { en: 'Keep a pen in your hand. Click it, twirl it, hold it between your fingers like a vape. Same hand movement, zero nicotine.', es: 'Mant√©n un lapicero en tu mano. Haz clic, g√≠ralo, sostenlo entre tus dedos como un vape. Mismo movimiento de mano, cero nicotina.' },
  'habit.pen.when': { en: 'When: Working, sitting, thinking', es: 'Cu√°ndo: Trabajando, sentado, pensando' },
  'habit.mints.title': { en: 'Mints & Hard Candy', es: 'Mentas y Caramelos Duros' },
  'habit.mints.desc': { en: 'Strong mints (Altoids, cinnamon) work best. The intense flavor distracts your brain and satisfies the oral fixation.', es: 'Las mentas fuertes (Altoids, canela) funcionan mejor. El sabor intenso distrae tu cerebro y satisface la fijaci√≥n oral.' },
  'habit.mints.when': { en: 'When: After meals, social events', es: 'Cu√°ndo: Despu√©s de comer, eventos sociales' },
  'habit.snacks.title': { en: 'Crunchy Snacks', es: 'Snacks Crujientes' },
  'habit.snacks.desc': { en: 'Carrots, celery, sunflower seeds, apple slices. The chewing and crunching engages your jaw and satisfies the oral need.', es: 'Zanahorias, apio, semillas de girasol, rodajas de manzana. Masticar y crujir activa tu mand√≠bula y satisface la necesidad oral.' },
  'habit.snacks.when': { en: 'When: At home, watching TV', es: 'Cu√°ndo: En casa, viendo TV' },
  'habit.stress.title': { en: 'Stress Ball / Grip', es: 'Pelota Antiestr√©s' },
  'habit.stress.desc': { en: 'Squeeze a stress ball or hand gripper. Channels the physical tension somewhere productive. Bonus: builds forearm strength.', es: 'Aprieta una pelota antiestr√©s o un grip de mano. Canaliza la tensi√≥n f√≠sica de forma productiva. Bonus: fortalece el antebrazo.' },
  'habit.stress.when': { en: 'When: Anxious moments, meetings', es: 'Cu√°ndo: Momentos de ansiedad, reuniones' },
  'habit.water.title': { en: 'Cold Water Bottle', es: 'Botella de Agua Fr√≠a' },
  'habit.water.desc': { en: 'Sip ice water through a straw. The cold, the sipping motion, and the hand-holding all mimic vaping sensations.', es: 'Bebe agua helada con un pitillo. El fr√≠o, el movimiento de sorber y sostener la botella imitan las sensaciones del vape.' },
  'habit.water.when': { en: 'When: Driving, desk work', es: 'Cu√°ndo: Conduciendo, trabajo de escritorio' },
  'habit.toothpick.title': { en: 'Flavored Toothpick', es: 'Palillo Saborizado' },
  'habit.toothpick.desc': { en: 'Cinnamon or tea tree toothpicks give you something in your mouth and hands. Many ex-smokers swear by this.', es: 'Los palillos de canela o √°rbol de t√© te dan algo en la boca y las manos. Muchos ex-fumadores conf√≠an en esto.' },
  'habit.toothpick.when': { en: 'When: Social events, bars', es: 'Cu√°ndo: Eventos sociales, bares' },
  'habit.fidget.title': { en: 'Fidget Ring / Worry Stone', es: 'Anillo Fidget / Piedra de Preocupaci√≥n' },
  'habit.fidget.desc': { en: "A spinner ring or smooth stone you roll between your fingers. Keeps your hands busy without thinking about it.", es: 'Un anillo giratorio o piedra lisa que giras entre tus dedos. Mantiene tus manos ocupadas sin pensarlo.' },
  'habit.fidget.when': { en: 'When: Anywhere, anytime', es: 'Cu√°ndo: Donde sea, cuando sea' },
  'habit.straw.title': { en: 'Deep Breath Through a Straw', es: 'Respiraci√≥n Profunda por un Pitillo' },
  'habit.straw.desc': { en: 'Inhale slowly through a straw ‚Äî mimics the exact draw sensation of vaping. Exhale slowly through your nose. Repeat 5x.', es: 'Inhala lentamente por un pitillo ‚Äî imita la sensaci√≥n exacta de inhalar del vape. Exhala lentamente por la nariz. Repite 5 veces.' },
  'habit.straw.when': { en: 'When: Intense cravings', es: 'Cu√°ndo: Antojos intensos' },
  'cravings.triggerMap': { en: 'Trigger Map', es: 'Mapa de Disparadores' },
  'cravings.triggerDesc': { en: 'Most vaping happens on autopilot. Identify your triggers so you can prepare:', es: 'La mayor√≠a del vapeo ocurre en autom√°tico. Identifica tus disparadores para prepararte:' },
  'cravings.triggerHelp': { en: 'Check the ones that apply to you. For each trigger you identify, plan a specific replacement action. Writing "When X happens, I will do Y instead" (implementation intentions) doubles your success rate (Gollwitzer, 1999).', es: 'Marca los que aplican para ti. Para cada disparador que identifiques, planea una acci√≥n de reemplazo espec√≠fica. Escribir "Cuando pase X, har√© Y en su lugar" (intenciones de implementaci√≥n) duplica tu tasa de √©xito (Gollwitzer, 1999).' },
  'cravings.evidenceTitle': { en: 'Things That Actually Help (Evidence-Based)', es: 'Cosas Que Realmente Ayudan (Basadas en Evidencia)' },
  'cravings.ev1': { en: '<strong>Nicotine gum/lozenges (NRT):</strong> Available over the counter. Use for breakthrough cravings, especially in social situations. Clinically proven to improve quit rates by 50-70% (Stead et al., 2012)', es: '<strong>Chicle/pastillas de nicotina (NRT):</strong> Disponibles sin receta. √ösalos para antojos intensos, especialmente en situaciones sociales. Cl√≠nicamente probado para mejorar las tasas de abandono un 50-70% (Stead et al., 2012)' },
  'cravings.ev2': { en: '<strong>Exercise:</strong> Even 10 minutes reduces cravings significantly. The endorphins replace the dopamine hit from nicotine', es: '<strong>Ejercicio:</strong> Incluso 10 minutos reducen los antojos significativamente. Las endorfinas reemplazan el golpe de dopamina de la nicotina' },
  'cravings.ev3': { en: '<strong>Sleep:</strong> Poor sleep increases cravings 40%. Prioritize 7+ hours', es: '<strong>Sue√±o:</strong> Dormir mal aumenta los antojos un 40%. Prioriza 7+ horas' },
  'cravings.ev4': { en: '<strong>Water:</strong> Dehydration intensifies cravings. Drink a full glass when a craving hits', es: '<strong>Agua:</strong> La deshidrataci√≥n intensifica los antojos. Bebe un vaso lleno cuando te d√© un antojo' },
  'cravings.ev5': { en: '<strong>CBT (therapy):</strong> The gold standard for anxiety + cessation. Many therapists offer it online. This is the single most effective intervention available', es: '<strong>TCC (terapia):</strong> El est√°ndar de oro para ansiedad + cesaci√≥n. Muchos terapeutas lo ofrecen online. Es la intervenci√≥n m√°s efectiva disponible' },
  // Plan panel
  'plan.title': { en: 'Your Frequency Reduction Plan', es: 'Tu Plan de Reducci√≥n de Frecuencia' },
  'plan.desc': { en: 'Since you\'re using a 5% nicotine vape with no lower option, the strategy shifts to <strong>reducing how often you use it</strong>. This is called "scheduled reduction" and research shows it\'s effective ‚Äî especially for anxious quitters, because it avoids the shock of going cold turkey (Cinciripini et al., 1995).', es: 'Ya que usas un vape de nicotina al 5% sin opci√≥n m√°s baja, la estrategia cambia a <strong>reducir qu√© tan seguido lo usas</strong>. Esto se llama "reducci√≥n programada" y la investigaci√≥n muestra que es efectivo ‚Äî especialmente para quienes dejan con ansiedad, porque evita el shock de dejarlo de golpe (Cinciripini et al., 1995).' },
  'plan.weeks': { en: 'Weeks', es: 'Semanas' },
  'plan.goal': { en: 'Goal', es: 'Meta' },
  'plan.strategy': { en: 'Strategy', es: 'Estrategia' },
  'plan.phase': { en: 'Phase', es: 'Fase' },
  'plan.callout': { en: "Key principle: Don't try to resist a craving with nothing. Always have a REPLACEMENT ready ‚Äî gum, breathing, a fidget, a walk. Willpower alone fails. Systems win.", es: 'Principio clave: No intentes resistir un antojo sin nada. Siempre ten un REEMPLAZO listo ‚Äî chicle, respiraci√≥n, un fidget, una caminata. La fuerza de voluntad sola falla. Los sistemas ganan.' },
  'plan.anxietyTitle': { en: 'The Truth About Anxiety + Nicotine', es: 'La Verdad Sobre la Ansiedad + Nicotina' },
  'plan.anxietyIntro': { en: 'This is the most important thing you\'ll read in this app:', es: 'Esto es lo m√°s importante que leer√°s en esta app:' },
  'plan.anxietyDesc': { en: 'Nicotine <strong>feels</strong> like it helps your anxiety. But the science shows it actually <strong>makes it worse</strong>:', es: 'La nicotina <strong>se siente</strong> como si ayudara tu ansiedad. Pero la ciencia muestra que en realidad <strong>la empeora</strong>:' },
  'plan.anx1': { en: 'Nicotine withdrawal creates anxiety symptoms ‚Üí the next hit "relieves" it ‚Üí you think it helped ‚Üí this <strong>increases your baseline anxiety</strong> over time (Moylan et al., 2013)', es: 'La abstinencia de nicotina crea s√≠ntomas de ansiedad ‚Üí la siguiente calada la "alivia" ‚Üí crees que ayud√≥ ‚Üí esto <strong>aumenta tu ansiedad base</strong> con el tiempo (Moylan et al., 2013)' },
  'plan.anx2': { en: 'People who quit experience <strong>reduced anxiety equal to taking medication</strong> within 1-3 months (Taylor et al., 2014)', es: 'Las personas que dejan experimentan <strong>reducci√≥n de ansiedad igual a tomar medicaci√≥n</strong> en 1-3 meses (Taylor et al., 2014)' },
  'plan.anx3': { en: 'The hardest window is days 3-14 after full cessation. After that, it improves every week', es: 'La ventana m√°s dif√≠cil son los d√≠as 3-14 despu√©s de la cesaci√≥n total. Despu√©s de eso, mejora cada semana' },
  'plan.anxCallout': { en: "You're not losing a coping tool. You're breaking free from something that was quietly making your anxiety worse every single day. The person you'll be in 3 months will be calmer, more present, and genuinely less anxious. That person is worth fighting for.", es: 'No est√°s perdiendo una herramienta. Te est√°s liberando de algo que silenciosamente empeoraba tu ansiedad cada d√≠a. La persona que ser√°s en 3 meses ser√° m√°s tranquila, m√°s presente y genuinamente menos ansiosa. Esa persona vale la pena.' },
  'plan.checklistTitle': { en: 'Getting Started Checklist', es: 'Lista para Comenzar' },
  'plan.checklistDesc': { en: 'Complete these to begin your journey:', es: 'Completa estos para comenzar tu viaje:' },
  // Social panel
  'social.title': { en: 'Social Situations Toolkit', es: 'Kit para Situaciones Sociales' },
  'social.desc': { en: "This is your hardest trigger ‚Äî so it gets the most preparation. These strategies are based on CBT principles for social anxiety and substance use. You're not broken for finding this hard. <strong>Everyone</strong> does.", es: 'Este es tu disparador m√°s dif√≠cil ‚Äî por eso recibe la mayor preparaci√≥n. Estas estrategias est√°n basadas en principios de TCC para ansiedad social y uso de sustancias. No est√°s roto/a por encontrar esto dif√≠cil. <strong>Todos</strong> lo encuentran as√≠.' },
  'social.before.title': { en: 'Before You Arrive', es: 'Antes de Llegar' },
  'social.before.desc': { en: 'Vape <strong>before</strong> the event so you arrive satisfied. Set one rule: "I won\'t vape in the first 30 minutes." This breaks the automatic link between "social = vape." After a few events, the association weakens permanently.', es: 'Vapea <strong>antes</strong> del evento para llegar satisfecho/a. Pon una regla: "No vapear√© en los primeros 30 minutos." Esto rompe el v√≠nculo autom√°tico entre "social = vape." Despu√©s de algunos eventos, la asociaci√≥n se debilita permanentemente.' },
  'social.before.tag': { en: 'Pre-event', es: 'Pre-evento' },
  'social.hand.title': { en: 'The Dominant Hand Trick', es: 'El Truco de la Mano Dominante' },
  'social.hand.desc': { en: "Keep a drink in your dominant hand the entire time. This physically blocks the hand-to-mouth reflex. It's stupidly simple ‚Äî and that's why it works.", es: 'Mant√©n una bebida en tu mano dominante todo el tiempo. Esto bloquea f√≠sicamente el reflejo mano-a-boca. Es incre√≠blemente simple ‚Äî y por eso funciona.' },
  'social.hand.tag': { en: 'During event', es: 'Durante evento' },
  'social.response.title': { en: 'Your Pre-Loaded Response', es: 'Tu Respuesta Preparada' },
  'social.response.desc': { en: 'When someone offers or asks, use: <strong>"I\'m cutting back"</strong> ‚Äî three words, no debate, no awkwardness. Practice saying it out loud before you go. CBT research shows rehearsed responses dramatically reduce social anxiety about refusal.', es: 'Cuando alguien ofrezca o pregunte, usa: <strong>"Estoy reduciendo"</strong> ‚Äî dos palabras, sin debate, sin incomodidad. Practica dici√©ndolo en voz alta antes de ir. La investigaci√≥n en TCC muestra que las respuestas ensayadas reducen dram√°ticamente la ansiedad social sobre el rechazo.' },
  'social.response.tag': { en: 'Key phrase', es: 'Frase clave' },
  'social.weapons.title': { en: 'Your Secret Weapons: Pocket Kit', es: 'Tus Armas Secretas: Kit de Bolsillo' },
  'social.weapons.desc': { en: 'Bring a small kit to every social event: <strong>strong mints, a fidget ring or worry stone, and nicotine gum (just in case).</strong> Having backups reduces anxiety because you know you\'re prepared. You may not even use them ‚Äî but knowing they\'re there is the point.', es: 'Lleva un peque√±o kit a cada evento social: <strong>mentas fuertes, un anillo fidget o piedra de preocupaci√≥n, y chicle de nicotina (por si acaso).</strong> Tener respaldos reduce la ansiedad porque sabes que est√°s preparado/a. Puede que ni los uses ‚Äî pero saber que est√°n ah√≠ es el punto.' },
  'social.weapons.tag': { en: 'Game changer', es: 'Cambio de juego' },
  'social.buddy.title': { en: 'Find Your Accountability Buddy', es: 'Encuentra Tu Compa√±ero de Apoyo' },
  'social.buddy.desc': { en: 'Tell <strong>one</strong> friend about your goal. Not for a lecture ‚Äî just someone who knows. When you feel the pull, text them or make eye contact. Social support increases quit success by 30% (Westmaas et al., 2010).', es: 'Dile a <strong>un</strong> amigo sobre tu meta. No para un serm√≥n ‚Äî solo alguien que sepa. Cuando sientas el impulso, escr√≠bele o haz contacto visual. El apoyo social aumenta el √©xito al dejar en un 30% (Westmaas et al., 2010).' },
  'social.buddy.tag': { en: 'Support', es: 'Apoyo' },
  'social.swap.title': { en: 'The Step-Away Swap', es: 'El Intercambio al Salir' },
  'social.swap.desc': { en: 'When you feel the pull to go outside and vape, <strong>still step away</strong> ‚Äî but do 2 minutes of box breathing or walk around the block instead. You keep the break from socializing (which is what you actually need), just without nicotine.', es: 'Cuando sientas el impulso de salir a vapear, <strong>igual sal</strong> ‚Äî pero haz 2 minutos de respiraci√≥n cuadrada o camina por la cuadra. Mantienes el descanso de socializar (que es lo que realmente necesitas), solo sin nicotina.' },
  'social.swap.tag': { en: 'Replacement', es: 'Reemplazo' },
  'social.reframe.title': { en: 'The Reframe', es: 'El Reencuadre' },
  'social.reframe.desc': { en: '<em>"I can\'t socialize without nicotine"</em> ‚Üí You did it as a child, a teenager before vaping, and in many situations now. Nicotine withdrawal mimics social anxiety (racing heart, restlessness) but <strong>isn\'t the same thing</strong>. After 2-4 weeks, most people feel more comfortable socially, not less.', es: '<em>"No puedo socializar sin nicotina"</em> ‚Üí Lo hiciste de ni√±o/a, de adolescente antes de vapear, y en muchas situaciones ahora. La abstinencia de nicotina imita la ansiedad social (coraz√≥n acelerado, inquietud) pero <strong>no es lo mismo</strong>. Despu√©s de 2-4 semanas, la mayor√≠a se siente m√°s c√≥moda socialmente, no menos.' },
  'social.reframe.tag': { en: 'Mindset', es: 'Mentalidad' },
  'social.setback.title': { en: 'Setback Protocol', es: 'Protocolo de Reca√≠da' },
  'social.setback.intro': { en: 'If you slip at a party ‚Äî <strong>read this:</strong>', es: 'Si recaes en una fiesta ‚Äî <strong>lee esto:</strong>' },
  'social.setback1': { en: 'One slip is NOT a relapse. The Abstinence Violation Effect ("I already failed, might as well keep going") is the real enemy', es: 'Un desliz NO es una reca√≠da. El Efecto de Violaci√≥n de Abstinencia ("ya fall√©, mejor sigo") es el verdadero enemigo' },
  'social.setback2': { en: 'Log it in your journal ‚Äî what triggered it, how you felt', es: 'Reg√≠stralo en tu diario ‚Äî qu√© lo dispar√≥, c√≥mo te sentiste' },
  'social.setback3': { en: 'Do NOT reset your mental timeline', es: 'NO reinicies tu l√≠nea temporal mental' },
  'social.setback4': { en: 'One slip in a month = you succeeded <strong>29 out of 30 days</strong>. That\'s a 97% success rate', es: 'Un desliz en un mes = tuviste √©xito <strong>29 de 30 d√≠as</strong>. Eso es un 97% de √©xito' },
  'social.setback5': { en: "Resume the plan tomorrow as if nothing happened. Because nothing did ‚Äî you're still on track", es: 'Retoma el plan ma√±ana como si nada pasara. Porque nada pas√≥ ‚Äî sigues en camino' },
  'social.setbackCallout': { en: "Perfection isn't the goal. Progress is. And progress isn't linear ‚Äî it's messy and human. Just like you. Keep going.", es: 'La perfecci√≥n no es la meta. El progreso s√≠. Y el progreso no es lineal ‚Äî es desordenado y humano. Igual que t√∫. Sigue adelante.' },
  // Journal
  'journal.title': { en: 'Your Journal', es: 'Tu Diario' },
  'journal.desc': { en: 'Writing about cravings, victories, and feelings improves quit outcomes by 25% (Pennebaker, 1997). This is private and stays on your device only.', es: 'Escribir sobre antojos, victorias y sentimientos mejora los resultados al dejar en un 25% (Pennebaker, 1997). Esto es privado y se queda solo en tu dispositivo.' },
  'journal.placeholder': { en: 'How are you feeling today? What triggered a craving? What are you proud of? Write anything...', es: '¬øC√≥mo te sientes hoy? ¬øQu√© dispar√≥ un antojo? ¬øDe qu√© est√°s orgulloso/a? Escribe lo que quieras...' },
  'journal.save': { en: 'Save Entry', es: 'Guardar Entrada' },
  // Progress
  'progress.timeline': { en: 'Your Journey Timeline', es: 'Tu L√≠nea de Tiempo' },
  'progress.trend': { en: 'Craving & Anxiety Trend', es: 'Tendencia de Antojos y Ansiedad' },
  'progress.trendDesc': { en: 'Your daily scores over the last 14 days. Fluctuations are normal ‚Äî the <strong>overall downward trend</strong> is what matters. Some days will be harder. That\'s not failure, that\'s the process.', es: 'Tus puntajes diarios de los √∫ltimos 14 d√≠as. Las fluctuaciones son normales ‚Äî la <strong>tendencia general a la baja</strong> es lo que importa. Algunos d√≠as ser√°n m√°s dif√≠ciles. Eso no es fracaso, es el proceso.' },
  'progress.achievements': { en: 'Achievements', es: 'Logros' },
  'progress.chartEmpty': { en: 'Check in for at least 2 days to see your trend', es: 'Haz check-in por al menos 2 d√≠as para ver tu tendencia' },
  'progress.cravings': { en: '‚óè Cravings', es: '‚óè Antojos' },
  'progress.anxiety': { en: '‚óè Anxiety', es: '‚óè Ansiedad' },
  // Settings
  'settings.title': { en: 'Your Settings', es: 'Tus Ajustes' },
  'settings.desc': { en: 'Personalize BreatheFreely to match your situation.', es: 'Personaliza BreatheFreely para tu situaci√≥n.' },
  'settings.language': { en: 'Language', es: 'Idioma' },
  'settings.name': { en: 'Your Name', es: 'Tu Nombre' },
  'settings.namePlaceholder': { en: 'e.g. Majo', es: 'ej. Majo' },
  'settings.nameDesc': { en: 'Used to personalize greetings and motivational messages throughout the app.', es: 'Usado para personalizar saludos y mensajes motivacionales en toda la app.' },
  'settings.money': { en: 'Money Tracking', es: 'Seguimiento de Dinero' },
  'settings.currency': { en: 'Currency Symbol', es: 'S√≠mbolo de Moneda' },
  'settings.weeklySpend': { en: 'How much do you spend per WEEK on vaping?', es: '¬øCu√°nto gastas por SEMANA en vapear?' },
  'settings.perWeek': { en: '/ week', es: '/ semana' },
  'settings.moneyDesc': { en: 'This calculates how much you\'re saving as you reduce. Your daily cost = weekly spend / 7.', es: 'Esto calcula cu√°nto est√°s ahorrando mientras reduces. Tu costo diario = gasto semanal / 7.' },
  'settings.puffBaseline': { en: 'Puff Baseline', es: 'Base de Caladas' },
  'settings.puffLabel': { en: 'Average puffs per day (your starting point)', es: 'Caladas promedio por d√≠a (tu punto de inicio)' },
  'settings.puffDesc': { en: "This sets your reduction targets. If you're not sure, track for a few days first and come back.", es: 'Esto establece tus metas de reducci√≥n. Si no est√°s seguro/a, registra por unos d√≠as primero y vuelve.' },
  'settings.save': { en: 'Save Settings', es: 'Guardar Ajustes' },
  'settings.danger': { en: 'Danger Zone', es: 'Zona de Peligro' },
  'settings.dangerDesc': { en: 'This permanently deletes all your data ‚Äî check-ins, journal entries, achievements, everything.', es: 'Esto elimina permanentemente todos tus datos ‚Äî check-ins, entradas de diario, logros, todo.' },
  'settings.reset': { en: 'Reset All Data', es: 'Reiniciar Todos los Datos' },
  // Toasts
  'toast.checkinSaved': { en: 'Check-in saved! You showed up today ‚Äî that matters.', es: '¬°Check-in guardado! Te presentaste hoy ‚Äî eso importa.' },
  'toast.checkinSavedName': { en: 'Check-in saved! You showed up today, ', es: '¬°Check-in guardado! Te presentaste hoy, ' },
  'toast.journalSaved': { en: 'Journal entry saved. Reflecting = healing.', es: 'Entrada de diario guardada. Reflexionar = sanar.' },
  'toast.settingsSaved': { en: 'Settings saved!', es: '¬°Ajustes guardados!' },
  'toast.settingsSavedName': { en: "Settings saved! Let's go, ", es: '¬°Ajustes guardados! Vamos, ' },
  'toast.breathComplete': { en: ' rounds done. You\'re in control.', es: ' rondas completadas. Tienes el control.' },
  'toast.breathSession': { en: ' rounds complete ‚Äî your body thanks you.', es: ' rondas completadas ‚Äî tu cuerpo te lo agradece.' },
  'toast.sessionComplete': { en: 'Session complete ‚Äî ', es: 'Sesi√≥n completa ‚Äî ' },
  'toast.resetConfirm1': { en: 'This will delete ALL your data. Are you sure?', es: '¬øEsto eliminar√° TODOS tus datos. ¬øEst√°s seguro/a?' },
  'toast.resetConfirm2': { en: 'Really? This cannot be undone.', es: '¬øDe verdad? Esto no se puede deshacer.' },
  // Puff tracker
  'puff.tracking': { en: 'Tracking phase ‚Äî just count honestly. Your average becomes the baseline.', es: 'Fase de seguimiento ‚Äî solo cuenta honestamente. Tu promedio se convierte en la base.' },
  'puff.target': { en: "Today's target: ", es: 'Meta de hoy: ' },
  'puff.orFewer': { en: ' puffs or fewer', es: ' caladas o menos' },
  'puff.onTrack': { en: " ‚Äî You're on track!", es: ' ‚Äî ¬°Vas por buen camino!' },
  // Milestones
  'milestone.unlocked': { en: 'Unlocked!', es: '¬°Desbloqueado!' },
  // Week days
  'days.mon': { en: 'Mon', es: 'Lun' },
  'days.tue': { en: 'Tue', es: 'Mar' },
  'days.wed': { en: 'Wed', es: 'Mi√©' },
  'days.thu': { en: 'Thu', es: 'Jue' },
  'days.fri': { en: 'Fri', es: 'Vie' },
  'days.sat': { en: 'Sat', es: 'S√°b' },
  'days.sun': { en: 'Sun', es: 'Dom' },
  // Breath phases
  'breath.in': { en: 'Breathe In', es: 'Inhala' },
  'breath.hold': { en: 'Hold', es: 'Mant√©n' },
  'breath.out': { en: 'Breathe Out', es: 'Exhala' },
  // Badges
  'badge.earned': { en: 'Earned!', es: '¬°Ganado!' },
  'badge.locked': { en: 'Locked', es: 'Bloqueado' },
  // Plan table
  'plan.r1.goal': { en: 'Track baseline', es: 'Registrar base' },
  'plan.r1.strategy': { en: 'Count every puff. No reduction yet ‚Äî just observe.', es: 'Cuenta cada calada. Sin reducci√≥n a√∫n ‚Äî solo observa.' },
  'plan.r1.phase': { en: 'Awareness', es: 'Consciencia' },
  'plan.r2.goal': { en: 'Reduce 25%', es: 'Reducir 25%' },
  'plan.r2.strategy': { en: 'If you average 40 puffs/day, target 30. Cut the "automatic" ones first.', es: 'Si promedias 40 caladas/d√≠a, apunta a 30. Elimina las "autom√°ticas" primero.' },
  'plan.r2.phase': { en: 'Reduce', es: 'Reducir' },
  'plan.r3.goal': { en: 'Reduce 50%', es: 'Reducir 50%' },
  'plan.r3.strategy': { en: 'Target half your baseline. Add 10-min delays before each session.', es: 'Apunta a la mitad de tu base. Agrega retrasos de 10 min antes de cada sesi√≥n.' },
  'plan.r4.goal': { en: 'Reduce 75%', es: 'Reducir 75%' },
  'plan.r4.strategy': { en: 'Vape only at designated times (after meals, before bed). Max 3 sessions/day.', es: 'Vapea solo en tiempos designados (despu√©s de comer, antes de dormir). M√°x 3 sesiones/d√≠a.' },
  'plan.r4.phase': { en: 'Structure', es: 'Estructura' },
  'plan.r5.goal': { en: '1-2x per day', es: '1-2x por d√≠a' },
  'plan.r5.strategy': { en: 'Only vape once or twice. Use NRT gum for breakthroughs.', es: 'Solo vapea una o dos veces. Usa chicle de nicotina para emergencias.' },
  'plan.r6.goal': { en: 'Zero', es: 'Cero' },
  'plan.r6.strategy': { en: "Full stop. Use every tool in this app. You're ready.", es: 'Alto total. Usa cada herramienta en esta app. Est√°s listo/a.' },
  'plan.r6.phase': { en: 'Freedom', es: 'Libertad' },
};

// Bilingual arrays
const dailyTasksI18n = {
  en: [
    "I stayed at or below my puff target today",
    "I used a replacement (gum, mint, fidget) instead of vaping at least once",
    "I did a breathing exercise",
    "I moved my body for 10+ minutes",
    "I identified a trigger and chose a different response",
    "I drank plenty of water today",
    "I'm proud of myself for trying ‚Äî even if today wasn't perfect"
  ],
  es: [
    "Me mantuve en o por debajo de mi meta de caladas hoy",
    "Us√© un sustituto (chicle, menta, fidget) en vez de vapear al menos una vez",
    "Hice un ejercicio de respiraci√≥n",
    "Mov√≠ mi cuerpo por 10+ minutos",
    "Identifiqu√© un disparador y eleg√≠ una respuesta diferente",
    "Tom√© suficiente agua hoy",
    "Estoy orgulloso/a de m√≠ por intentarlo ‚Äî aunque hoy no fue perfecto"
  ]
};

const setupTasksI18n = {
  en: [
    "Write down 3 personal reasons for quitting",
    "Set your start date (today counts!)",
    "Buy oral substitutes: strong mints, gum, toothpicks",
    "Get a fidget (stress ball, spinner ring, or worry stone)",
    "Consider buying nicotine gum/lozenges for breakthrough cravings",
    "Tell one person about your goal",
    "Remove the vape from your nightstand / easy-access spots"
  ],
  es: [
    "Escribe 3 razones personales para dejar",
    "Establece tu fecha de inicio (¬°hoy cuenta!)",
    "Compra sustitutos orales: mentas fuertes, chicle, palillos",
    "Consigue un fidget (pelota antiestr√©s, anillo giratorio o piedra)",
    "Considera comprar chicle/pastillas de nicotina para antojos fuertes",
    "Dile a una persona sobre tu meta",
    "Retira el vape de tu mesita de noche / lugares de f√°cil acceso"
  ]
};

const triggersI18n = {
  en: [
    "After eating a meal", "First thing in the morning", "While driving",
    "When feeling anxious or stressed", "During social events / parties",
    "When drinking alcohol", "When bored / scrolling phone", "Before bed",
    "During work breaks", "After an argument or conflict", "When seeing others vape"
  ],
  es: [
    "Despu√©s de comer", "Al despertar", "Mientras conduzco",
    "Cuando me siento ansioso/a o estresado/a", "En eventos sociales / fiestas",
    "Cuando tomo alcohol", "Cuando estoy aburrido/a / viendo el celular", "Antes de dormir",
    "En descansos del trabajo", "Despu√©s de una discusi√≥n o conflicto", "Cuando veo a otros vapear"
  ]
};

const milestonesI18n = {
  en: [
    { hours: 1, icon: 'üíì', title: 'Heart rate normalizing', desc: 'Heart rate and blood pressure begin dropping.' },
    { hours: 8, icon: 'ü´Å', title: 'Oxygen levels recover', desc: 'Carbon monoxide clears. Oxygen returns to normal.' },
    { hours: 24, icon: 'üßπ', title: 'Lungs start clearing', desc: 'Lungs begin clearing mucus and debris.' },
    { hours: 48, icon: 'üëÉ', title: 'Taste & smell return', desc: 'Nerve endings regrow. Food tastes amazing again.' },
    { hours: 72, icon: '‚ö°', title: 'Breathing easier', desc: 'Bronchial tubes relax. Energy levels rise.' },
    { hours: 336, icon: 'üõ°Ô∏è', title: 'Immune boost (2 weeks)', desc: 'Circulation improves. Immune function strengthens.' },
    { hours: 720, icon: 'üß†', title: 'Anxiety decreases (1 month)', desc: 'Baseline anxiety drops to non-smoker levels.' },
    { hours: 2160, icon: 'üí™', title: 'Lung function +30% (3 months)', desc: 'Lung capacity significantly improved.' },
  ],
  es: [
    { hours: 1, icon: 'üíì', title: 'Ritmo card√≠aco normaliz√°ndose', desc: 'El ritmo card√≠aco y la presi√≥n arterial comienzan a bajar.' },
    { hours: 8, icon: 'ü´Å', title: 'Niveles de ox√≠geno se recuperan', desc: 'El mon√≥xido de carbono se elimina. El ox√≠geno vuelve a la normalidad.' },
    { hours: 24, icon: 'üßπ', title: 'Los pulmones empiezan a limpiarse', desc: 'Los pulmones comienzan a eliminar mucosidad y residuos.' },
    { hours: 48, icon: 'üëÉ', title: 'El gusto y olfato regresan', desc: 'Las terminaciones nerviosas se regeneran. La comida sabe incre√≠ble otra vez.' },
    { hours: 72, icon: '‚ö°', title: 'Respirar es m√°s f√°cil', desc: 'Los tubos bronquiales se relajan. Los niveles de energ√≠a suben.' },
    { hours: 336, icon: 'üõ°Ô∏è', title: 'Impulso inmunol√≥gico (2 semanas)', desc: 'La circulaci√≥n mejora. La funci√≥n inmune se fortalece.' },
    { hours: 720, icon: 'üß†', title: 'La ansiedad disminuye (1 mes)', desc: 'La ansiedad base baja a niveles de no fumador.' },
    { hours: 2160, icon: 'üí™', title: 'Funci√≥n pulmonar +30% (3 meses)', desc: 'La capacidad pulmonar mejora significativamente.' },
  ]
};

const motivBannersI18n = {
  en: [
    { text: "Every craving you survive is a <strong>neural pathway getting weaker</strong>. You are literally rewiring your brain right now.", sub: "Neuroscience backs this ‚Äî it's not just motivation, it's biology." },
    { text: "You are not giving something up. You are <strong>getting yourself back</strong>.", sub: "The calm, present, un-addicted version of you is already emerging." },
    { text: "The anxiety you feel isn't you ‚Äî it's <strong>nicotine withdrawal pretending to be you</strong>.", sub: "Real you is calmer. You'll meet that person soon." },
    { text: "People who quit nicotine see anxiety drop to <strong>the same level as taking medication</strong>.", sub: "Taylor et al., 2014 ‚Äî this is published, peer-reviewed science." },
    { text: "The craving you're fighting right now will <strong>last 3-5 minutes</strong>. Your freedom lasts forever.", sub: "Set a timer. You'll be shocked how fast it passes." },
    { text: "You didn't come this far to <strong>only come this far</strong>.", sub: "Look at your stats above. That's real progress. That's you." },
    { text: "A bad day doesn't erase a good week. <strong>Progress isn't linear</strong> ‚Äî and that's okay.", sub: "The overall trend is what matters. Keep showing up." },
    { text: "Your lungs are healing <strong>right now</strong>, even as you read this.", sub: "Your body wants to recover. You just have to let it." },
    { text: "The version of you who started this journey would be <strong>proud of today's you</strong>.", sub: "Don't forget to celebrate how far you've come." },
    { text: "Discipline isn't about perfection. It's about <strong>getting back up one more time than you fall</strong>.", sub: "Every day you try is a day you win." },
    { text: "In 3 months, you'll look back and be <strong>grateful you didn't quit quitting</strong>.", sub: "Future you is counting on present you. Don't let them down." },
    { text: "You are stronger than a <strong>3-minute craving</strong>. You've survived harder things.", sub: "This feeling is temporary. Your strength is not." },
  ],
  es: [
    { text: "Cada antojo que superas es una <strong>v√≠a neuronal debilit√°ndose</strong>. Literalmente est√°s reconfigurando tu cerebro ahora mismo.", sub: "La neurociencia lo respalda ‚Äî no es solo motivaci√≥n, es biolog√≠a." },
    { text: "No est√°s renunciando a algo. Est√°s <strong>recuper√°ndote a ti mismo/a</strong>.", sub: "La versi√≥n tranquila, presente y libre de adicci√≥n de ti ya est√° emergiendo." },
    { text: "La ansiedad que sientes no eres t√∫ ‚Äî es la <strong>abstinencia de nicotina pretendiendo ser t√∫</strong>.", sub: "El verdadero t√∫ es m√°s tranquilo/a. Pronto conocer√°s a esa persona." },
    { text: "Las personas que dejan la nicotina ven su ansiedad bajar al <strong>mismo nivel que tomar medicaci√≥n</strong>.", sub: "Taylor et al., 2014 ‚Äî esto es ciencia publicada y revisada por pares." },
    { text: "El antojo contra el que luchas ahora <strong>durar√° 3-5 minutos</strong>. Tu libertad dura para siempre.", sub: "Pon un temporizador. Te sorprender√° lo r√°pido que pasa." },
    { text: "No llegaste hasta aqu√≠ para <strong>solo llegar hasta aqu√≠</strong>.", sub: "Mira tus estad√≠sticas arriba. Eso es progreso real. Eso eres t√∫." },
    { text: "Un mal d√≠a no borra una buena semana. <strong>El progreso no es lineal</strong> ‚Äî y est√° bien.", sub: "La tendencia general es lo que importa. Sigue present√°ndote." },
    { text: "Tus pulmones se est√°n sanando <strong>ahora mismo</strong>, mientras lees esto.", sub: "Tu cuerpo quiere recuperarse. Solo tienes que dejarlo." },
    { text: "La versi√≥n de ti que empez√≥ este viaje estar√≠a <strong>orgullosa del t√∫ de hoy</strong>.", sub: "No olvides celebrar lo lejos que has llegado." },
    { text: "La disciplina no se trata de perfecci√≥n. Se trata de <strong>levantarte una vez m√°s de las que caes</strong>.", sub: "Cada d√≠a que intentas es un d√≠a que ganas." },
    { text: "En 3 meses, mirar√°s atr√°s y estar√°s <strong>agradecido/a de no haber dejado de intentar</strong>.", sub: "El t√∫ del futuro cuenta con el t√∫ del presente. No lo decepciones." },
    { text: "Eres m√°s fuerte que un <strong>antojo de 3 minutos</strong>. Has sobrevivido cosas m√°s dif√≠ciles.", sub: "Este sentimiento es temporal. Tu fuerza no lo es." },
  ]
};

const nameInsertsI18n = {
  en: ['{name}, remember: ', 'Hey {name} ‚Äî ', '{name}, listen: ', '{name}, ', "You've got this, {name}. "],
  es: ['{name}, recuerda: ', 'Oye {name} ‚Äî ', '{name}, escucha: ', '{name}, ', 'T√∫ puedes, {name}. ']
};

const quotesI18n = {
  en: [
    "You don't have to be fearless. You just have to be <strong>brave enough to start</strong>.",
    "Every craving you resist makes the next one <strong>weaker</strong>. That's not motivation ‚Äî that's <strong>neuroscience</strong>.",
    "The discomfort is temporary. The freedom is <strong>permanent</strong>.",
    "You're not giving something up ‚Äî you're <strong>getting yourself back</strong>.",
    "Anxiety lies. It says you can't do this. But here you are, <strong>doing it anyway</strong>.",
    "Progress isn't linear. A bad day doesn't erase <strong>a good week</strong>.",
    "Your lungs are healing <strong>right now</strong>, as you read this.",
    "The version of you who started this would be <strong>so proud of today's you</strong>.",
    "Small steps still move you <strong>forward</strong>.",
    "You didn't come this far to <strong>only come this far</strong>.",
    "Courage isn't the absence of fear. It's <strong>acting in spite of it</strong>.",
    "3 months from now, you'll wish you had <strong>started today</strong>. Oh wait ‚Äî you did.",
    "You are not your addiction. You are the person <strong>fighting it</strong>.",
    "The only person you need to be better than is <strong>who you were yesterday</strong>.",
    "Some days the mountain seems impossible. But you're already <strong>climbing it</strong>.",
  ],
  es: [
    "No tienes que ser valiente. Solo tienes que ser <strong>lo suficientemente valiente para empezar</strong>.",
    "Cada antojo que resistes hace al siguiente <strong>m√°s d√©bil</strong>. Eso no es motivaci√≥n ‚Äî es <strong>neurociencia</strong>.",
    "La incomodidad es temporal. La libertad es <strong>permanente</strong>.",
    "No est√°s renunciando a algo ‚Äî est√°s <strong>recuper√°ndote a ti mismo/a</strong>.",
    "La ansiedad miente. Dice que no puedes. Pero aqu√≠ est√°s, <strong>haci√©ndolo de todos modos</strong>.",
    "El progreso no es lineal. Un mal d√≠a no borra <strong>una buena semana</strong>.",
    "Tus pulmones se est√°n sanando <strong>ahora mismo</strong>, mientras lees esto.",
    "La versi√≥n de ti que empez√≥ esto estar√≠a <strong>muy orgullosa del t√∫ de hoy</strong>.",
    "Los pasos peque√±os igual te mueven <strong>hacia adelante</strong>.",
    "No llegaste hasta aqu√≠ para <strong>solo llegar hasta aqu√≠</strong>.",
    "El coraje no es la ausencia de miedo. Es <strong>actuar a pesar de √©l</strong>.",
    "En 3 meses, desear√°s haber <strong>empezado hoy</strong>. Ah espera ‚Äî ya lo hiciste.",
    "No eres tu adicci√≥n. Eres la persona que <strong>lucha contra ella</strong>.",
    "La √∫nica persona que necesitas superar es <strong>quien eras ayer</strong>.",
    "Algunos d√≠as la monta√±a parece imposible. Pero ya la est√°s <strong>escalando</strong>.",
  ]
};

const badgesI18n = {
  en: [
    { icon: 'üå±', title: 'Journey Started', desc: 'You took the hardest step ‚Äî the first one.' },
    { icon: '‚òÄÔ∏è', title: 'Day One', desc: 'Your first full day on the plan.' },
    { icon: 'üî•', title: 'Three Day Streak', desc: 'The first 72 hours are the hardest. You did it.' },
    { icon: '‚≠ê', title: 'One Week Strong', desc: '7 days of commitment. This is real.' },
    { icon: 'üéØ', title: 'Two Weeks', desc: 'Officially through the awareness phase.' },
    { icon: 'üèÜ', title: 'One Month', desc: 'Your brain is actively rewiring. Anxiety is dropping.' },
    { icon: 'üíé', title: 'Two Months', desc: "Nicotine receptors are downregulating. You're changing." },
    { icon: 'üëë', title: 'Plan Complete', desc: "12 weeks. You conquered it. You're free." },
    { icon: 'üìù', title: 'Consistent Tracker', desc: '7 daily check-ins. Awareness is your superpower.' },
    { icon: 'üí™', title: 'Craving Crusher', desc: '10 cravings beaten. Each one made you stronger.' },
    { icon: 'ü¶Å', title: 'Unstoppable', desc: '50 cravings defeated. You are a force.' },
    { icon: 'üßò', title: 'Zen Master', desc: '20 breathing rounds. Your nervous system thanks you.' },
    { icon: '‚úçÔ∏è', title: 'Reflective Mind', desc: '5 journal entries. Self-awareness is healing.' },
    { icon: 'üìñ', title: 'Storyteller', desc: "20 entries. You're writing the story of your freedom." },
  ],
  es: [
    { icon: 'üå±', title: 'Viaje Iniciado', desc: 'Diste el paso m√°s dif√≠cil ‚Äî el primero.' },
    { icon: '‚òÄÔ∏è', title: 'D√≠a Uno', desc: 'Tu primer d√≠a completo en el plan.' },
    { icon: 'üî•', title: 'Racha de Tres D√≠as', desc: 'Las primeras 72 horas son las m√°s dif√≠ciles. Lo lograste.' },
    { icon: '‚≠ê', title: 'Una Semana Fuerte', desc: '7 d√≠as de compromiso. Esto es real.' },
    { icon: 'üéØ', title: 'Dos Semanas', desc: 'Oficialmente pasaste la fase de consciencia.' },
    { icon: 'üèÜ', title: 'Un Mes', desc: 'Tu cerebro se est√° reconfigurando activamente. La ansiedad est√° bajando.' },
    { icon: 'üíé', title: 'Dos Meses', desc: 'Los receptores de nicotina se est√°n regulando a la baja. Est√°s cambiando.' },
    { icon: 'üëë', title: 'Plan Completado', desc: '12 semanas. Lo conquistaste. Eres libre.' },
    { icon: 'üìù', title: 'Tracker Consistente', desc: '7 check-ins diarios. La consciencia es tu superpoder.' },
    { icon: 'üí™', title: 'Destructor de Antojos', desc: '10 antojos vencidos. Cada uno te hizo m√°s fuerte.' },
    { icon: 'ü¶Å', title: 'Imparable', desc: '50 antojos derrotados. Eres una fuerza.' },
    { icon: 'üßò', title: 'Maestro Zen', desc: '20 rondas de respiraci√≥n. Tu sistema nervioso te lo agradece.' },
    { icon: '‚úçÔ∏è', title: 'Mente Reflexiva', desc: '5 entradas de diario. La autoconciencia es sanaci√≥n.' },
    { icon: 'üìñ', title: 'Narrador/a', desc: '20 entradas. Est√°s escribiendo la historia de tu libertad.' },
  ]
};

const timelinePhasesI18n = {
  en: [
    { w: 0, label: 'Awareness', desc: 'Track every puff. Build self-awareness. Prepare your tools.' },
    { w: 2, label: 'First Cut (-25%)', desc: 'Eliminate the automatic, mindless puffs first.' },
    { w: 4, label: 'Half Way (-50%)', desc: 'Down to half. Add 10-min delays. Use replacements.' },
    { w: 6, label: 'Structured Use (-75%)', desc: 'Designated times only. Max 3 sessions per day.' },
    { w: 8, label: 'Almost Free (1-2/day)', desc: 'Once or twice daily. NRT for breakthroughs.' },
    { w: 10, label: 'Full Stop', desc: 'Zero puffs. Every tool in this app is ready for you.' },
    { w: 12, label: 'Freedom', desc: "You did it. The hardest thing you've ever done. Maintain & celebrate." },
  ],
  es: [
    { w: 0, label: 'Consciencia', desc: 'Registra cada calada. Construye autoconciencia. Prepara tus herramientas.' },
    { w: 2, label: 'Primer Corte (-25%)', desc: 'Elimina primero las caladas autom√°ticas e inconscientes.' },
    { w: 4, label: 'A la Mitad (-50%)', desc: 'Reducido a la mitad. Agrega retrasos de 10 min. Usa reemplazos.' },
    { w: 6, label: 'Uso Estructurado (-75%)', desc: 'Solo en tiempos designados. M√°x 3 sesiones por d√≠a.' },
    { w: 8, label: 'Casi Libre (1-2/d√≠a)', desc: 'Una o dos veces al d√≠a. Chicle de nicotina para emergencias.' },
    { w: 10, label: 'Alto Total', desc: 'Cero caladas. Cada herramienta en esta app est√° lista para ti.' },
    { w: 12, label: 'Libertad', desc: 'Lo lograste. Lo m√°s dif√≠cil que has hecho. Mant√©n y celebra.' },
  ]
};

// ===== UTILS =====
function daysBetween(a, b) {
  return Math.floor((new Date(b) - new Date(a)) / 86400000);
}
function today() { return new Date().toISOString().split('T')[0]; }
function currentWeek() { return daysBetween(data.startDate, today()) / 7; }

function getPhase() {
  const w = currentWeek();
  if (w < 2) return { name: 'Track', color: 'var(--accent)' };
  if (w < 4) return { name: '-25%', color: 'var(--orange)' };
  if (w < 6) return { name: '-50%', color: 'var(--orange)' };
  if (w < 8) return { name: '-75%', color: 'var(--teal)' };
  if (w < 10) return { name: '1-2/day', color: 'var(--teal)' };
  if (w < 12) return { name: 'Free!', color: 'var(--green)' };
  return { name: 'Done!', color: 'var(--green)' };
}

function getTargetPuffs() {
  const w = currentWeek();
  const b = data.baselinePuffs;
  if (w < 2) return b;
  if (w < 4) return Math.round(b * 0.75);
  if (w < 6) return Math.round(b * 0.5);
  if (w < 8) return Math.round(b * 0.25);
  if (w < 10) return Math.round(b * 0.1);
  return 0;
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== MOTIVATIONAL BANNERS =====
// motivBanners now in motivBannersI18n above

function showMotivBanner() {
  const dayIdx = daysBetween(data.startDate, today());
  const banners = motivBannersI18n[data.lang] || motivBannersI18n.en;
  const b = banners[dayIdx % banners.length];
  const name = data.userName;
  let text = b.text;
  let sub = b.sub;
  if (name) {
    const inserts = nameInsertsI18n[data.lang] || nameInsertsI18n.en;
    const insert = inserts[dayIdx % inserts.length].replace('{name}', name);
    text = insert + text.charAt(0).toLowerCase() + text.slice(1);
  }
  document.getElementById('motivText').innerHTML = text;
  document.getElementById('motivSub').textContent = sub;
}

// ===== STATS =====
function updateStats() {
  const days = Math.max(0, daysBetween(data.startDate, today()));
  document.getElementById('daysFree').textContent = days;
  const saved = days * data.costPerDay;
  const formatted = saved >= 1000 ? Math.round(saved).toLocaleString() : saved;
  document.getElementById('moneySaved').textContent = (data.currency || '$') + formatted;
  document.getElementById('cravingsBeaten').textContent = data.cravingsBeaten;
  const phase = getPhase();
  const el = document.getElementById('currentPhase');
  el.textContent = phase.name;
  el.style.color = phase.color;
}

// ===== NAV =====
function showPanel(name, btn) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name === 'progress') { renderChart(); renderSetbackLog(); renderHistory(); }
}

// ===== WEEK GRID =====
function renderWeek() {
  const grid = document.getElementById('weekGrid');
  grid.innerHTML = '';
  const now = new Date();
  const dow = now.getDay();
  const mon = new Date(now);
  mon.setDate(now.getDate() - ((dow + 6) % 7));
  const names = [t('days.mon'),t('days.tue'),t('days.wed'),t('days.thu'),t('days.fri'),t('days.sat'),t('days.sun')];
  for (let i = 0; i < 7; i++) {
    const d = new Date(mon);
    d.setDate(mon.getDate() + i);
    const key = d.toISOString().split('T')[0];
    const el = document.createElement('div');
    el.className = 'week-day' + (key === today() ? ' today' : '') + (data.dailyCheckins[key] ? ' logged' : '');
    el.innerHTML = `<span class="day-name">${names[i]}</span><span class="day-num">${d.getDate()}</span>`;
    grid.appendChild(el);
  }
}

// ===== PUFF TRACKER =====
function renderPuffCounter() {
  const td = data.dailyCheckins[today()];
  const count = td ? (td.puffs || 0) : 0;
  document.getElementById('puffCount').textContent = count;
  const target = getTargetPuffs();
  const baseline = data.baselinePuffs || 0;
  const w = currentWeek();
  // Show baseline reference next to count
  document.getElementById('puffBaseline').textContent = baseline > 0 ? ` / ${baseline}` : '';
  if (w < 2) {
    document.getElementById('puffTarget').innerHTML = t('puff.tracking');
  } else {
    document.getElementById('puffTarget').innerHTML = t('puff.target') + `<strong>${target}${t('puff.orFewer')}</strong>` + (count <= target ? t('puff.onTrack') : '');
  }
}

function changePuffs(delta) {
  const key = today();
  if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
  data.dailyCheckins[key].puffs = Math.max(0, (data.dailyCheckins[key].puffs || 0) + delta);
  saveData(data);
  renderPuffCounter();
}

// ===== DAILY CHECKIN =====
// dailyTasks now in dailyTasksI18n above

function renderCheckin() {
  const grid = document.getElementById('checkinGrid');
  grid.innerHTML = '';
  const td = data.dailyCheckins[today()] || {};
  const dailyTasks = dailyTasksI18n[data.lang] || dailyTasksI18n.en;
  dailyTasks.forEach((task, i) => {
    const checked = td.tasks && td.tasks[i];
    const el = document.createElement('div');
    el.className = 'checkin-item' + (checked ? ' checked' : '');
    el.innerHTML = `<div class="check-circle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><span class="checkin-text">${task}</span>`;
    el.onclick = () => {
      const key = today();
      if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
      data.dailyCheckins[key].tasks[i] = !data.dailyCheckins[key].tasks[i];
      saveData(data);
      renderCheckin();
    };
    grid.appendChild(el);
  });
}

function saveDailyCheckin() {
  const key = today();
  if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
  data.dailyCheckins[key].anxiety = parseInt(document.getElementById('anxietySlider').value);
  data.dailyCheckins[key].craving = parseInt(document.getElementById('cravingSlider').value);
  saveData(data);
  renderWeek();
  updateStats();
  // Calculate baseline from first 14 days
  const entries = Object.entries(data.dailyCheckins).sort((a,b) => a[0].localeCompare(b[0]));
  if (entries.length >= 3 && currentWeek() < 2) {
    const avg = Math.round(entries.reduce((s,e) => s + (e[1].puffs || 0), 0) / entries.length);
    if (avg > 0) { data.baselinePuffs = avg; saveData(data); }
  }
  const nm = data.userName;
  showToast(nm ? t('toast.checkinSavedName') + nm + '.' : t('toast.checkinSaved'));
}

// ===== SETUP CHECKLIST =====
// setupTasks now in setupTasksI18n above

function renderSetup() {
  const grid = document.getElementById('setupChecklist');
  grid.innerHTML = '';
  const setupTasks = setupTasksI18n[data.lang] || setupTasksI18n.en;
  setupTasks.forEach((task, i) => {
    const checked = data.setupDone[i];
    const el = document.createElement('div');
    el.className = 'checkin-item' + (checked ? ' checked' : '');
    el.innerHTML = `<div class="check-circle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><span class="checkin-text">${task}</span>`;
    el.onclick = () => {
      data.setupDone[i] = !data.setupDone[i];
      saveData(data);
      renderSetup();
    };
    grid.appendChild(el);
  });
}

// ===== TRIGGER CHECKLIST =====
// triggers now in triggersI18n above

function renderTriggers() {
  const grid = document.getElementById('triggerChecklist');
  grid.innerHTML = '';
  const triggers = triggersI18n[data.lang] || triggersI18n.en;
  triggers.forEach((t, i) => {
    const checked = data.triggersDone && data.triggersDone[i];
    const el = document.createElement('div');
    el.className = 'checkin-item' + (checked ? ' checked' : '');
    el.innerHTML = `<div class="check-circle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><span class="checkin-text">${t}</span>`;
    el.onclick = () => {
      if (!data.triggersDone) data.triggersDone = {};
      data.triggersDone[i] = !data.triggersDone[i];
      saveData(data);
      renderTriggers();
    };
    grid.appendChild(el);
  });
}

// ===== BREATHING =====
let breathInterval = null, breathPhase = 0, breathCount = 0, breathRounds = 0;
const BREATH_TARGET_ROUNDS = 4;
function getBreathPhases() { return [t('breath.in'), t('breath.hold'), t('breath.out'), t('breath.hold')]; }
const breathClasses = ['inhale', 'hold-in', 'exhale', 'hold-out'];

function toggleBreathing() {
  breathInterval ? stopBreathing() : startBreathing();
}
function startBreathing() {
  breathPhase = 0; breathCount = 4; breathRounds = 0;
  document.getElementById('breathBtn').textContent = t('breathe.stop');
  updateBreathDisplay();
  document.getElementById('breathRounds').textContent = `0 / ${BREATH_TARGET_ROUNDS}`;
  breathInterval = setInterval(() => {
    breathCount--;
    if (breathCount <= 0) {
      breathPhase = (breathPhase + 1) % 4;
      if (breathPhase === 0) {
        breathRounds++;
        document.getElementById('breathRounds').textContent = `${breathRounds} / ${BREATH_TARGET_ROUNDS}`;
        data.breathRoundsTotal++;
        saveData(data);
        if (breathRounds >= BREATH_TARGET_ROUNDS) {
          stopBreathing();
          showToast(t('toast.sessionComplete') + BREATH_TARGET_ROUNDS + t('toast.breathComplete'));
          return;
        }
      }
      breathCount = 4;
    }
    updateBreathDisplay();
  }, 1000);
}
function updateBreathDisplay() {
  const outer = document.getElementById('breathOuter');
  outer.className = 'breath-circle-outer ' + breathClasses[breathPhase];
  document.getElementById('breathCircle').className = 'breath-circle';
  const textEl = document.getElementById('breathText');
  textEl.textContent = getBreathPhases()[breathPhase];
  textEl.className = 'breath-text pulsing';
  document.getElementById('breathTimer').textContent = breathCount;
}
function stopBreathing() {
  clearInterval(breathInterval); breathInterval = null;
  document.getElementById('breathBtn').textContent = t('breathe.start');
  document.getElementById('breathOuter').className = 'breath-circle-outer';
  document.getElementById('breathCircle').className = 'breath-circle';
  const textEl = document.getElementById('breathText');
  textEl.textContent = t('breathe.ready');
  textEl.className = 'breath-text';
  document.getElementById('breathTimer').textContent = '4:4:4:4';
  if (breathRounds > 0) showToast(breathRounds + t('toast.breathSession'));
}

// ===== SOS =====
function triggerSOS() {
  const tips = document.getElementById('sosTips');
  tips.classList.toggle('visible');
  if (tips.classList.contains('visible')) {
    data.cravingsBeaten++;
    saveData(data);
    updateStats();
  }
}

// ===== JOURNAL =====
function saveJournalEntry() {
  const input = document.getElementById('journalInput');
  const text = input.value.trim();
  if (!text) return;
  data.journal.unshift({ date: new Date().toLocaleString(), text });
  saveData(data);
  input.value = '';
  renderJournal();
  showToast(t('toast.journalSaved'));
}
function renderJournal() {
  const c = document.getElementById('journalEntries');
  c.innerHTML = '';
  data.journal.forEach(e => {
    const el = document.createElement('div');
    el.className = 'journal-entry';
    el.innerHTML = `<div class="date">${e.date}</div><div class="text">${escapeHtml(e.text)}</div>`;
    c.appendChild(el);
  });
}
function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

// ===== MILESTONES =====
// milestones now in milestonesI18n above

function renderMilestones() {
  const c = document.getElementById('milestones');
  c.innerHTML = '';
  const h = daysBetween(data.startDate, today()) * 24;
  const milestones = milestonesI18n[data.lang] || milestonesI18n.en;
  milestones.forEach(m => {
    const pct = Math.min(100, (h / m.hours) * 100);
    const el = document.createElement('div');
    el.className = 'milestone';
    el.innerHTML = `<div class="milestone-bar" style="width:${pct}%"></div><div class="milestone-icon">${m.icon}</div><div class="milestone-info"><h4>${m.title}</h4><p>${m.desc}</p></div><div class="milestone-time">${pct >= 100 ? t('milestone.unlocked') : Math.round(pct) + '%'}</div>`;
    c.appendChild(el);
  });
}

// ===== TIMELINE =====
function renderTimeline() {
  const c = document.getElementById('progressTimeline');
  c.innerHTML = '';
  const w = currentWeek();
  const phases = timelinePhasesI18n[data.lang] || timelinePhasesI18n.en;
  phases.forEach((p, i) => {
    const status = w >= (phases[i+1]?.w ?? Infinity) ? 'completed' : (w >= p.w && (i === phases.length - 1 || w < phases[i+1].w) ? 'current' : '');
    const el = document.createElement('div');
    el.className = 'timeline-item ' + status;
    el.innerHTML = `<div class="timeline-dot">${status === 'completed' ? '‚úì' : (i+1)}</div><div class="timeline-content"><h4>Week ${p.w === 0 ? '1-2' : p.w + '-' + (p.w+2)} ‚Äî ${p.label}</h4><p>${p.desc}</p></div>`;
    c.appendChild(el);
  });
}

// ===== CHART =====
function renderChart() {
  const canvas = document.getElementById('trendChart');
  if (!canvas || !canvas.parentElement) return;
  const ctx = canvas.getContext('2d');
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width - 56;
  canvas.height = 200;
  const entries = Object.entries(data.dailyCheckins).sort((a,b) => a[0].localeCompare(b[0])).slice(-14);
  if (entries.length < 2) {
    ctx.fillStyle = '#8c87a0';
    ctx.font = '14px Inter, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(t('progress.chartEmpty'), canvas.width/2, 100);
    return;
  }
  const ww = canvas.width, hh = canvas.height;
  const pad = { top: 20, bottom: 30, left: 10, right: 10 };
  const pw = ww - pad.left - pad.right, ph = hh - pad.top - pad.bottom;
  ctx.strokeStyle = 'rgba(0,0,0,0.05)';
  for (let i = 0; i <= 10; i += 2) {
    const y = pad.top + ph - (i/10) * ph;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(ww - pad.right, y); ctx.stroke();
  }
  function drawLine(vals, color) {
    ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = 2.5; ctx.lineJoin = 'round';
    vals.forEach((v, i) => {
      const x = pad.left + (i / (vals.length - 1)) * pw;
      const y = pad.top + ph - (v / 10) * ph;
      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    });
    ctx.stroke();
    vals.forEach((v, i) => {
      const x = pad.left + (i / (vals.length - 1)) * pw;
      const y = pad.top + ph - (v / 10) * ph;
      ctx.beginPath(); ctx.arc(x, y, 4, 0, Math.PI * 2); ctx.fillStyle = color; ctx.fill();
    });
  }
  drawLine(entries.map(e => e[1].craving || 5), '#db2777');
  drawLine(entries.map(e => e[1].anxiety || 5), '#16a34a');
  ctx.font = '12px Inter, sans-serif';
  ctx.fillStyle = '#db2777'; ctx.fillText(t('progress.cravings'), ww - 160, hh - 6);
  ctx.fillStyle = '#16a34a'; ctx.fillText(t('progress.anxiety'), ww - 70, hh - 6);
  ctx.fillStyle = '#8c87a0'; ctx.font = '10px Inter, sans-serif'; ctx.textAlign = 'center';
  entries.forEach((e, i) => {
    if (i % Math.ceil(entries.length / 7) === 0 || i === entries.length - 1) {
      const x = pad.left + (i / (entries.length - 1)) * pw;
      ctx.fillText(e[0].slice(5), x, hh - 6);
    }
  });
}

// ===== ACHIEVEMENTS =====
function renderAchievements() {
  const c = document.getElementById('achievements');
  c.innerHTML = '';
  const days = daysBetween(data.startDate, today());
  const checkins = Object.keys(data.dailyCheckins).length;
  const badgeTexts = badgesI18n[data.lang] || badgesI18n.en;
  const conditions = [true, days >= 1, days >= 3, days >= 7, days >= 14, days >= 30, days >= 60, days >= 84, checkins >= 7, data.cravingsBeaten >= 10, data.cravingsBeaten >= 50, data.breathRoundsTotal >= 20, data.journal.length >= 5, data.journal.length >= 20];
  const badges = badgeTexts.map((b, i) => ({ ...b, cond: conditions[i] }));
  badges.forEach(b => {
    const el = document.createElement('div');
    el.className = 'milestone';
    el.style.opacity = b.cond ? '1' : '0.3';
    el.innerHTML = `<div class="milestone-icon">${b.icon}</div><div class="milestone-info"><h4>${b.title}</h4><p>${b.desc}</p></div><div class="milestone-time" style="color:${b.cond ? 'var(--green)' : 'var(--text-dim)'}">${b.cond ? t('badge.earned') : t('badge.locked')}</div>`;
    c.appendChild(el);
  });
}

// ===== QUOTES =====
// quotes now in quotesI18n above

function showQuote() {
  const quotes = quotesI18n[data.lang] || quotesI18n.en;
  const idx = Math.floor(Math.random() * quotes.length);
  document.getElementById('quoteBar').innerHTML = '"' + quotes[idx] + '"';
}

// ===== SETTINGS =====
function setCurrency(symbol, code) {
  data.currency = symbol;
  data.currencyCode = code;
  document.getElementById('currencyLabel').textContent = symbol;
  document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

function saveSettings() {
  const name = document.getElementById('userName').value.trim();
  data.userName = name;
  const weekly = parseFloat(document.getElementById('weeklySpend').value);
  if (weekly && weekly > 0) {
    data.weeklySpend = weekly;
    data.costPerDay = Math.round((weekly / 7) * 100) / 100;
  }
  const baseline = parseInt(document.getElementById('baselinePuffsInput').value);
  if (baseline && baseline > 0) {
    data.baselinePuffs = baseline;
  }
  saveData(data);
  updateStats();
  updatePersonalization();
  renderPuffCounter();
  showMotivBanner();
  showToast(name ? t('toast.settingsSavedName') + name + '.' : t('toast.settingsSaved'));
}

function loadSettings() {
  if (data.userName) document.getElementById('userName').value = data.userName;
  if (data.weeklySpend) document.getElementById('weeklySpend').value = data.weeklySpend;
  if (data.baselinePuffs) document.getElementById('baselinePuffsInput').value = data.baselinePuffs;
  document.getElementById('currencyLabel').textContent = data.currency || '$';
  document.querySelectorAll('.currency-btn:not(.lang-btn)').forEach(b => {
    if (b.textContent.includes(data.currencyCode || 'USD')) b.classList.add('active');
  });
  updatePersonalization();
  applyLanguage();
}

function updatePersonalization() {
  const name = data.userName;
  const headerSub = document.querySelector('.header p');
  if (name) {
    headerSub.textContent = name + t('app.subtitle.name');
  } else {
    headerSub.textContent = t('app.subtitle');
  }
}

// ===== LANGUAGE =====
function setLanguage(lang) {
  data.lang = lang;
  saveData(data);
  applyLanguage();
}

function applyLanguage() {
  document.documentElement.lang = data.lang;
  // Update data-i18n elements (plain text)
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  // Update data-i18n-html elements (rich text with <strong> etc)
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    el.innerHTML = t(el.dataset.i18nHtml);
  });
  // Update placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.dataset.i18nPlaceholder);
  });
  // Highlight active language button
  document.querySelectorAll('.lang-btn').forEach(b => {
    b.classList.toggle('active', (b.textContent === 'English' && data.lang === 'en') || (b.textContent === 'Espa√±ol' && data.lang === 'es'));
  });
  // Re-render all dynamic content
  showMotivBanner();
  updateStats();
  renderWeek();
  renderPuffCounter();
  renderCheckin();
  renderSetup();
  renderTriggers();
  renderMilestones();
  renderTimeline();
  renderAchievements();
  renderChart();
  updatePersonalization();
  showQuote();
}

// ===== RESET =====
function resetApp() {
  if (confirm(t('toast.resetConfirm1'))) {
    if (confirm(t('toast.resetConfirm2'))) {
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    }
  }
}

// ===== INIT =====
function init() {
  showMotivBanner();
  updateStats();
  renderWeek();
  renderPuffCounter();
  renderCheckin();
  renderSetup();
  renderTriggers();
  renderMilestones();
  renderTimeline();
  renderJournal();
  renderAchievements();
  loadSettings();
  showQuote();
  const td = data.dailyCheckins[today()];
  if (td) {
    document.getElementById('anxietySlider').value = td.anxiety || 5;
    document.getElementById('anxietyVal').textContent = td.anxiety || 5;
    document.getElementById('cravingSlider').value = td.craving || 5;
    document.getElementById('cravingVal').textContent = td.craving || 5;
  }
  loadSetbackState();
}
init();
window.addEventListener('resize', renderChart);

// ===== SETBACKS =====
const setbackAffirmations = [
  "You reached out instead of giving up. That's courage.",
  "One hard day doesn't undo everything you've built.",
  "Every person who has ever quit had days like this. You are not alone.",
  "Logging this takes honesty. That honesty is what recovery is made of.",
  "Tomorrow is a fresh start. You're still in this.",
  "The fact that you're logging this means you haven't given up.",
  "Progress isn't a straight line ‚Äî it never has been for anyone.",
  "You noticed. You logged it. That awareness is already the next step forward."
];

function toggleSetbackForm(checked) {
  const form = document.getElementById('setbackForm');
  const affirmEl = document.getElementById('setbackAffirmation');
  if (checked) {
    form.style.display = 'block';
    const idx = Math.floor(Math.random() * setbackAffirmations.length);
    affirmEl.textContent = setbackAffirmations[idx];
  } else {
    form.style.display = 'none';
    affirmEl.textContent = '';
  }
}

function saveSetback() {
  const key = today();
  if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
  data.dailyCheckins[key].setback = true;
  data.dailyCheckins[key].setbackNote = document.getElementById('setbackNote').value.trim();
  saveData(data);
  showToast('Setback logged. You showed up anyway ‚Äî that matters.');
}

function loadSetbackState() {
  const td = data.dailyCheckins[today()];
  if (td && td.setback) {
    document.getElementById('setbackToggle').checked = true;
    document.getElementById('setbackForm').style.display = 'block';
    document.getElementById('setbackNote').value = td.setbackNote || '';
    const idx = Math.floor(Math.random() * setbackAffirmations.length);
    document.getElementById('setbackAffirmation').textContent = setbackAffirmations[idx];
  }
}

// ===== SETBACK LOG =====
function renderSetbackLog() {
  const c = document.getElementById('setbackLog');
  if (!c) return;
  const setbacks = Object.entries(data.dailyCheckins)
    .filter(([, d]) => d.setback)
    .sort((a, b) => b[0].localeCompare(a[0]));
  if (setbacks.length === 0) {
    c.innerHTML = '<p class="history-empty">No setbacks logged yet ‚Äî keep going! üí™</p>';
    return;
  }
  c.innerHTML = '';
  setbacks.forEach(([date, d]) => {
    const el = document.createElement('div');
    el.className = 'setback-entry';
    el.innerHTML =
      '<div class="setback-entry-date">' + formatDate(date) + '</div>' +
      '<div class="setback-entry-puffs">' + (d.puffs || 0) + ' puffs that day</div>' +
      (d.setbackNote ? '<p class="setback-entry-note">"' + d.setbackNote + '"</p>' : '');
    c.appendChild(el);
  });
}

// ===== DAILY HISTORY =====
function renderHistory() {
  const c = document.getElementById('historyLog');
  if (!c) return;
  const entries = Object.entries(data.dailyCheckins)
    .sort((a, b) => b[0].localeCompare(a[0]));
  if (entries.length === 0) {
    c.innerHTML = '<p class="history-empty">No check-ins yet ‚Äî start tracking today!</p>';
    return;
  }
  c.innerHTML = '';
  entries.forEach(([date, d]) => {
    const tasksDone = Object.values(d.tasks || {}).filter(Boolean).length;
    const el = document.createElement('div');
    el.className = 'history-entry' + (d.setback ? ' setback-day' : '');
    el.innerHTML =
      '<div class="history-date-header">' +
        formatDate(date) +
        (d.setback ? ' <span class="setback-badge">setback</span>' : '') +
      '</div>' +
      '<div class="history-stats">' +
        '<div class="history-stat"><span class="stat-label">Puffs</span><span class="stat-val">' + (d.puffs || 0) + '</span></div>' +
        '<div class="history-stat"><span class="stat-label">Anxiety</span><span class="stat-val">' + (d.anxiety || '‚Äî') + '</span></div>' +
        '<div class="history-stat"><span class="stat-label">Craving</span><span class="stat-val">' + (d.craving || '‚Äî') + '</span></div>' +
        '<div class="history-stat"><span class="stat-label">Tasks</span><span class="stat-val">' + tasksDone + '/7</span></div>' +
      '</div>' +
      (d.setbackNote ? '<p class="history-note">"' + d.setbackNote + '"</p>' : '');
    c.appendChild(el);
  });
}

function formatDate(dateStr) {
  const d = new Date(dateStr + 'T12:00:00');
  return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
}

// Register service worker for offline/PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(() => {});
}
</script>
</body>
</html>
