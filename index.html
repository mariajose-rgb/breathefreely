<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BreatheFreely — Your Quit Vaping Journey</title>

<!-- Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="./favicon.png">
<link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">

<!-- PWA -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#2FA39A">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="BreatheFreely">
<link rel="apple-touch-icon" href="./icon-192.png">

<!-- Open Graph for sharing -->
<meta property="og:title" content="BreatheFreely — Quit Vaping Journey">
<meta property="og:description" content="A free, science-backed app to help you quit vaping gradually — with anxiety support, craving tools, and daily tracking.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://mariajose-rgb.github.io/breathefreely/">
<meta property="og:image" content="https://mariajose-rgb.github.io/breathefreely/icon-512.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700&display=swap');

  :root {
    --bg: #F4F9F8;
    --surface: #ffffff;
    --surface2: #eaf4f1;
    --surface3: #d9eeea;
    --accent: #FF7A6E;
    --accent2: #ff9a91;
    --accent-light: #fff0ee;
    --accent-glow: rgba(255,122,110,0.18);
    --green: #3BCB8E;
    --green-light: #d4f5e8;
    --green-bg: #eafaf3;
    --orange: #FFB86B;
    --orange-light: #fff4e0;
    --red: #E57373;
    --red-light: #fce8e8;
    --teal: #2FA39A;
    --teal-light: #d4f0ee;
    --primary: #5ED3B3;
    --primary-light: #e0f7f2;
    --text: #263238;
    --text-mid: #4a616b;
    --text-dim: #7a9099;
    --border: #cde8e4;
    --radius: 20px;
    --shadow: 0 2px 16px rgba(47,163,154,0.08), 0 1px 4px rgba(0,0,0,0.04);
    --shadow-lg: 0 8px 32px rgba(47,163,154,0.14), 0 2px 8px rgba(0,0,0,0.06);
    --glass: #ffffff;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  .app { max-width: 900px; margin: 0 auto; padding: 16px 16px 40px; }

  /* Header */
  .header {
    text-align: center;
    padding: 44px 20px 16px;
  }
  .header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2.6em;
    color: var(--teal);
    margin-bottom: 6px;
    letter-spacing: -0.5px;
  }
  .header p {
    color: var(--text-dim);
    font-size: 1em;
    font-weight: 400;
    letter-spacing: 0.01em;
  }

  /* Motivational banner */
  .motiv-banner {
    background: var(--teal);
    border-radius: var(--radius);
    padding: 22px 24px;
    margin: 16px 0;
    color: white;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 6px 24px rgba(47,163,154,0.28);
  }
  .motiv-banner::before { display: none; }
  .motiv-banner .motiv-text {
    position: relative;
    font-size: 1.15em;
    font-weight: 500;
    line-height: 1.6;
  }
  .motiv-banner .motiv-text strong {
    font-weight: 700;
    text-decoration: underline;
    text-decoration-color: rgba(255,255,255,0.4);
    text-underline-offset: 3px;
  }
  .motiv-sub {
    position: relative;
    font-size: 0.85em;
    opacity: 0.85;
    margin-top: 8px;
  }

  /* Stats bar */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin: 16px 0;
  }
  .stat-card {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.9);
    border-radius: 18px;
    padding: 18px 10px;
    text-align: center;
    transition: all 0.3s;
    box-shadow: var(--shadow);
  }
  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
  .stat-number {
    font-size: 1.8em;
    font-weight: 800;
    color: var(--text);
    line-height: 1;
  }
  .stat-label {
    font-size: 0.65em;
    color: var(--text-dim);
    margin-top: 5px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: 600;
  }
  .stat-card.highlight .stat-number { color: var(--green); }
  .stat-card.accent .stat-number { color: var(--accent); }
  .stat-card.teal .stat-number { color: var(--teal); }

  /* Navigation tabs */
  .nav-tabs {
    display: flex;
    gap: 3px;
    margin: 16px 0;
    background: rgba(255,255,255,0.6);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 18px;
    padding: 5px;
    overflow-x: auto;
    border: 1px solid rgba(255,255,255,0.9);
    box-shadow: var(--shadow);
    scrollbar-width: none;
  }
  .nav-tabs::-webkit-scrollbar { display: none; }
  .nav-tab {
    flex: 1;
    padding: 11px 8px;
    border: none;
    background: none;
    color: var(--text-dim);
    font-family: 'Inter', sans-serif;
    font-size: 0.8em;
    font-weight: 600;
    border-radius: 13px;
    cursor: pointer;
    transition: all 0.25s;
    white-space: nowrap;
  }
  .nav-tab:hover { color: var(--text); background: rgba(255,255,255,0.7); }
  .nav-tab.active {
    background: var(--surface);
    color: var(--accent);
    box-shadow: 0 2px 12px rgba(219,39,119,0.15), 0 1px 3px rgba(0,0,0,0.06);
  }

  /* Panels */
  .panel { display: none; animation: fadeIn 0.4s ease; }
  .panel.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }

  /* Cards */
  .card {
    background: var(--glass);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.9);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 14px;
    box-shadow: var(--shadow);
    transition: box-shadow 0.3s;
  }
  .card h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.3em;
    color: var(--text);
    margin-bottom: 12px;
    letter-spacing: -0.2px;
  }
  .card h3 {
    font-size: 0.95em;
    color: var(--accent);
    margin: 16px 0 10px;
    font-weight: 700;
    letter-spacing: 0.02em;
  }
  .card p, .card li {
    color: var(--text-mid);
    line-height: 1.75;
    font-size: 0.93em;
  }
  .card ul { padding-left: 20px; }
  .card li { margin-bottom: 6px; }
  .card .callout {
    background: var(--green-bg);
    border-left: 4px solid var(--green);
    border-radius: 0 12px 12px 0;
    padding: 16px 20px;
    margin: 16px 0;
    color: #15803d;
    font-weight: 500;
    font-size: 0.95em;
    line-height: 1.6;
  }
  .card .callout-accent {
    background: var(--accent-light);
    border-left: 4px solid var(--accent);
    border-radius: 0 12px 12px 0;
    padding: 16px 20px;
    margin: 16px 0;
    color: #9d174d;
    font-weight: 500;
    font-size: 0.95em;
    line-height: 1.6;
  }

  /* Checkin items */
  .checkin-grid { display: grid; gap: 10px; margin-top: 14px; }
  .checkin-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 16px;
    background: rgba(255,255,255,0.55);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.25s;
    border: 1.5px solid rgba(255,255,255,0.9);
    user-select: none;
  }
  .checkin-item:hover { background: rgba(252,231,243,0.5); border-color: rgba(219,39,119,0.2); }
  .checkin-item.checked {
    border-color: var(--green);
    background: var(--green-bg);
  }
  .check-circle {
    width: 26px; height: 26px;
    border-radius: 50%;
    border: 2px solid var(--text-dim);
    display: flex; align-items: center; justify-content: center;
    transition: all 0.3s;
    flex-shrink: 0;
  }
  .checkin-item.checked .check-circle {
    background: var(--green);
    border-color: var(--green);
  }
  .check-circle svg { opacity: 0; transition: 0.3s; }
  .checkin-item.checked .check-circle svg { opacity: 1; }
  .checkin-text { font-weight: 500; color: var(--text); font-size: 0.92em; }
  .checkin-item.checked .checkin-text { color: var(--green); }

  /* Sliders */
  .slider-group { margin: 18px 0; }
  .slider-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9em;
  }
  .slider-label span:first-child { color: var(--text); font-weight: 600; }
  .slider-label span:last-child { color: var(--accent); font-weight: 800; font-size: 1.2em; }
  input[type="range"] {
    width: 100%;
    -webkit-appearance: none;
    height: 8px;
    border-radius: 4px;
    background: var(--surface3);
    outline: none;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px; height: 24px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    box-shadow: 0 2px 8px var(--accent-glow);
  }

  /* Buttons */
  .btn-primary {
    padding: 13px 28px;
    background: var(--primary);
    border: none;
    border-radius: 50px;
    color: white;
    font-family: 'Inter', sans-serif;
    font-weight: 700;
    font-size: 0.95em;
    cursor: pointer;
    transition: all 0.25s;
    box-shadow: 0 4px 16px rgba(94,211,179,0.3);
    letter-spacing: 0.02em;
    color: #263238;
  }
  .btn-primary:hover { background: #4ec9a8; transform: translateY(-2px); box-shadow: 0 8px 24px rgba(94,211,179,0.35); }
  .btn-primary:active { transform: translateY(0); }
  .btn-full { width: 100%; margin-top: 16px; }

  /* Breathing */
  .breath-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
  }
  .breath-circle-outer {
    width: 220px; height: 220px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    background: var(--primary);
    padding: 4px;
    transition: transform 4s ease-in-out, box-shadow 4s ease-in-out;
  }
  .breath-circle-outer.inhale {
    transform: scale(1.3);
    box-shadow: 0 0 40px rgba(94,211,179,0.3), 0 0 80px rgba(94,211,179,0.15);
  }
  .breath-circle-outer.exhale {
    transform: scale(0.85);
    box-shadow: 0 0 10px rgba(94,211,179,0.2);
  }
  .breath-circle-outer.hold-in {
    transform: scale(1.3);
    animation: holdThrob 1s ease-in-out infinite;
  }
  .breath-circle-outer.hold-out {
    transform: scale(0.85);
    animation: holdThrob 1s ease-in-out infinite;
  }
  @keyframes holdThrob {
    0%, 100% { box-shadow: 0 0 15px rgba(94,211,179,0.25); }
    50% { box-shadow: 0 0 35px rgba(94,211,179,0.35), 0 0 60px rgba(94,211,179,0.15); }
  }
  .breath-circle {
    width: 100%; height: 100%;
    border-radius: 50%;
    background: var(--bg);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
  }
  .breath-text {
    font-size: 1.3em; font-weight: 700; color: var(--text);
    animation: none;
  }
  .breath-text.pulsing { animation: textPulse 1s ease-in-out infinite; }
  @keyframes textPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(0.95); }
  }
  .breath-timer { font-size: 2.5em; font-weight: 800; color: var(--teal); margin-top: 4px; }
  .breath-btn {
    margin-top: 30px;
    padding: 14px 44px;
    background: var(--primary);
    border: none;
    border-radius: 50px;
    color: #263238;
    font-family: 'Inter', sans-serif;
    font-size: 1em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 20px rgba(94,211,179,0.3);
  }
  .breath-btn:hover { background: #4ec9a8; transform: scale(1.05); }
  .breath-rounds { margin-top: 16px; color: var(--text-dim); font-size: 0.9em; }

  /* SOS */
  .sos-btn {
    width: 100%;
    padding: 22px;
    background: var(--accent);
    border: none;
    border-radius: var(--radius);
    color: white;
    font-family: 'Inter', sans-serif;
    font-size: 1.15em;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 20px rgba(255,122,110,0.3);
    margin-bottom: 16px;
    letter-spacing: 0.5px;
  }
  .sos-btn:hover { transform: scale(1.02); box-shadow: 0 6px 30px rgba(255,122,110,0.4); }
  .sos-btn:active { transform: scale(0.98); }
  .sos-tips { display: none; animation: fadeIn 0.5s ease; }
  .sos-tips.visible { display: block; }
  .sos-tip {
    background: rgba(255,255,255,0.6);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 10px;
    display: flex;
    align-items: flex-start;
    gap: 14px;
    border: 1px solid rgba(255,255,255,0.9);
  }
  .sos-tip .icon { display: flex; align-items: center; flex-shrink: 0; }
  .sos-tip h4 { color: var(--text); font-size: 0.95em; margin-bottom: 4px; }
  .sos-tip p { color: var(--text-mid); font-size: 0.85em; line-height: 1.6; }

  /* Week calendar */
  .week-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    margin: 14px 0;
  }
  .week-day {
    border-radius: 14px;
    background: rgba(255,255,255,0.6);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 10px 2px;
    min-height: 58px;
    transition: all 0.25s;
    cursor: pointer;
    border: 1.5px solid rgba(255,255,255,0.9);
  }
  .week-day .day-name { color: var(--text-dim); font-size: 0.6em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.03em; }
  .week-day .day-num { color: var(--text); font-weight: 800; font-size: 1.05em; margin-top: 3px; }
  .week-day.today { border-color: var(--accent); background: var(--accent-light); box-shadow: 0 0 0 2px rgba(219,39,119,0.2); }
  .week-day.today .day-num { color: var(--accent); }
  .week-day.logged { background: var(--green-light); border-color: rgba(5,150,105,0.3); }
  .week-day.logged .day-num { color: var(--green); }
  .week-day.logged:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(5,150,105,0.2); }

  /* Toolkit cards */
  .toolkit-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 22px;
    margin-bottom: 12px;
    border-left: 4px solid var(--accent);
    transition: all 0.3s;
    box-shadow: var(--shadow);
  }
  .toolkit-card:hover { border-left-color: var(--teal); transform: translateX(3px); box-shadow: var(--shadow-lg); }
  .toolkit-card h4 { color: var(--text); margin-bottom: 8px; font-size: 1em; }
  .toolkit-card p { font-size: 0.9em; color: var(--text-mid); line-height: 1.7; }
  .tag {
    display: inline-block;
    padding: 3px 12px;
    border-radius: 20px;
    font-size: 0.72em;
    font-weight: 700;
    margin-top: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .tag-purple { background: var(--accent-light); color: var(--accent); }
  .tag-green { background: var(--green-light); color: var(--green); }
  .tag-teal { background: var(--teal-light); color: var(--teal); }
  .tag-orange { background: var(--orange-light); color: var(--orange); }
  .tag-pink { background: var(--pink-light); color: var(--pink); }

  /* Habit replacement grid */
  .habit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 12px;
    margin-top: 14px;
  }
  .habit-card {
    background: var(--surface2);
    border-radius: 14px;
    padding: 20px;
    border: 1px solid var(--border);
    transition: all 0.3s;
  }
  .habit-card:hover { background: white; box-shadow: var(--shadow-lg); transform: translateY(-2px); }
  .habit-card .habit-icon { display: flex; justify-content: center; margin-bottom: 10px; }
  .habit-card h4 { color: var(--text); font-size: 0.95em; margin-bottom: 6px; }
  .habit-card p { color: var(--text-mid); font-size: 0.82em; line-height: 1.6; }
  .habit-card .habit-when {
    margin-top: 10px;
    font-size: 0.75em;
    font-weight: 700;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Milestones */
  .milestone {
    display: flex; align-items: center; gap: 16px;
    padding: 16px;
    background: rgba(255,255,255,0.6);
    border-radius: 14px;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.9);
  }
  .milestone-bar {
    position: absolute;
    left: 0; top: 0; bottom: 0;
    background: var(--green-light);
    transition: width 1s ease;
  }
  .milestone-icon { z-index: 1; display: flex; align-items: center; flex-shrink: 0; }
  .milestone-info { z-index: 1; flex: 1; }
  .milestone-info h4 { font-size: 0.9em; color: var(--text); margin-bottom: 2px; }
  .milestone-info p { font-size: 0.8em; color: var(--text-dim); }
  .milestone-time { z-index: 1; font-size: 0.75em; color: var(--green); font-weight: 700; text-align: right; }

  /* Timeline */
  .timeline { margin-top: 16px; }
  .timeline-item { display: flex; gap: 16px; padding-bottom: 24px; position: relative; }
  .timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 15px; top: 36px; bottom: 0;
    width: 2px;
    background: var(--surface3);
  }
  .timeline-item.completed:not(:last-child)::after { background: var(--green); }
  .timeline-dot {
    width: 32px; height: 32px;
    border-radius: 50%;
    background: var(--surface2);
    border: 2px solid var(--text-dim);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    font-size: 0.8em;
    font-weight: 700;
  }
  .timeline-item.completed .timeline-dot { background: var(--green); border-color: var(--green); color: white; }
  .timeline-item.current .timeline-dot {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
    box-shadow: 0 0 0 4px var(--accent-light);
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%,100% { box-shadow: 0 0 0 4px var(--primary-light); }
    50% { box-shadow: 0 0 0 8px rgba(94,211,179,0.15); }
  }
  .timeline-content h4 { color: var(--text); font-size: 0.95em; margin-bottom: 4px; }
  .timeline-content p { font-size: 0.85em; color: var(--text-dim); }

  /* Journal */
  .journal-input {
    width: 100%;
    min-height: 120px;
    background: rgba(255,255,255,0.6);
    border: 1.5px solid rgba(255,255,255,0.9);
    border-radius: 16px;
    padding: 16px;
    color: var(--text);
    font-family: 'Inter', sans-serif;
    font-size: 0.95em;
    resize: vertical;
    outline: none;
    transition: border-color 0.3s;
  }
  .journal-input:focus { border-color: var(--accent); }
  .journal-input::placeholder { color: var(--text-dim); }
  .journal-entries { margin-top: 20px; }
  .journal-entry {
    background: rgba(255,255,255,0.6);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 10px;
    border-left: 3px solid var(--accent);
  }
  .journal-entry .date { font-size: 0.75em; color: var(--accent); margin-bottom: 6px; font-weight: 700; }
  .journal-entry .text { color: var(--text-mid); font-size: 0.9em; line-height: 1.6; white-space: pre-wrap; }

  /* Schedule table */
  .schedule-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 6px;
    margin: 12px 0;
  }
  .schedule-table th {
    text-align: left;
    padding: 10px 14px;
    font-size: 0.72em;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
  }
  .schedule-table td {
    padding: 14px;
    background: var(--surface2);
    font-size: 0.9em;
    color: var(--text);
  }
  .schedule-table tr td:first-child { border-radius: 10px 0 0 10px; font-weight: 700; color: var(--accent); }
  .schedule-table tr td:last-child { border-radius: 0 10px 10px 0; }

  .badge {
    display: inline-block;
    padding: 3px 12px;
    border-radius: 20px;
    font-size: 0.72em;
    font-weight: 700;
  }
  .badge-green { background: var(--green-light); color: var(--green); }
  .badge-orange { background: var(--orange-light); color: var(--orange); }
  .badge-purple { background: var(--accent-light); color: var(--accent); }
  .badge-teal { background: var(--teal-light); color: var(--teal); }

  /* Puff counter */
  .puff-counter {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px 20px;
    background: var(--primary-light);
    border-radius: 18px;
    margin: 16px 0;
    border: 1px solid rgba(255,255,255,0.9);
  }
  .puff-counter button {
    width: 52px; height: 52px;
    border-radius: 50%;
    border: none;
    background: white;
    font-size: 1.5em;
    font-weight: 700;
    color: var(--teal);
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 10px rgba(47,163,154,0.15);
  }
  .puff-counter button:hover { background: var(--primary); color: var(--text); transform: scale(1.08); box-shadow: 0 4px 16px rgba(94,211,179,0.3); }
  .puff-count {
    text-align: center;
  }
  .puff-count .number { font-size: 2.5em; font-weight: 800; color: var(--text); }
  .puff-baseline { font-size: 0.5em; font-weight: 600; color: var(--text-dim); vertical-align: baseline; }
  .puff-count .label { font-size: 0.75em; color: var(--text-dim); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
  .puff-target { text-align: center; margin-top: 8px; font-size: 0.85em; color: var(--text-dim); }
  .puff-target strong { color: var(--accent); }

  /* Quote bar */
  .quote-bar {
    text-align: center;
    padding: 28px 20px;
    font-style: italic;
    color: var(--text-mid);
    font-size: 0.95em;
    border-top: 1px solid var(--border);
    margin-top: 30px;
    line-height: 1.6;
  }
  .quote-bar strong { color: var(--accent); font-style: normal; }

  /* Reset */
  .reset-link {
    display: block;
    text-align: center;
    margin-top: 30px;
    padding: 20px;
    color: var(--text-dim);
    font-size: 0.8em;
    cursor: pointer;
    opacity: 0.4;
    transition: opacity 0.3s;
  }
  .reset-link:hover { opacity: 1; color: var(--red); }

  /* Confetti overlay */
  .confetti-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 999;
  }

  /* Success toast */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--green);
    color: white;
    padding: 14px 28px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 0.95em;
    box-shadow: 0 4px 20px rgba(22,163,74,0.3);
    z-index: 1000;
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
    font-family: 'Inter', sans-serif;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Backup reminder banner */
  .backup-banner {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--orange-light);
    border: 1.5px solid var(--orange);
    border-radius: var(--radius);
    padding: 14px 16px;
    margin-bottom: 14px;
  }
  .backup-banner p { flex: 1; font-size: 0.88em; color: var(--text); margin: 0; line-height: 1.4; }
  .backup-banner strong { color: var(--orange); }
  .backup-banner-actions { display: flex; gap: 8px; flex-shrink: 0; }
  .backup-banner button { font-family: 'Inter', sans-serif; font-size: 0.82em; font-weight: 600; border: none; border-radius: 8px; padding: 7px 12px; cursor: pointer; }
  .backup-now-btn { background: var(--orange); color: white; }
  .backup-dismiss-btn { background: transparent; color: var(--text-dim); }

  /* Currency buttons */
  .currency-btn {
    padding: 8px 16px;
    border: 2px solid var(--border);
    border-radius: 8px;
    background: var(--surface2);
    font-family: 'Inter', sans-serif;
    font-size: 0.85em;
    font-weight: 600;
    color: var(--text-mid);
    cursor: pointer;
    transition: all 0.2s;
  }
  .currency-btn:hover { border-color: var(--accent); color: var(--accent); }
  .currency-btn.active { border-color: var(--accent); background: var(--accent-light); color: var(--accent); }

  /* Setback section */
  .setback-toggle label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 0.95em;
    font-weight: 500;
    color: var(--text-mid);
    margin-top: 14px;
  }
  .setback-toggle input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--orange);
    cursor: pointer;
  }
  #setbackNote {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 12px;
    font-family: 'Inter', sans-serif;
    font-size: 0.9em;
    color: var(--text);
    background: var(--surface2);
    resize: vertical;
    outline: none;
    transition: border-color 0.2s;
  }
  #setbackNote:focus { border-color: var(--orange); }
  .setback-affirmation {
    margin-top: 12px;
    padding: 14px 16px;
    background: var(--orange-light);
    border-radius: 10px;
    font-size: 0.88em;
    color: var(--orange);
    font-style: italic;
    font-weight: 500;
    line-height: 1.5;
  }

  /* History & Setback Log */
  .history-entry {
    padding: 14px 16px;
    border-radius: 12px;
    background: var(--surface2);
    margin-bottom: 10px;
    border-left: 3px solid transparent;
    transition: background 0.2s;
  }
  .history-entry.setback-day {
    border-left-color: var(--orange);
    background: #fffbf5;
  }
  .history-date-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    font-size: 0.9em;
    color: var(--text);
    margin-bottom: 8px;
  }
  .setback-badge {
    font-size: 0.72em;
    font-weight: 700;
    background: var(--orange-light);
    color: var(--orange);
    padding: 2px 8px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .history-stats {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .history-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: var(--surface);
    border-radius: 8px;
    padding: 6px 12px;
    min-width: 52px;
  }
  .history-stat .stat-label {
    font-size: 0.72em;
    color: var(--text-dim);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .history-stat .stat-val {
    font-size: 1.05em;
    font-weight: 700;
    color: var(--text);
    margin-top: 2px;
  }
  .history-note {
    margin-top: 8px;
    font-size: 0.85em;
    color: var(--text-mid);
    font-style: italic;
    padding-left: 4px;
  }
  .setback-entry {
    padding: 12px 14px;
    border-radius: 10px;
    background: var(--orange-light);
    margin-bottom: 10px;
  }
  .setback-entry-date {
    font-weight: 600;
    font-size: 0.88em;
    color: var(--orange);
    margin-bottom: 4px;
  }
  .setback-entry-puffs {
    font-size: 0.85em;
    color: var(--text-mid);
  }
  .setback-entry-note {
    margin-top: 6px;
    font-size: 0.85em;
    color: var(--text-mid);
    font-style: italic;
  }
  .history-empty {
    text-align: center;
    color: var(--text-dim);
    padding: 20px;
    font-size: 0.9em;
  }

  /* Day detail modal */
  .day-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(30,27,46,0.5);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    backdrop-filter: blur(2px);
  }
  .day-modal-box {
    background: var(--surface);
    border-radius: 20px;
    padding: 28px 24px 24px;
    width: 100%;
    max-width: 400px;
    box-shadow: var(--shadow-lg);
    position: relative;
  }
  .day-modal-close {
    position: absolute;
    top: 14px;
    right: 16px;
    background: var(--surface2);
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 0.85em;
    color: var(--text-dim);
    cursor: pointer;
    font-weight: 700;
  }
  .day-modal-close:hover { background: var(--surface3); color: var(--text); }
  .day-modal-date {
    font-family: 'Playfair Display', serif;
    font-size: 1.3em;
    color: var(--text);
    margin-bottom: 16px;
  }
  .day-modal-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 16px;
  }
  .day-modal-stat {
    background: var(--surface2);
    border-radius: 12px;
    padding: 12px 14px;
  }
  .day-modal-stat .label {
    font-size: 0.75em;
    color: var(--text-dim);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .day-modal-stat .value {
    font-size: 1.5em;
    font-weight: 800;
    color: var(--text);
    margin-top: 2px;
  }
  .day-modal-tasks {
    margin-bottom: 14px;
  }
  .day-modal-tasks h4 {
    font-size: 0.85em;
    font-weight: 600;
    color: var(--text-mid);
    margin-bottom: 8px;
  }
  .day-modal-task-row {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.88em;
    color: var(--text-mid);
    padding: 4px 0;
  }
  .day-modal-task-row .tick {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75em;
    flex-shrink: 0;
  }
  .day-modal-task-row .tick.done { background: var(--green-light); color: var(--green); }
  .day-modal-task-row .tick.skip { background: var(--surface3); color: var(--text-dim); }
  .day-modal-setback {
    background: var(--orange-light);
    border-radius: 10px;
    padding: 12px 14px;
    font-size: 0.88em;
    color: var(--orange);
    font-weight: 500;
  }
  .day-modal-setback p { margin-top: 4px; font-weight: 400; font-style: italic; color: var(--text-mid); }

  /* Icon boxes */
  .icon-box {
    width: 42px;
    height: 42px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: white;
  }
  .icon-box.teal  { background: var(--teal); }
  .icon-box.green { background: var(--green); }
  .icon-box.coral { background: var(--accent); }
  .icon-box.amber { background: var(--orange); }
  .icon-box.mint  { background: var(--primary); }
  .icon-box.sm { width: 32px; height: 32px; border-radius: 9px; }
  .icon-box.sm svg { width: 18px; height: 18px; }
  .card h2.has-icon { display: flex; align-items: center; gap: 10px; }

  /* Responsive */
  @media (max-width: 600px) {
    .stats-bar { grid-template-columns: repeat(2, 1fr); }
    .header h1 { font-size: 2em; }
    .nav-tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .nav-tab { flex: none; padding: 10px 12px; font-size: 0.78em; }
    .habit-grid { grid-template-columns: 1fr; }
    .week-grid { gap: 4px; }
    .week-day { padding: 8px 1px; min-height: 52px; border-radius: 11px; }
    .week-day .day-name { font-size: 0.54em; }
    .week-day .day-num { font-size: 0.95em; }
    .card { padding: 18px 16px; }
    .day-modal-stats { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>

<div class="app">
  <div class="header">
    <h1 data-i18n="app.title">BreatheFreely</h1>
    <p data-i18n="app.subtitle">Your personal journey to freedom — one breath at a time</p>
  </div>

  <!-- Motivational banner - changes daily -->
  <div class="motiv-banner">
    <div class="motiv-text" id="motivText"></div>
    <div class="motiv-sub" id="motivSub"></div>
  </div>

  <!-- Stats -->
  <div class="stats-bar">
    <div class="stat-card highlight">
      <div class="stat-number" id="daysFree">0</div>
      <div class="stat-label" data-i18n="stat.daysOnPlan">Days on Plan</div>
    </div>
    <div class="stat-card accent">
      <div class="stat-number" id="moneySaved">$0</div>
      <div class="stat-label" data-i18n="stat.moneySaved">Money Saved</div>
    </div>
    <div class="stat-card teal">
      <div class="stat-number" id="cravingsBeaten">0</div>
      <div class="stat-label" data-i18n="stat.cravingsBeaten">Cravings Beaten</div>
    </div>
    <div class="stat-card highlight">
      <div class="stat-number" id="currentPhase">—</div>
      <div class="stat-label" data-i18n="stat.currentPhase">Current Phase</div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPanel('today',this)" data-i18n="nav.today">Today</button>
    <button class="nav-tab" onclick="showPanel('breathe',this)" data-i18n="nav.breathe">Breathe</button>
    <button class="nav-tab" onclick="showPanel('cravings',this)" data-i18n="nav.cravings">Cravings</button>
    <button class="nav-tab" onclick="showPanel('plan',this)" data-i18n="nav.plan">My Plan</button>
    <button class="nav-tab" onclick="showPanel('social',this)" data-i18n="nav.social">Social Kit</button>
    <button class="nav-tab" onclick="showPanel('journal',this)" data-i18n="nav.journal">Journal</button>
    <button class="nav-tab" onclick="showPanel('progress',this)" data-i18n="nav.progress">Progress</button>
    <button class="nav-tab" onclick="showPanel('settings',this)" data-i18n="nav.settings">Settings</button>
  </div>

  <!-- Day Detail Modal -->
  <div id="dayModal" class="day-modal-overlay" onclick="closeDayModal(event)" style="display:none">
    <div class="day-modal-box">
      <button class="day-modal-close" onclick="closeDayModal()">✕</button>
      <div id="dayModalContent"></div>
    </div>
  </div>

  <!-- ====== TODAY ====== -->
  <div class="panel active" id="panel-today">
    <div id="backupBanner" style="display:none" class="backup-banner">
      <div class="icon-box amber sm"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg></div>
      <p><strong>Back up your progress!</strong> Save your data so you never lose your streak again.</p>
      <div class="backup-banner-actions">
        <button class="backup-now-btn" onclick="exportDataFromBanner()">Save now</button>
        <button class="backup-dismiss-btn" onclick="dismissBackupBanner()">Later</button>
      </div>
    </div>
    <div class="card">
      <h2 data-i18n="today.thisWeek">This Week</h2>
      <div class="week-grid" id="weekGrid"></div>
    </div>

    <div class="card">
      <h2 data-i18n="today.puffTracker">Today's Puff Tracker</h2>
      <p data-i18n="today.puffDesc">Track how many times you vape today. The goal is to gradually reduce this number week by week — no pressure, just awareness.</p>
      <div class="puff-counter">
        <button onclick="changePuffs(-1)">-</button>
        <div class="puff-count">
          <div class="number"><span id="puffCount">0</span><span class="puff-baseline" id="puffBaseline"></span></div>
          <div class="label" data-i18n="today.puffsToday">Puffs today</div>
        </div>
        <button onclick="changePuffs(1)">+</button>
      </div>
      <div class="puff-target" id="puffTarget"></div>
    </div>

    <div class="card">
      <h2 data-i18n="today.dailyCheckin">Daily Check-in</h2>
      <div class="slider-group">
        <div class="slider-label">
          <span data-i18n="today.anxietyLevel">Anxiety Level</span>
          <span id="anxietyVal">5</span>
        </div>
        <input type="range" min="1" max="10" value="5" id="anxietySlider" oninput="document.getElementById('anxietyVal').textContent=this.value">
      </div>
      <div class="slider-group">
        <div class="slider-label">
          <span data-i18n="today.cravingIntensity">Craving Intensity</span>
          <span id="cravingVal">5</span>
        </div>
        <input type="range" min="1" max="10" value="5" id="cravingSlider" oninput="document.getElementById('cravingVal').textContent=this.value">
      </div>
      <div class="checkin-grid" id="checkinGrid"></div>
      <button class="btn-primary btn-full" onclick="saveDailyCheckin()" data-i18n="today.saveCheckin">Save Today's Check-in</button>
    </div>

    <div class="card">
      <h2 data-i18n="today.cravingNow">Craving Right Now?</h2>
      <button class="sos-btn" onclick="triggerSOS()" data-i18n="today.sosBtn">SOS — I Need Help Right Now</button>
      <div class="sos-tips" id="sosTips">
        <div class="sos-tip">
          <div class="icon"><div class="icon-box teal"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><line x1="2" x2="22" y1="12" y2="12"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></svg></div></div>
          <div>
            <h4 data-i18n="sos.ice.title">Ice Cube Trick</h4>
            <p data-i18n="sos.ice.desc">Hold ice in your hand or press it to your neck. The cold activates your dive reflex and drops your heart rate in 30 seconds. Focus entirely on the sensation.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon"><div class="icon-box teal"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg></div></div>
          <div>
            <h4 data-i18n="sos.box.title">Box Breathing — Do It Now</h4>
            <p data-i18n-html="sos.box.desc">Go to the <strong>Breathe</strong> tab. 4 rounds = 4 minutes. The deep inhale you crave from vaping? You get it here — without the nicotine.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon"><div class="icon-box green"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg></div></div>
          <div>
            <h4 data-i18n="sos.move.title">Move for 5 Minutes</h4>
            <p data-i18n="sos.move.desc">Walk, stretch, pace — anything. Taylor et al. (2007) found brief walking cuts cravings by 50%. Your body needs to burn off the restless energy.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon"><div class="icon-box coral"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg></div></div>
          <div>
            <h4 data-i18n="sos.squeeze.title">Squeeze Something</h4>
            <p data-i18n="sos.squeeze.desc">Grab a stress ball, rubber band, or just clench your fist hard for 10 seconds then release. This redirects the physical tension your body is feeling.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon"><div class="icon-box amber"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></svg></div></div>
          <div>
            <h4 data-i18n="sos.wait.title">Wait 5 Minutes</h4>
            <p data-i18n="sos.wait.desc">"I'll wait just 5 more minutes." Most cravings peak and fade within 3-5 minutes. Set a timer. You'll be surprised how fast it passes.</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon"><div class="icon-box teal"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg></div></div>
          <div>
            <h4 data-i18n="sos.reframe.title">Reframe the Thought</h4>
            <p data-i18n="sos.reframe.desc">"I need to vape" → "My brain is requesting nicotine. This uncomfortable feeling IS the addiction losing its grip. Each time I resist, it gets weaker. I am winning right now."</p>
          </div>
        </div>
        <div class="sos-tip">
          <div class="icon"><div class="icon-box green"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg></div></div>
          <div>
            <h4 data-i18n="sos.oral.title">Oral Substitute — Now</h4>
            <p data-i18n="sos.oral.desc">Pop a mint, chew gum, bite a toothpick, eat a crunchy carrot. The oral fixation is real — satisfy it without nicotine.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="today.healthTimeline">Health Recovery Timeline</h2>
      <div id="milestones"></div>
    </div>

    <div class="card">
      <h2 class="has-icon"><div class="icon-box green sm"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg></div>Had a Setback?</h2>
      <p style="font-size:0.9em;color:var(--text-mid);margin-bottom:4px">Setbacks are part of recovery — not the end of it. Logging them honestly is what change is made of. Your streak stays intact.</p>
      <div class="setback-toggle">
        <label>
          <input type="checkbox" id="setbackToggle" onchange="toggleSetbackForm(this.checked)">
          <span>Log today as a setback</span>
        </label>
      </div>
      <div id="setbackForm" style="display:none;margin-top:16px">
        <textarea id="setbackNote" placeholder="What happened? What triggered it? (optional — just for you)" rows="3"></textarea>
        <div class="setback-affirmation" id="setbackAffirmation"></div>
        <button class="btn-primary btn-full" onclick="saveSetback()" style="margin-top:12px">Save</button>
      </div>
    </div>
  </div>

  <!-- ====== BREATHE ====== -->
  <div class="panel" id="panel-breathe">
    <div class="card">
      <h2 data-i18n="breathe.title">Box Breathing Exercise</h2>
      <p data-i18n="breathe.desc">Your body's built-in calm-down switch. Used by Navy SEALs, recommended by anxiety researchers. Do this whenever you'd reach for the vape — the deep inhale satisfies the same physical urge.</p>
      <div class="breath-container">
        <div class="breath-circle-outer" id="breathOuter">
          <div class="breath-circle" id="breathCircle">
            <div class="breath-text" id="breathText">Ready</div>
            <div class="breath-timer" id="breathTimer">4:4:4:4</div>
          </div>
        </div>
        <button class="breath-btn" id="breathBtn" onclick="toggleBreathing()" data-i18n="breathe.start">Start Breathing</button>
        <div class="breath-rounds">Round: <strong id="breathRounds">0 / 4</strong></div>
      </div>
    </div>
    <div class="card">
      <h2 data-i18n="breathe.whyTitle">Why This Replaces Vaping</h2>
      <p data-i18n-html="breathe.whyDesc">Here's what most people don't realize: when you vape, the calming effect comes partly from the <strong>breathing pattern itself</strong> — slow, deep inhales. Nicotine gets the credit, but your lungs do the real work.</p>
      <div class="callout" data-i18n="breathe.callout">Box breathing gives you the same parasympathetic activation without the 50+ chemicals. After 2-3 weeks of practice, your brain rewires to use this as the default stress response.</div>
      <h3 data-i18n="breathe.science">The Science</h3>
      <ul>
        <li data-i18n="breathe.sci1">Extended exhales stimulate the vagus nerve, lowering heart rate instantly (Gerritsen & Band, 2018)</li>
        <li data-i18n="breathe.sci2">4 rounds reduce cortisol by up to 20% (Ma et al., 2017)</li>
        <li data-i18n="breathe.sci3">Regular practice physically rewires your stress response in 2-3 weeks</li>
        <li data-i18n="breathe.sci4">This is literally what your body was doing when you vaped — minus the poison</li>
      </ul>
    </div>
  </div>

  <!-- ====== CRAVINGS & HABITS ====== -->
  <div class="panel" id="panel-cravings">
    <div class="card">
      <h2 data-i18n="cravings.title">Understanding Your Cravings</h2>
      <p data-i18n-html="cravings.desc">A craving is a <strong>wave</strong> — it rises, peaks, and falls in 3-5 minutes. You don't need to fight it. You just need to <strong>surf it</strong>. The technique is called "urge surfing" (Marlatt, 1985) and it's one of the most effective tools in addiction research.</p>
      <div class="callout-accent" data-i18n="cravings.callout">Every single craving you ride out without vaping physically weakens the neural pathway. Your brain literally rewires. It's not willpower — it's neuroscience.</div>
      <h3 data-i18n="cravings.wave">The Craving Wave</h3>
      <ul>
        <li data-i18n-html="cravings.wave1"><strong>0-1 min:</strong> Trigger hits. You feel the pull. This is the steepest part.</li>
        <li data-i18n-html="cravings.wave2"><strong>1-3 min:</strong> Peak intensity. Your brain is screaming. This is where most people give in.</li>
        <li data-i18n-html="cravings.wave3"><strong>3-5 min:</strong> It starts fading. You made it through the worst.</li>
        <li data-i18n-html="cravings.wave4"><strong>5+ min:</strong> Gone. You won. The neural pathway just got weaker.</li>
      </ul>
    </div>

    <div class="card">
      <h2 data-i18n="cravings.habits">Hand-to-Mouth Habit Replacements</h2>
      <p data-i18n-html="cravings.habitsDesc">Vaping isn't just nicotine — it's a <strong>physical habit</strong>. Your hand reaches for it automatically. Here are proven replacements that satisfy the same motor pattern:</p>
      <div class="habit-grid">
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box teal"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg></div></div>
          <h4 data-i18n="habit.pen.title">Pen / Pencil Fidget</h4>
          <p data-i18n="habit.pen.desc">Keep a pen in your hand. Click it, twirl it, hold it between your fingers like a vape. Same hand movement, zero nicotine.</p>
          <div class="habit-when" data-i18n="habit.pen.when">When: Working, sitting, thinking</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box coral"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/></svg></div></div>
          <h4 data-i18n="habit.mints.title">Mints & Hard Candy</h4>
          <p data-i18n="habit.mints.desc">Strong mints (Altoids, cinnamon) work best. The intense flavor distracts your brain and satisfies the oral fixation.</p>
          <div class="habit-when" data-i18n="habit.mints.when">When: After meals, social events</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box green"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg></div></div>
          <h4 data-i18n="habit.snacks.title">Crunchy Snacks</h4>
          <p data-i18n="habit.snacks.desc">Carrots, celery, sunflower seeds, apple slices. The chewing and crunching engages your jaw and satisfies the oral need.</p>
          <div class="habit-when" data-i18n="habit.snacks.when">When: At home, watching TV</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box coral"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></svg></div></div>
          <h4 data-i18n="habit.stress.title">Stress Ball / Grip</h4>
          <p data-i18n="habit.stress.desc">Squeeze a stress ball or hand gripper. Channels the physical tension somewhere productive. Bonus: builds forearm strength.</p>
          <div class="habit-when" data-i18n="habit.stress.when">When: Anxious moments, meetings</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box teal"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.2 22H8.8a2 2 0 0 1-2-1.79L5 3h14l-1.81 17.21A2 2 0 0 1 15.2 22z"/><path d="M6 12a5 5 0 0 1 6 0 5 5 0 0 0 6 0"/></svg></div></div>
          <h4 data-i18n="habit.water.title">Cold Water Bottle</h4>
          <p data-i18n="habit.water.desc">Sip ice water through a straw. The cold, the sipping motion, and the hand-holding all mimic vaping sensations.</p>
          <div class="habit-when" data-i18n="habit.water.when">When: Driving, desk work</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box amber"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/></svg></div></div>
          <h4 data-i18n="habit.toothpick.title">Flavored Toothpick</h4>
          <p data-i18n="habit.toothpick.desc">Cinnamon or tea tree toothpicks give you something in your mouth and hands. Many ex-smokers swear by this.</p>
          <div class="habit-when" data-i18n="habit.toothpick.when">When: Social events, bars</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box mint"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg></div></div>
          <h4 data-i18n="habit.fidget.title">Fidget Ring / Worry Stone</h4>
          <p data-i18n="habit.fidget.desc">A spinner ring or smooth stone you roll between your fingers. Keeps your hands busy without thinking about it.</p>
          <div class="habit-when" data-i18n="habit.fidget.when">When: Anywhere, anytime</div>
        </div>
        <div class="habit-card">
          <div class="habit-icon"><div class="icon-box teal"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg></div></div>
          <h4 data-i18n="habit.straw.title">Deep Breath Through a Straw</h4>
          <p data-i18n="habit.straw.desc">Inhale slowly through a straw — mimics the exact draw sensation of vaping. Exhale slowly through your nose. Repeat 5x.</p>
          <div class="habit-when" data-i18n="habit.straw.when">When: Intense cravings</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="cravings.triggerMap">Trigger Map</h2>
      <p data-i18n="cravings.triggerDesc">Most vaping happens on autopilot. Identify your triggers so you can prepare:</p>
      <div class="checkin-grid" id="triggerChecklist"></div>
      <p style="margin-top:14px;font-size:0.85em;color:var(--text-dim)" data-i18n="cravings.triggerHelp">Check the ones that apply to you. For each trigger you identify, plan a specific replacement action. Writing "When X happens, I will do Y instead" (implementation intentions) doubles your success rate (Gollwitzer, 1999).</p>
    </div>

    <div class="card">
      <h2 data-i18n="cravings.evidenceTitle">Things That Actually Help (Evidence-Based)</h2>
      <ul>
        <li data-i18n-html="cravings.ev1"><strong>Nicotine gum/lozenges (NRT):</strong> Available over the counter. Use for breakthrough cravings, especially in social situations. Clinically proven to improve quit rates by 50-70% (Stead et al., 2012)</li>
        <li data-i18n-html="cravings.ev2"><strong>Exercise:</strong> Even 10 minutes reduces cravings significantly. The endorphins replace the dopamine hit from nicotine</li>
        <li data-i18n-html="cravings.ev3"><strong>Sleep:</strong> Poor sleep increases cravings 40%. Prioritize 7+ hours</li>
        <li data-i18n-html="cravings.ev4"><strong>Water:</strong> Dehydration intensifies cravings. Drink a full glass when a craving hits</li>
        <li data-i18n-html="cravings.ev5"><strong>CBT (therapy):</strong> The gold standard for anxiety + cessation. Many therapists offer it online. This is the single most effective intervention available</li>
      </ul>
    </div>
  </div>

  <!-- ====== PLAN ====== -->
  <div class="panel" id="panel-plan">
    <div class="card">
      <h2 data-i18n="plan.title">Your Frequency Reduction Plan</h2>
      <p data-i18n-html="plan.desc">Since you're using a 5% nicotine vape with no lower option, the strategy shifts to <strong>reducing how often you use it</strong>. This is called "scheduled reduction" and research shows it's effective — especially for anxious quitters, because it avoids the shock of going cold turkey (Cinciripini et al., 1995).</p>
      <table class="schedule-table">
        <thead>
          <tr><th data-i18n="plan.weeks">Weeks</th><th data-i18n="plan.goal">Goal</th><th data-i18n="plan.strategy">Strategy</th><th data-i18n="plan.phase">Phase</th></tr>
        </thead>
        <tbody>
          <tr><td>1 — 2</td><td data-i18n="plan.r1.goal">Track baseline</td><td data-i18n="plan.r1.strategy">Count every puff. No reduction yet — just observe.</td><td><span class="badge badge-purple" data-i18n="plan.r1.phase">Awareness</span></td></tr>
          <tr><td>3 — 4</td><td data-i18n="plan.r2.goal">Reduce 25%</td><td data-i18n="plan.r2.strategy">If you average 40 puffs/day, target 30. Cut the "automatic" ones first.</td><td><span class="badge badge-orange" data-i18n="plan.r2.phase">Reduce</span></td></tr>
          <tr><td>5 — 6</td><td data-i18n="plan.r3.goal">Reduce 50%</td><td data-i18n="plan.r3.strategy">Target half your baseline. Add 10-min delays before each session.</td><td><span class="badge badge-orange" data-i18n="plan.r2.phase">Reduce</span></td></tr>
          <tr><td>7 — 8</td><td data-i18n="plan.r4.goal">Reduce 75%</td><td data-i18n="plan.r4.strategy">Vape only at designated times (after meals, before bed). Max 3 sessions/day.</td><td><span class="badge badge-teal" data-i18n="plan.r4.phase">Structure</span></td></tr>
          <tr><td>9 — 10</td><td data-i18n="plan.r5.goal">1-2x per day</td><td data-i18n="plan.r5.strategy">Only vape once or twice. Use NRT gum for breakthroughs.</td><td><span class="badge badge-teal" data-i18n="plan.r4.phase">Structure</span></td></tr>
          <tr><td>11 — 12</td><td data-i18n="plan.r6.goal">Zero</td><td data-i18n="plan.r6.strategy">Full stop. Use every tool in this app. You're ready.</td><td><span class="badge badge-green" data-i18n="plan.r6.phase">Freedom</span></td></tr>
        </tbody>
      </table>
      <div class="callout" data-i18n="plan.callout">Key principle: Don't try to resist a craving with nothing. Always have a REPLACEMENT ready — gum, breathing, a fidget, a walk. Willpower alone fails. Systems win.</div>
    </div>

    <div class="card">
      <h2 data-i18n="plan.anxietyTitle">The Truth About Anxiety + Nicotine</h2>
      <p data-i18n="plan.anxietyIntro">This is the most important thing you'll read in this app:</p>
      <p data-i18n-html="plan.anxietyDesc">Nicotine <strong>feels</strong> like it helps your anxiety. But the science shows it actually <strong>makes it worse</strong>:</p>
      <ul>
        <li data-i18n-html="plan.anx1">Nicotine withdrawal creates anxiety symptoms → the next hit "relieves" it → you think it helped → this <strong>increases your baseline anxiety</strong> over time (Moylan et al., 2013)</li>
        <li data-i18n-html="plan.anx2">People who quit experience <strong>reduced anxiety equal to taking medication</strong> within 1-3 months (Taylor et al., 2014)</li>
        <li data-i18n="plan.anx3">The hardest window is days 3-14 after full cessation. After that, it improves every week</li>
      </ul>
      <div class="callout" style="background:#fdf2f8;border-color:var(--accent);color:#9d174d;">
        <span data-i18n="plan.anxCallout">You're not losing a coping tool. You're breaking free from something that was quietly making your anxiety worse every single day. The person you'll be in 3 months will be calmer, more present, and genuinely less anxious. That person is worth fighting for.</span>
      </div>
    </div>

    <div class="card">
      <h2 data-i18n="plan.checklistTitle">Getting Started Checklist</h2>
      <p data-i18n="plan.checklistDesc">Complete these to begin your journey:</p>
      <div class="checkin-grid" id="setupChecklist"></div>
    </div>
  </div>

  <!-- ====== SOCIAL KIT ====== -->
  <div class="panel" id="panel-social">
    <div class="card">
      <h2 data-i18n="social.title">Social Situations Toolkit</h2>
      <p data-i18n-html="social.desc">This is your hardest trigger — so it gets the most preparation. These strategies are based on CBT principles for social anxiety and substance use. You're not broken for finding this hard. <strong>Everyone</strong> does.</p>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.before.title">Before You Arrive</h4>
      <p data-i18n-html="social.before.desc">Vape <strong>before</strong> the event so you arrive satisfied. Set one rule: "I won't vape in the first 30 minutes." This breaks the automatic link between "social = vape." After a few events, the association weakens permanently.</p>
      <span class="tag tag-purple" data-i18n="social.before.tag">Pre-event</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.hand.title">The Dominant Hand Trick</h4>
      <p data-i18n="social.hand.desc">Keep a drink in your dominant hand the entire time. This physically blocks the hand-to-mouth reflex. It's stupidly simple — and that's why it works.</p>
      <span class="tag tag-teal" data-i18n="social.hand.tag">During event</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.response.title">Your Pre-Loaded Response</h4>
      <p data-i18n-html="social.response.desc">When someone offers or asks, use: <strong>"I'm cutting back"</strong> — three words, no debate, no awkwardness. Practice saying it out loud before you go. CBT research shows rehearsed responses dramatically reduce social anxiety about refusal.</p>
      <span class="tag tag-orange" data-i18n="social.response.tag">Key phrase</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.weapons.title">Your Secret Weapons: Pocket Kit</h4>
      <p data-i18n-html="social.weapons.desc">Bring a small kit to every social event: <strong>strong mints, a fidget ring or worry stone, and nicotine gum (just in case).</strong> Having backups reduces anxiety because you know you're prepared. You may not even use them — but knowing they're there is the point.</p>
      <span class="tag tag-pink" data-i18n="social.weapons.tag">Game changer</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.buddy.title">Find Your Accountability Buddy</h4>
      <p data-i18n-html="social.buddy.desc">Tell <strong>one</strong> friend about your goal. Not for a lecture — just someone who knows. When you feel the pull, text them or make eye contact. Social support increases quit success by 30% (Westmaas et al., 2010).</p>
      <span class="tag tag-green" data-i18n="social.buddy.tag">Support</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.swap.title">The Step-Away Swap</h4>
      <p data-i18n-html="social.swap.desc">When you feel the pull to go outside and vape, <strong>still step away</strong> — but do 2 minutes of box breathing or walk around the block instead. You keep the break from socializing (which is what you actually need), just without nicotine.</p>
      <span class="tag tag-teal" data-i18n="social.swap.tag">Replacement</span>
    </div>

    <div class="toolkit-card">
      <h4 data-i18n="social.reframe.title">The Reframe</h4>
      <p data-i18n-html="social.reframe.desc"><em>"I can't socialize without nicotine"</em> → You did it as a child, a teenager before vaping, and in many situations now. Nicotine withdrawal mimics social anxiety (racing heart, restlessness) but <strong>isn't the same thing</strong>. After 2-4 weeks, most people feel more comfortable socially, not less.</p>
      <span class="tag tag-purple" data-i18n="social.reframe.tag">Mindset</span>
    </div>

    <div class="card" style="border-left:4px solid var(--green);">
      <h2 data-i18n="social.setback.title">Setback Protocol</h2>
      <p data-i18n-html="social.setback.intro">If you slip at a party — <strong>read this:</strong></p>
      <ul>
        <li data-i18n="social.setback1">One slip is NOT a relapse. The Abstinence Violation Effect ("I already failed, might as well keep going") is the real enemy</li>
        <li data-i18n="social.setback2">Log it in your journal — what triggered it, how you felt</li>
        <li data-i18n="social.setback3">Do NOT reset your mental timeline</li>
        <li data-i18n-html="social.setback4">One slip in a month = you succeeded <strong>29 out of 30 days</strong>. That's a 97% success rate</li>
        <li data-i18n="social.setback5">Resume the plan tomorrow as if nothing happened. Because nothing did — you're still on track</li>
      </ul>
      <div class="callout" data-i18n="social.setbackCallout">Perfection isn't the goal. Progress is. And progress isn't linear — it's messy and human. Just like you. Keep going.</div>
    </div>
  </div>

  <!-- ====== JOURNAL ====== -->
  <div class="panel" id="panel-journal">
    <div class="card">
      <h2 data-i18n="journal.title">Your Journal</h2>
      <p data-i18n="journal.desc">Writing about cravings, victories, and feelings improves quit outcomes by 25% (Pennebaker, 1997). This is private and stays on your device only.</p>
      <textarea class="journal-input" id="journalInput" data-i18n-placeholder="journal.placeholder" placeholder="How are you feeling today? What triggered a craving? What are you proud of? Write anything..."></textarea>
      <button class="btn-primary btn-full" onclick="saveJournalEntry()" data-i18n="journal.save">Save Entry</button>
      <div class="journal-entries" id="journalEntries"></div>
    </div>
  </div>

  <!-- ====== PROGRESS ====== -->
  <div class="panel" id="panel-progress">
    <div class="card">
      <h2 data-i18n="progress.timeline">Your Journey Timeline</h2>
      <div class="timeline" id="progressTimeline"></div>
    </div>
    <div class="card">
      <h2 data-i18n="progress.trend">Craving & Anxiety Trend</h2>
      <canvas id="trendChart" height="200"></canvas>
      <p style="margin-top:12px;font-size:0.85em;color:var(--text-dim)" data-i18n-html="progress.trendDesc">Your daily scores over the last 14 days. Fluctuations are normal — the <strong>overall downward trend</strong> is what matters. Some days will be harder. That's not failure, that's the process.</p>
    </div>
    <div class="card">
      <h2 data-i18n="progress.achievements">Achievements</h2>
      <div id="achievements"></div>
    </div>
    <div class="card">
      <h2 class="has-icon"><div class="icon-box green sm"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg></div>Setback Log</h2>
      <p style="font-size:0.9em;color:var(--text-dim);margin-bottom:14px">Every hard day you logged — and got through.</p>
      <div id="setbackLog"></div>
    </div>
    <div class="card">
      <h2 class="has-icon"><div class="icon-box teal sm"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg></div>Daily History</h2>
      <p style="font-size:0.9em;color:var(--text-dim);margin-bottom:14px">All your check-in days, newest first.</p>
      <div id="historyLog"></div>
    </div>
  </div>

  <!-- ====== SETTINGS ====== -->
  <div class="panel" id="panel-settings">
    <div class="card">
      <h2 data-i18n="settings.title">Your Settings</h2>
      <p data-i18n="settings.desc">Personalize BreatheFreely to match your situation.</p>

      <h3 data-i18n="settings.language">Language</h3>
      <div style="margin:14px 0">
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px">
          <button class="currency-btn lang-btn" onclick="setLanguage('en')">English</button>
          <button class="currency-btn lang-btn" onclick="setLanguage('es')">Español</button>
        </div>
      </div>

      <h3 data-i18n="settings.name">Your Name</h3>
      <div style="margin:14px 0">
        <input type="text" id="userName" placeholder="e.g. Majo" maxlength="30" style="width:100%;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-family:'Inter',sans-serif;font-size:1em;color:var(--text);background:var(--surface2);outline:none" oninput="this.style.borderColor='var(--accent)'">
        <p style="margin-top:8px;font-size:0.82em;color:var(--text-dim)" data-i18n="settings.nameDesc">Used to personalize greetings and motivational messages throughout the app.</p>
      </div>

      <h3 data-i18n="settings.money">Money Tracking</h3>
      <div style="margin:14px 0">
        <label style="display:block;font-weight:600;font-size:0.9em;color:var(--text);margin-bottom:6px" data-i18n="settings.currency">Currency Symbol</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px">
          <button class="currency-btn" onclick="setCurrency('$','USD')">$ USD</button>
          <button class="currency-btn" onclick="setCurrency('COP$','COP')">COP$ Pesos</button>
          <button class="currency-btn" onclick="setCurrency('€','EUR')">€ EUR</button>
          <button class="currency-btn" onclick="setCurrency('£','GBP')">£ GBP</button>
          <button class="currency-btn" onclick="setCurrency('MX$','MXN')">MX$ MXN</button>
        </div>
        <label style="display:block;font-weight:600;font-size:0.9em;color:var(--text);margin-bottom:6px" data-i18n="settings.weeklySpend">How much do you spend per WEEK on vaping?</label>
        <div style="display:flex;gap:10px;align-items:center">
          <span id="currencyLabel" style="font-weight:700;font-size:1.2em;color:var(--accent)">$</span>
          <input type="number" id="weeklySpend" placeholder="e.g. 50000" style="flex:1;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-family:'Inter',sans-serif;font-size:1em;color:var(--text);background:var(--surface2);outline:none;-moz-appearance:textfield" oninput="this.style.borderColor='var(--accent)'">
          <span style="color:var(--text-dim);font-size:0.85em;font-weight:500" data-i18n="settings.perWeek">/ week</span>
        </div>
        <p style="margin-top:8px;font-size:0.82em;color:var(--text-dim)" data-i18n="settings.moneyDesc">This calculates how much you're saving as you reduce. Your daily cost = weekly spend / 7.</p>
      </div>

      <h3 data-i18n="settings.puffBaseline">Puff Baseline</h3>
      <div style="margin:14px 0">
        <label style="display:block;font-weight:600;font-size:0.9em;color:var(--text);margin-bottom:6px" data-i18n="settings.puffLabel">Average puffs per day (your starting point)</label>
        <input type="number" id="baselinePuffsInput" placeholder="e.g. 40" style="width:120px;padding:12px 16px;border:2px solid var(--border);border-radius:10px;font-family:'Inter',sans-serif;font-size:1em;color:var(--text);background:var(--surface2);outline:none;-moz-appearance:textfield">
        <p style="margin-top:8px;font-size:0.82em;color:var(--text-dim)" data-i18n="settings.puffDesc">This sets your reduction targets. If you're not sure, track for a few days first and come back.</p>
      </div>

      <button class="btn-primary btn-full" onclick="saveSettings()" data-i18n="settings.save">Save Settings</button>
    </div>

    <div class="card" style="border-left:4px solid var(--teal);">
      <h2 class="has-icon"><div class="icon-box teal sm"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg></div>Backup &amp; Restore</h2>
      <p style="font-size:0.9em;color:var(--text-mid);margin-bottom:16px">Save your progress to a file so you never lose it. Keep this file safe — use it to restore your data anytime.</p>

      <button class="btn-primary btn-full" onclick="exportData()" style="margin-bottom:10px">
        Download My Data
      </button>

      <button class="btn-primary btn-full" onclick="document.getElementById('importFile').click()" style="background:var(--surface2);color:var(--text);border:2px solid var(--border)">
        Restore from Backup
      </button>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(this)">
      <p style="margin-top:10px;font-size:0.8em;color:var(--text-dim)">Restoring will replace all current data with the backup file.</p>
    </div>

    <div class="card" style="border-left:4px solid var(--red);">
      <h2 data-i18n="settings.danger">Danger Zone</h2>
      <p data-i18n="settings.dangerDesc">This permanently deletes all your data — check-ins, journal entries, achievements, everything.</p>
      <button class="btn-primary btn-full" style="background:var(--red);margin-top:12px" onclick="resetApp()" data-i18n="settings.reset">Reset All Data</button>
    </div>
  </div>

  <div class="quote-bar" id="quoteBar"></div>
</div>

<div class="toast" id="toast"></div>

<script>
// ===== ICONS =====
const ICONS = {
  snowflake:       `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><line x1="2" x2="22" y1="12" y2="12"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></svg>`,
  wind:            `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>`,
  activity:        `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>`,
  zap:             `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>`,
  timer:           `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></svg>`,
  lightbulb:       `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`,
  droplets:        `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>`,
  pencil:          `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>`,
  sparkles:        `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/></svg>`,
  leaf:            `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>`,
  dumbbell:        `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></svg>`,
  'glass-water':   `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.2 22H8.8a2 2 0 0 1-2-1.79L5 3h14l-1.81 17.21A2 2 0 0 1 15.2 22z"/><path d="M6 12a5 5 0 0 1 6 0 5 5 0 0 0 6 0"/></svg>`,
  minus:           `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/></svg>`,
  'rotate-ccw':    `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>`,
  heart:           `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
  sun:             `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`,
  'trending-up':   `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>`,
  shield:          `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>`,
  flame:           `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>`,
  star:            `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`,
  target:          `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
  trophy:          `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`,
  gem:             `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M11 3 8 9l4 13 4-13-3-6"/><path d="M2 9h20"/></svg>`,
  crown:           `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z"/><path d="M5 21h14"/></svg>`,
  'clipboard-check': `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></svg>`,
  'book-open':     `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
};
const ICON_COLORS = {
  snowflake: 'teal', wind: 'teal', activity: 'green', zap: 'amber', timer: 'amber',
  lightbulb: 'green', droplets: 'green', pencil: 'mint', sparkles: 'coral', leaf: 'green',
  dumbbell: 'coral', 'glass-water': 'teal', minus: 'amber', 'rotate-ccw': 'mint',
  heart: 'coral', sun: 'amber', 'trending-up': 'mint', shield: 'teal',
  flame: 'coral', star: 'amber', target: 'teal', trophy: 'amber', gem: 'teal',
  crown: 'amber', 'clipboard-check': 'green', 'book-open': 'amber',
};
function iconBox(name) {
  return `<div class="icon-box ${ICON_COLORS[name]||'teal'}">${ICONS[name]||''}</div>`;
}

// ===== DATA =====
const STORAGE_KEY = 'breathefreely_v2';
const defaultData = () => ({
  startDate: new Date().toISOString().split('T')[0],
  dailyCheckins: {},
  lang: 'en',
  journal: [],
  cravingsBeaten: 0,
  setupDone: {},
  triggersDone: {},
  breathRoundsTotal: 0,
  costPerDay: 7,
  baselinePuffs: 40,
  currency: '$',
  currencyCode: 'USD',
  weeklySpend: 49,
  userName: ''
});

function loadData() {
  try {
    const d = JSON.parse(localStorage.getItem(STORAGE_KEY));
    if (d && d.startDate) return d;
  } catch(e) {}
  const d = defaultData();
  saveData(d);
  return d;
}
function saveData(d) { localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }
let data = loadData();

// ===== i18n TRANSLATIONS =====
function t(key) {
  const entry = T[key];
  if (!entry) return key;
  return entry[data.lang] || entry.en || key;
}

const T = {
  // Header
  'app.title': { en: 'BreatheFreely', es: 'RespiraLibre' },
  'app.subtitle': { en: 'Your personal journey to freedom — one breath at a time', es: 'Tu viaje personal hacia la libertad — una respiración a la vez' },
  'app.subtitle.name': { en: ', your personal journey to freedom — one breath at a time', es: ', tu viaje personal hacia la libertad — una respiración a la vez' },
  // Stats
  'stat.daysOnPlan': { en: 'Days on Plan', es: 'Días en Plan' },
  'stat.moneySaved': { en: 'Money Saved', es: 'Dinero Ahorrado' },
  'stat.cravingsBeaten': { en: 'Cravings Beaten', es: 'Antojos Vencidos' },
  'stat.currentPhase': { en: 'Current Phase', es: 'Fase Actual' },
  // Nav
  'nav.today': { en: 'Today', es: 'Hoy' },
  'nav.breathe': { en: 'Breathe', es: 'Respira' },
  'nav.cravings': { en: 'Cravings', es: 'Antojos' },
  'nav.plan': { en: 'My Plan', es: 'Mi Plan' },
  'nav.social': { en: 'Social Kit', es: 'Kit Social' },
  'nav.journal': { en: 'Journal', es: 'Diario' },
  'nav.progress': { en: 'Progress', es: 'Progreso' },
  'nav.settings': { en: 'Settings', es: 'Ajustes' },
  // Today panel
  'today.thisWeek': { en: 'This Week', es: 'Esta Semana' },
  'today.puffTracker': { en: "Today's Puff Tracker", es: 'Contador de Caladas' },
  'today.puffDesc': { en: 'Track how many times you vape today. The goal is to gradually reduce this number week by week — no pressure, just awareness.', es: 'Registra cuántas veces vapeas hoy. El objetivo es reducir gradualmente este número semana a semana — sin presión, solo consciencia.' },
  'today.puffsToday': { en: 'Puffs today', es: 'Caladas hoy' },
  'today.dailyCheckin': { en: 'Daily Check-in', es: 'Check-in Diario' },
  'today.anxietyLevel': { en: 'Anxiety Level', es: 'Nivel de Ansiedad' },
  'today.cravingIntensity': { en: 'Craving Intensity', es: 'Intensidad del Antojo' },
  'today.saveCheckin': { en: "Save Today's Check-in", es: 'Guardar Check-in de Hoy' },
  'today.cravingNow': { en: 'Craving Right Now?', es: '¿Antojo Ahora Mismo?' },
  'today.sosBtn': { en: 'SOS — I Need Help Right Now', es: 'SOS — Necesito Ayuda Ahora' },
  'today.healthTimeline': { en: 'Health Recovery Timeline', es: 'Línea de Recuperación de Salud' },
  // SOS tips
  'sos.ice.title': { en: 'Ice Cube Trick', es: 'Truco del Hielo' },
  'sos.ice.desc': { en: 'Hold ice in your hand or press it to your neck. The cold activates your dive reflex and drops your heart rate in 30 seconds. Focus entirely on the sensation.', es: 'Sostén hielo en tu mano o presiónalo contra tu cuello. El frío activa tu reflejo de inmersión y reduce tu ritmo cardíaco en 30 segundos. Concéntrate totalmente en la sensación.' },
  'sos.box.title': { en: 'Box Breathing — Do It Now', es: 'Respiración Cuadrada — Hazla Ahora' },
  'sos.box.desc': { en: 'Go to the <strong>Breathe</strong> tab. 4 rounds = 4 minutes. The deep inhale you crave from vaping? You get it here — without the nicotine.', es: 'Ve a la pestaña <strong>Respira</strong>. 4 rondas = 4 minutos. ¿La inhalación profunda que deseas del vape? La obtienes aquí — sin nicotina.' },
  'sos.move.title': { en: 'Move for 5 Minutes', es: 'Muévete 5 Minutos' },
  'sos.move.desc': { en: "Walk, stretch, pace — anything. Taylor et al. (2007) found brief walking cuts cravings by 50%. Your body needs to burn off the restless energy.", es: 'Camina, estírate, pasea — lo que sea. Taylor et al. (2007) encontró que caminar brevemente reduce los antojos un 50%. Tu cuerpo necesita quemar la energía inquieta.' },
  'sos.squeeze.title': { en: 'Squeeze Something', es: 'Aprieta Algo' },
  'sos.squeeze.desc': { en: 'Grab a stress ball, rubber band, or just clench your fist hard for 10 seconds then release. This redirects the physical tension your body is feeling.', es: 'Agarra una pelota antiestrés, una liga, o simplemente aprieta tu puño fuerte por 10 segundos y suelta. Esto redirige la tensión física que siente tu cuerpo.' },
  'sos.wait.title': { en: 'Wait 5 Minutes', es: 'Espera 5 Minutos' },
  'sos.wait.desc': { en: '"I\'ll wait just 5 more minutes." Most cravings peak and fade within 3-5 minutes. Set a timer. You\'ll be surprised how fast it passes.', es: '"Esperaré solo 5 minutos más." La mayoría de los antojos llegan al pico y se desvanecen en 3-5 minutos. Pon un temporizador. Te sorprenderá lo rápido que pasa.' },
  'sos.reframe.title': { en: 'Reframe the Thought', es: 'Reencuadra el Pensamiento' },
  'sos.reframe.desc': { en: '"I need to vape" → "My brain is requesting nicotine. This uncomfortable feeling IS the addiction losing its grip. Each time I resist, it gets weaker. I am winning right now."', es: '"Necesito vapear" → "Mi cerebro está pidiendo nicotina. Esta sensación incómoda ES la adicción perdiendo su control. Cada vez que resisto, se debilita. Estoy ganando ahora mismo."' },
  'sos.oral.title': { en: 'Oral Substitute — Now', es: 'Sustituto Oral — Ahora' },
  'sos.oral.desc': { en: 'Pop a mint, chew gum, bite a toothpick, eat a crunchy carrot. The oral fixation is real — satisfy it without nicotine.', es: 'Come una menta, mastica chicle, muerde un palillo, come una zanahoria crujiente. La fijación oral es real — satisfácela sin nicotina.' },
  // Breathe panel
  'breathe.title': { en: 'Box Breathing Exercise', es: 'Ejercicio de Respiración Cuadrada' },
  'breathe.desc': { en: "Your body's built-in calm-down switch. Used by Navy SEALs, recommended by anxiety researchers. Do this whenever you'd reach for the vape — the deep inhale satisfies the same physical urge.", es: 'El interruptor de calma incorporado de tu cuerpo. Usado por Navy SEALs, recomendado por investigadores de ansiedad. Haz esto cada vez que busques el vape — la inhalación profunda satisface la misma necesidad física.' },
  'breathe.start': { en: 'Start Breathing', es: 'Comenzar Respiración' },
  'breathe.stop': { en: 'Stop', es: 'Detener' },
  'breathe.ready': { en: 'Ready', es: 'Listo' },
  'breathe.round': { en: 'Round:', es: 'Ronda:' },
  'breathe.whyTitle': { en: 'Why This Replaces Vaping', es: 'Por Qué Esto Reemplaza al Vape' },
  'breathe.whyDesc': { en: "Here's what most people don't realize: when you vape, the calming effect comes partly from the <strong>breathing pattern itself</strong> — slow, deep inhales. Nicotine gets the credit, but your lungs do the real work.", es: 'Esto es lo que la mayoría no sabe: cuando vapeas, el efecto calmante viene en parte del <strong>patrón de respiración</strong> — inhalaciones lentas y profundas. La nicotina se lleva el crédito, pero tus pulmones hacen el trabajo real.' },
  'breathe.callout': { en: 'Box breathing gives you the same parasympathetic activation without the 50+ chemicals. After 2-3 weeks of practice, your brain rewires to use this as the default stress response.', es: 'La respiración cuadrada te da la misma activación parasimpática sin los 50+ químicos. Después de 2-3 semanas de práctica, tu cerebro se reconfigura para usar esto como respuesta predeterminada al estrés.' },
  'breathe.science': { en: 'The Science', es: 'La Ciencia' },
  'breathe.sci1': { en: 'Extended exhales stimulate the vagus nerve, lowering heart rate instantly (Gerritsen & Band, 2018)', es: 'Las exhalaciones prolongadas estimulan el nervio vago, reduciendo el ritmo cardíaco instantáneamente (Gerritsen & Band, 2018)' },
  'breathe.sci2': { en: '4 rounds reduce cortisol by up to 20% (Ma et al., 2017)', es: '4 rondas reducen el cortisol hasta un 20% (Ma et al., 2017)' },
  'breathe.sci3': { en: 'Regular practice physically rewires your stress response in 2-3 weeks', es: 'La práctica regular reconfigura físicamente tu respuesta al estrés en 2-3 semanas' },
  'breathe.sci4': { en: 'This is literally what your body was doing when you vaped — minus the poison', es: 'Esto es literalmente lo que tu cuerpo hacía cuando vapeabas — menos el veneno' },
  // Cravings panel
  'cravings.title': { en: 'Understanding Your Cravings', es: 'Entendiendo Tus Antojos' },
  'cravings.desc': { en: 'A craving is a <strong>wave</strong> — it rises, peaks, and falls in 3-5 minutes. You don\'t need to fight it. You just need to <strong>surf it</strong>. The technique is called "urge surfing" (Marlatt, 1985) and it\'s one of the most effective tools in addiction research.', es: 'Un antojo es una <strong>ola</strong> — sube, llega al pico y baja en 3-5 minutos. No necesitas luchar contra él. Solo necesitas <strong>surfear la ola</strong>. La técnica se llama "surfeo de impulsos" (Marlatt, 1985) y es una de las herramientas más efectivas en investigación de adicciones.' },
  'cravings.callout': { en: "Every single craving you ride out without vaping physically weakens the neural pathway. Your brain literally rewires. It's not willpower — it's neuroscience.", es: 'Cada antojo que superas sin vapear debilita físicamente la vía neuronal. Tu cerebro literalmente se reconfigura. No es fuerza de voluntad — es neurociencia.' },
  'cravings.wave': { en: 'The Craving Wave', es: 'La Ola del Antojo' },
  'cravings.wave1': { en: '<strong>0-1 min:</strong> Trigger hits. You feel the pull. This is the steepest part.', es: '<strong>0-1 min:</strong> El disparador golpea. Sientes el impulso. Esta es la parte más intensa.' },
  'cravings.wave2': { en: '<strong>1-3 min:</strong> Peak intensity. Your brain is screaming. This is where most people give in.', es: '<strong>1-3 min:</strong> Intensidad máxima. Tu cerebro está gritando. Aquí es donde la mayoría cede.' },
  'cravings.wave3': { en: '<strong>3-5 min:</strong> It starts fading. You made it through the worst.', es: '<strong>3-5 min:</strong> Empieza a desvanecerse. Pasaste lo peor.' },
  'cravings.wave4': { en: '<strong>5+ min:</strong> Gone. You won. The neural pathway just got weaker.', es: '<strong>5+ min:</strong> Se fue. Ganaste. La vía neuronal se acaba de debilitar.' },
  'cravings.habits': { en: 'Hand-to-Mouth Habit Replacements', es: 'Reemplazos del Hábito Mano-a-Boca' },
  'cravings.habitsDesc': { en: "Vaping isn't just nicotine — it's a <strong>physical habit</strong>. Your hand reaches for it automatically. Here are proven replacements that satisfy the same motor pattern:", es: 'Vapear no es solo nicotina — es un <strong>hábito físico</strong>. Tu mano lo busca automáticamente. Aquí hay reemplazos probados que satisfacen el mismo patrón motor:' },
  'habit.pen.title': { en: 'Pen / Pencil Fidget', es: 'Jugar con un Lapicero' },
  'habit.pen.desc': { en: 'Keep a pen in your hand. Click it, twirl it, hold it between your fingers like a vape. Same hand movement, zero nicotine.', es: 'Mantén un lapicero en tu mano. Haz clic, gíralo, sostenlo entre tus dedos como un vape. Mismo movimiento de mano, cero nicotina.' },
  'habit.pen.when': { en: 'When: Working, sitting, thinking', es: 'Cuándo: Trabajando, sentado, pensando' },
  'habit.mints.title': { en: 'Mints & Hard Candy', es: 'Mentas y Caramelos Duros' },
  'habit.mints.desc': { en: 'Strong mints (Altoids, cinnamon) work best. The intense flavor distracts your brain and satisfies the oral fixation.', es: 'Las mentas fuertes (Altoids, canela) funcionan mejor. El sabor intenso distrae tu cerebro y satisface la fijación oral.' },
  'habit.mints.when': { en: 'When: After meals, social events', es: 'Cuándo: Después de comer, eventos sociales' },
  'habit.snacks.title': { en: 'Crunchy Snacks', es: 'Snacks Crujientes' },
  'habit.snacks.desc': { en: 'Carrots, celery, sunflower seeds, apple slices. The chewing and crunching engages your jaw and satisfies the oral need.', es: 'Zanahorias, apio, semillas de girasol, rodajas de manzana. Masticar y crujir activa tu mandíbula y satisface la necesidad oral.' },
  'habit.snacks.when': { en: 'When: At home, watching TV', es: 'Cuándo: En casa, viendo TV' },
  'habit.stress.title': { en: 'Stress Ball / Grip', es: 'Pelota Antiestrés' },
  'habit.stress.desc': { en: 'Squeeze a stress ball or hand gripper. Channels the physical tension somewhere productive. Bonus: builds forearm strength.', es: 'Aprieta una pelota antiestrés o un grip de mano. Canaliza la tensión física de forma productiva. Bonus: fortalece el antebrazo.' },
  'habit.stress.when': { en: 'When: Anxious moments, meetings', es: 'Cuándo: Momentos de ansiedad, reuniones' },
  'habit.water.title': { en: 'Cold Water Bottle', es: 'Botella de Agua Fría' },
  'habit.water.desc': { en: 'Sip ice water through a straw. The cold, the sipping motion, and the hand-holding all mimic vaping sensations.', es: 'Bebe agua helada con un pitillo. El frío, el movimiento de sorber y sostener la botella imitan las sensaciones del vape.' },
  'habit.water.when': { en: 'When: Driving, desk work', es: 'Cuándo: Conduciendo, trabajo de escritorio' },
  'habit.toothpick.title': { en: 'Flavored Toothpick', es: 'Palillo Saborizado' },
  'habit.toothpick.desc': { en: 'Cinnamon or tea tree toothpicks give you something in your mouth and hands. Many ex-smokers swear by this.', es: 'Los palillos de canela o árbol de té te dan algo en la boca y las manos. Muchos ex-fumadores confían en esto.' },
  'habit.toothpick.when': { en: 'When: Social events, bars', es: 'Cuándo: Eventos sociales, bares' },
  'habit.fidget.title': { en: 'Fidget Ring / Worry Stone', es: 'Anillo Fidget / Piedra de Preocupación' },
  'habit.fidget.desc': { en: "A spinner ring or smooth stone you roll between your fingers. Keeps your hands busy without thinking about it.", es: 'Un anillo giratorio o piedra lisa que giras entre tus dedos. Mantiene tus manos ocupadas sin pensarlo.' },
  'habit.fidget.when': { en: 'When: Anywhere, anytime', es: 'Cuándo: Donde sea, cuando sea' },
  'habit.straw.title': { en: 'Deep Breath Through a Straw', es: 'Respiración Profunda por un Pitillo' },
  'habit.straw.desc': { en: 'Inhale slowly through a straw — mimics the exact draw sensation of vaping. Exhale slowly through your nose. Repeat 5x.', es: 'Inhala lentamente por un pitillo — imita la sensación exacta de inhalar del vape. Exhala lentamente por la nariz. Repite 5 veces.' },
  'habit.straw.when': { en: 'When: Intense cravings', es: 'Cuándo: Antojos intensos' },
  'cravings.triggerMap': { en: 'Trigger Map', es: 'Mapa de Disparadores' },
  'cravings.triggerDesc': { en: 'Most vaping happens on autopilot. Identify your triggers so you can prepare:', es: 'La mayoría del vapeo ocurre en automático. Identifica tus disparadores para prepararte:' },
  'cravings.triggerHelp': { en: 'Check the ones that apply to you. For each trigger you identify, plan a specific replacement action. Writing "When X happens, I will do Y instead" (implementation intentions) doubles your success rate (Gollwitzer, 1999).', es: 'Marca los que aplican para ti. Para cada disparador que identifiques, planea una acción de reemplazo específica. Escribir "Cuando pase X, haré Y en su lugar" (intenciones de implementación) duplica tu tasa de éxito (Gollwitzer, 1999).' },
  'cravings.evidenceTitle': { en: 'Things That Actually Help (Evidence-Based)', es: 'Cosas Que Realmente Ayudan (Basadas en Evidencia)' },
  'cravings.ev1': { en: '<strong>Nicotine gum/lozenges (NRT):</strong> Available over the counter. Use for breakthrough cravings, especially in social situations. Clinically proven to improve quit rates by 50-70% (Stead et al., 2012)', es: '<strong>Chicle/pastillas de nicotina (NRT):</strong> Disponibles sin receta. Úsalos para antojos intensos, especialmente en situaciones sociales. Clínicamente probado para mejorar las tasas de abandono un 50-70% (Stead et al., 2012)' },
  'cravings.ev2': { en: '<strong>Exercise:</strong> Even 10 minutes reduces cravings significantly. The endorphins replace the dopamine hit from nicotine', es: '<strong>Ejercicio:</strong> Incluso 10 minutos reducen los antojos significativamente. Las endorfinas reemplazan el golpe de dopamina de la nicotina' },
  'cravings.ev3': { en: '<strong>Sleep:</strong> Poor sleep increases cravings 40%. Prioritize 7+ hours', es: '<strong>Sueño:</strong> Dormir mal aumenta los antojos un 40%. Prioriza 7+ horas' },
  'cravings.ev4': { en: '<strong>Water:</strong> Dehydration intensifies cravings. Drink a full glass when a craving hits', es: '<strong>Agua:</strong> La deshidratación intensifica los antojos. Bebe un vaso lleno cuando te dé un antojo' },
  'cravings.ev5': { en: '<strong>CBT (therapy):</strong> The gold standard for anxiety + cessation. Many therapists offer it online. This is the single most effective intervention available', es: '<strong>TCC (terapia):</strong> El estándar de oro para ansiedad + cesación. Muchos terapeutas lo ofrecen online. Es la intervención más efectiva disponible' },
  // Plan panel
  'plan.title': { en: 'Your Frequency Reduction Plan', es: 'Tu Plan de Reducción de Frecuencia' },
  'plan.desc': { en: 'Since you\'re using a 5% nicotine vape with no lower option, the strategy shifts to <strong>reducing how often you use it</strong>. This is called "scheduled reduction" and research shows it\'s effective — especially for anxious quitters, because it avoids the shock of going cold turkey (Cinciripini et al., 1995).', es: 'Ya que usas un vape de nicotina al 5% sin opción más baja, la estrategia cambia a <strong>reducir qué tan seguido lo usas</strong>. Esto se llama "reducción programada" y la investigación muestra que es efectivo — especialmente para quienes dejan con ansiedad, porque evita el shock de dejarlo de golpe (Cinciripini et al., 1995).' },
  'plan.weeks': { en: 'Weeks', es: 'Semanas' },
  'plan.goal': { en: 'Goal', es: 'Meta' },
  'plan.strategy': { en: 'Strategy', es: 'Estrategia' },
  'plan.phase': { en: 'Phase', es: 'Fase' },
  'plan.callout': { en: "Key principle: Don't try to resist a craving with nothing. Always have a REPLACEMENT ready — gum, breathing, a fidget, a walk. Willpower alone fails. Systems win.", es: 'Principio clave: No intentes resistir un antojo sin nada. Siempre ten un REEMPLAZO listo — chicle, respiración, un fidget, una caminata. La fuerza de voluntad sola falla. Los sistemas ganan.' },
  'plan.anxietyTitle': { en: 'The Truth About Anxiety + Nicotine', es: 'La Verdad Sobre la Ansiedad + Nicotina' },
  'plan.anxietyIntro': { en: 'This is the most important thing you\'ll read in this app:', es: 'Esto es lo más importante que leerás en esta app:' },
  'plan.anxietyDesc': { en: 'Nicotine <strong>feels</strong> like it helps your anxiety. But the science shows it actually <strong>makes it worse</strong>:', es: 'La nicotina <strong>se siente</strong> como si ayudara tu ansiedad. Pero la ciencia muestra que en realidad <strong>la empeora</strong>:' },
  'plan.anx1': { en: 'Nicotine withdrawal creates anxiety symptoms → the next hit "relieves" it → you think it helped → this <strong>increases your baseline anxiety</strong> over time (Moylan et al., 2013)', es: 'La abstinencia de nicotina crea síntomas de ansiedad → la siguiente calada la "alivia" → crees que ayudó → esto <strong>aumenta tu ansiedad base</strong> con el tiempo (Moylan et al., 2013)' },
  'plan.anx2': { en: 'People who quit experience <strong>reduced anxiety equal to taking medication</strong> within 1-3 months (Taylor et al., 2014)', es: 'Las personas que dejan experimentan <strong>reducción de ansiedad igual a tomar medicación</strong> en 1-3 meses (Taylor et al., 2014)' },
  'plan.anx3': { en: 'The hardest window is days 3-14 after full cessation. After that, it improves every week', es: 'La ventana más difícil son los días 3-14 después de la cesación total. Después de eso, mejora cada semana' },
  'plan.anxCallout': { en: "You're not losing a coping tool. You're breaking free from something that was quietly making your anxiety worse every single day. The person you'll be in 3 months will be calmer, more present, and genuinely less anxious. That person is worth fighting for.", es: 'No estás perdiendo una herramienta. Te estás liberando de algo que silenciosamente empeoraba tu ansiedad cada día. La persona que serás en 3 meses será más tranquila, más presente y genuinamente menos ansiosa. Esa persona vale la pena.' },
  'plan.checklistTitle': { en: 'Getting Started Checklist', es: 'Lista para Comenzar' },
  'plan.checklistDesc': { en: 'Complete these to begin your journey:', es: 'Completa estos para comenzar tu viaje:' },
  // Social panel
  'social.title': { en: 'Social Situations Toolkit', es: 'Kit para Situaciones Sociales' },
  'social.desc': { en: "This is your hardest trigger — so it gets the most preparation. These strategies are based on CBT principles for social anxiety and substance use. You're not broken for finding this hard. <strong>Everyone</strong> does.", es: 'Este es tu disparador más difícil — por eso recibe la mayor preparación. Estas estrategias están basadas en principios de TCC para ansiedad social y uso de sustancias. No estás roto/a por encontrar esto difícil. <strong>Todos</strong> lo encuentran así.' },
  'social.before.title': { en: 'Before You Arrive', es: 'Antes de Llegar' },
  'social.before.desc': { en: 'Vape <strong>before</strong> the event so you arrive satisfied. Set one rule: "I won\'t vape in the first 30 minutes." This breaks the automatic link between "social = vape." After a few events, the association weakens permanently.', es: 'Vapea <strong>antes</strong> del evento para llegar satisfecho/a. Pon una regla: "No vapearé en los primeros 30 minutos." Esto rompe el vínculo automático entre "social = vape." Después de algunos eventos, la asociación se debilita permanentemente.' },
  'social.before.tag': { en: 'Pre-event', es: 'Pre-evento' },
  'social.hand.title': { en: 'The Dominant Hand Trick', es: 'El Truco de la Mano Dominante' },
  'social.hand.desc': { en: "Keep a drink in your dominant hand the entire time. This physically blocks the hand-to-mouth reflex. It's stupidly simple — and that's why it works.", es: 'Mantén una bebida en tu mano dominante todo el tiempo. Esto bloquea físicamente el reflejo mano-a-boca. Es increíblemente simple — y por eso funciona.' },
  'social.hand.tag': { en: 'During event', es: 'Durante evento' },
  'social.response.title': { en: 'Your Pre-Loaded Response', es: 'Tu Respuesta Preparada' },
  'social.response.desc': { en: 'When someone offers or asks, use: <strong>"I\'m cutting back"</strong> — three words, no debate, no awkwardness. Practice saying it out loud before you go. CBT research shows rehearsed responses dramatically reduce social anxiety about refusal.', es: 'Cuando alguien ofrezca o pregunte, usa: <strong>"Estoy reduciendo"</strong> — dos palabras, sin debate, sin incomodidad. Practica diciéndolo en voz alta antes de ir. La investigación en TCC muestra que las respuestas ensayadas reducen dramáticamente la ansiedad social sobre el rechazo.' },
  'social.response.tag': { en: 'Key phrase', es: 'Frase clave' },
  'social.weapons.title': { en: 'Your Secret Weapons: Pocket Kit', es: 'Tus Armas Secretas: Kit de Bolsillo' },
  'social.weapons.desc': { en: 'Bring a small kit to every social event: <strong>strong mints, a fidget ring or worry stone, and nicotine gum (just in case).</strong> Having backups reduces anxiety because you know you\'re prepared. You may not even use them — but knowing they\'re there is the point.', es: 'Lleva un pequeño kit a cada evento social: <strong>mentas fuertes, un anillo fidget o piedra de preocupación, y chicle de nicotina (por si acaso).</strong> Tener respaldos reduce la ansiedad porque sabes que estás preparado/a. Puede que ni los uses — pero saber que están ahí es el punto.' },
  'social.weapons.tag': { en: 'Game changer', es: 'Cambio de juego' },
  'social.buddy.title': { en: 'Find Your Accountability Buddy', es: 'Encuentra Tu Compañero de Apoyo' },
  'social.buddy.desc': { en: 'Tell <strong>one</strong> friend about your goal. Not for a lecture — just someone who knows. When you feel the pull, text them or make eye contact. Social support increases quit success by 30% (Westmaas et al., 2010).', es: 'Dile a <strong>un</strong> amigo sobre tu meta. No para un sermón — solo alguien que sepa. Cuando sientas el impulso, escríbele o haz contacto visual. El apoyo social aumenta el éxito al dejar en un 30% (Westmaas et al., 2010).' },
  'social.buddy.tag': { en: 'Support', es: 'Apoyo' },
  'social.swap.title': { en: 'The Step-Away Swap', es: 'El Intercambio al Salir' },
  'social.swap.desc': { en: 'When you feel the pull to go outside and vape, <strong>still step away</strong> — but do 2 minutes of box breathing or walk around the block instead. You keep the break from socializing (which is what you actually need), just without nicotine.', es: 'Cuando sientas el impulso de salir a vapear, <strong>igual sal</strong> — pero haz 2 minutos de respiración cuadrada o camina por la cuadra. Mantienes el descanso de socializar (que es lo que realmente necesitas), solo sin nicotina.' },
  'social.swap.tag': { en: 'Replacement', es: 'Reemplazo' },
  'social.reframe.title': { en: 'The Reframe', es: 'El Reencuadre' },
  'social.reframe.desc': { en: '<em>"I can\'t socialize without nicotine"</em> → You did it as a child, a teenager before vaping, and in many situations now. Nicotine withdrawal mimics social anxiety (racing heart, restlessness) but <strong>isn\'t the same thing</strong>. After 2-4 weeks, most people feel more comfortable socially, not less.', es: '<em>"No puedo socializar sin nicotina"</em> → Lo hiciste de niño/a, de adolescente antes de vapear, y en muchas situaciones ahora. La abstinencia de nicotina imita la ansiedad social (corazón acelerado, inquietud) pero <strong>no es lo mismo</strong>. Después de 2-4 semanas, la mayoría se siente más cómoda socialmente, no menos.' },
  'social.reframe.tag': { en: 'Mindset', es: 'Mentalidad' },
  'social.setback.title': { en: 'Setback Protocol', es: 'Protocolo de Recaída' },
  'social.setback.intro': { en: 'If you slip at a party — <strong>read this:</strong>', es: 'Si recaes en una fiesta — <strong>lee esto:</strong>' },
  'social.setback1': { en: 'One slip is NOT a relapse. The Abstinence Violation Effect ("I already failed, might as well keep going") is the real enemy', es: 'Un desliz NO es una recaída. El Efecto de Violación de Abstinencia ("ya fallé, mejor sigo") es el verdadero enemigo' },
  'social.setback2': { en: 'Log it in your journal — what triggered it, how you felt', es: 'Regístralo en tu diario — qué lo disparó, cómo te sentiste' },
  'social.setback3': { en: 'Do NOT reset your mental timeline', es: 'NO reinicies tu línea temporal mental' },
  'social.setback4': { en: 'One slip in a month = you succeeded <strong>29 out of 30 days</strong>. That\'s a 97% success rate', es: 'Un desliz en un mes = tuviste éxito <strong>29 de 30 días</strong>. Eso es un 97% de éxito' },
  'social.setback5': { en: "Resume the plan tomorrow as if nothing happened. Because nothing did — you're still on track", es: 'Retoma el plan mañana como si nada pasara. Porque nada pasó — sigues en camino' },
  'social.setbackCallout': { en: "Perfection isn't the goal. Progress is. And progress isn't linear — it's messy and human. Just like you. Keep going.", es: 'La perfección no es la meta. El progreso sí. Y el progreso no es lineal — es desordenado y humano. Igual que tú. Sigue adelante.' },
  // Journal
  'journal.title': { en: 'Your Journal', es: 'Tu Diario' },
  'journal.desc': { en: 'Writing about cravings, victories, and feelings improves quit outcomes by 25% (Pennebaker, 1997). This is private and stays on your device only.', es: 'Escribir sobre antojos, victorias y sentimientos mejora los resultados al dejar en un 25% (Pennebaker, 1997). Esto es privado y se queda solo en tu dispositivo.' },
  'journal.placeholder': { en: 'How are you feeling today? What triggered a craving? What are you proud of? Write anything...', es: '¿Cómo te sientes hoy? ¿Qué disparó un antojo? ¿De qué estás orgulloso/a? Escribe lo que quieras...' },
  'journal.save': { en: 'Save Entry', es: 'Guardar Entrada' },
  // Progress
  'progress.timeline': { en: 'Your Journey Timeline', es: 'Tu Línea de Tiempo' },
  'progress.trend': { en: 'Craving & Anxiety Trend', es: 'Tendencia de Antojos y Ansiedad' },
  'progress.trendDesc': { en: 'Your daily scores over the last 14 days. Fluctuations are normal — the <strong>overall downward trend</strong> is what matters. Some days will be harder. That\'s not failure, that\'s the process.', es: 'Tus puntajes diarios de los últimos 14 días. Las fluctuaciones son normales — la <strong>tendencia general a la baja</strong> es lo que importa. Algunos días serán más difíciles. Eso no es fracaso, es el proceso.' },
  'progress.achievements': { en: 'Achievements', es: 'Logros' },
  'progress.chartEmpty': { en: 'Check in for at least 2 days to see your trend', es: 'Haz check-in por al menos 2 días para ver tu tendencia' },
  'progress.cravings': { en: '● Cravings', es: '● Antojos' },
  'progress.anxiety': { en: '● Anxiety', es: '● Ansiedad' },
  // Settings
  'settings.title': { en: 'Your Settings', es: 'Tus Ajustes' },
  'settings.desc': { en: 'Personalize BreatheFreely to match your situation.', es: 'Personaliza BreatheFreely para tu situación.' },
  'settings.language': { en: 'Language', es: 'Idioma' },
  'settings.name': { en: 'Your Name', es: 'Tu Nombre' },
  'settings.namePlaceholder': { en: 'e.g. Majo', es: 'ej. Majo' },
  'settings.nameDesc': { en: 'Used to personalize greetings and motivational messages throughout the app.', es: 'Usado para personalizar saludos y mensajes motivacionales en toda la app.' },
  'settings.money': { en: 'Money Tracking', es: 'Seguimiento de Dinero' },
  'settings.currency': { en: 'Currency Symbol', es: 'Símbolo de Moneda' },
  'settings.weeklySpend': { en: 'How much do you spend per WEEK on vaping?', es: '¿Cuánto gastas por SEMANA en vapear?' },
  'settings.perWeek': { en: '/ week', es: '/ semana' },
  'settings.moneyDesc': { en: 'This calculates how much you\'re saving as you reduce. Your daily cost = weekly spend / 7.', es: 'Esto calcula cuánto estás ahorrando mientras reduces. Tu costo diario = gasto semanal / 7.' },
  'settings.puffBaseline': { en: 'Puff Baseline', es: 'Base de Caladas' },
  'settings.puffLabel': { en: 'Average puffs per day (your starting point)', es: 'Caladas promedio por día (tu punto de inicio)' },
  'settings.puffDesc': { en: "This sets your reduction targets. If you're not sure, track for a few days first and come back.", es: 'Esto establece tus metas de reducción. Si no estás seguro/a, registra por unos días primero y vuelve.' },
  'settings.save': { en: 'Save Settings', es: 'Guardar Ajustes' },
  'settings.danger': { en: 'Danger Zone', es: 'Zona de Peligro' },
  'settings.dangerDesc': { en: 'This permanently deletes all your data — check-ins, journal entries, achievements, everything.', es: 'Esto elimina permanentemente todos tus datos — check-ins, entradas de diario, logros, todo.' },
  'settings.reset': { en: 'Reset All Data', es: 'Reiniciar Todos los Datos' },
  // Toasts
  'toast.checkinSaved': { en: 'Check-in saved! You showed up today — that matters.', es: '¡Check-in guardado! Te presentaste hoy — eso importa.' },
  'toast.checkinSavedName': { en: 'Check-in saved! You showed up today, ', es: '¡Check-in guardado! Te presentaste hoy, ' },
  'toast.journalSaved': { en: 'Journal entry saved. Reflecting = healing.', es: 'Entrada de diario guardada. Reflexionar = sanar.' },
  'toast.settingsSaved': { en: 'Settings saved!', es: '¡Ajustes guardados!' },
  'toast.settingsSavedName': { en: "Settings saved! Let's go, ", es: '¡Ajustes guardados! Vamos, ' },
  'toast.breathComplete': { en: ' rounds done. You\'re in control.', es: ' rondas completadas. Tienes el control.' },
  'toast.breathSession': { en: ' rounds complete — your body thanks you.', es: ' rondas completadas — tu cuerpo te lo agradece.' },
  'toast.sessionComplete': { en: 'Session complete — ', es: 'Sesión completa — ' },
  'toast.resetConfirm1': { en: 'This will delete ALL your data. Are you sure?', es: '¿Esto eliminará TODOS tus datos. ¿Estás seguro/a?' },
  'toast.resetConfirm2': { en: 'Really? This cannot be undone.', es: '¿De verdad? Esto no se puede deshacer.' },
  // Puff tracker
  'puff.tracking': { en: 'Tracking phase — just count honestly. Your average becomes the baseline.', es: 'Fase de seguimiento — solo cuenta honestamente. Tu promedio se convierte en la base.' },
  'puff.target': { en: "Today's target: ", es: 'Meta de hoy: ' },
  'puff.orFewer': { en: ' puffs or fewer', es: ' caladas o menos' },
  'puff.onTrack': { en: " — You're on track!", es: ' — ¡Vas por buen camino!' },
  // Milestones
  'milestone.unlocked': { en: 'Unlocked!', es: '¡Desbloqueado!' },
  // Week days
  'days.mon': { en: 'Mon', es: 'Lun' },
  'days.tue': { en: 'Tue', es: 'Mar' },
  'days.wed': { en: 'Wed', es: 'Mié' },
  'days.thu': { en: 'Thu', es: 'Jue' },
  'days.fri': { en: 'Fri', es: 'Vie' },
  'days.sat': { en: 'Sat', es: 'Sáb' },
  'days.sun': { en: 'Sun', es: 'Dom' },
  // Breath phases
  'breath.in': { en: 'Breathe In', es: 'Inhala' },
  'breath.hold': { en: 'Hold', es: 'Mantén' },
  'breath.out': { en: 'Breathe Out', es: 'Exhala' },
  // Badges
  'badge.earned': { en: 'Earned!', es: '¡Ganado!' },
  'badge.locked': { en: 'Locked', es: 'Bloqueado' },
  // Plan table
  'plan.r1.goal': { en: 'Track baseline', es: 'Registrar base' },
  'plan.r1.strategy': { en: 'Count every puff. No reduction yet — just observe.', es: 'Cuenta cada calada. Sin reducción aún — solo observa.' },
  'plan.r1.phase': { en: 'Awareness', es: 'Consciencia' },
  'plan.r2.goal': { en: 'Reduce 25%', es: 'Reducir 25%' },
  'plan.r2.strategy': { en: 'If you average 40 puffs/day, target 30. Cut the "automatic" ones first.', es: 'Si promedias 40 caladas/día, apunta a 30. Elimina las "automáticas" primero.' },
  'plan.r2.phase': { en: 'Reduce', es: 'Reducir' },
  'plan.r3.goal': { en: 'Reduce 50%', es: 'Reducir 50%' },
  'plan.r3.strategy': { en: 'Target half your baseline. Add 10-min delays before each session.', es: 'Apunta a la mitad de tu base. Agrega retrasos de 10 min antes de cada sesión.' },
  'plan.r4.goal': { en: 'Reduce 75%', es: 'Reducir 75%' },
  'plan.r4.strategy': { en: 'Vape only at designated times (after meals, before bed). Max 3 sessions/day.', es: 'Vapea solo en tiempos designados (después de comer, antes de dormir). Máx 3 sesiones/día.' },
  'plan.r4.phase': { en: 'Structure', es: 'Estructura' },
  'plan.r5.goal': { en: '1-2x per day', es: '1-2x por día' },
  'plan.r5.strategy': { en: 'Only vape once or twice. Use NRT gum for breakthroughs.', es: 'Solo vapea una o dos veces. Usa chicle de nicotina para emergencias.' },
  'plan.r6.goal': { en: 'Zero', es: 'Cero' },
  'plan.r6.strategy': { en: "Full stop. Use every tool in this app. You're ready.", es: 'Alto total. Usa cada herramienta en esta app. Estás listo/a.' },
  'plan.r6.phase': { en: 'Freedom', es: 'Libertad' },
};

// Bilingual arrays
const dailyTasksI18n = {
  en: [
    "I stayed at or below my puff target today",
    "I used a replacement (gum, mint, fidget) instead of vaping at least once",
    "I did a breathing exercise",
    "I moved my body for 10+ minutes",
    "I identified a trigger and chose a different response",
    "I drank plenty of water today",
    "I'm proud of myself for trying — even if today wasn't perfect"
  ],
  es: [
    "Me mantuve en o por debajo de mi meta de caladas hoy",
    "Usé un sustituto (chicle, menta, fidget) en vez de vapear al menos una vez",
    "Hice un ejercicio de respiración",
    "Moví mi cuerpo por 10+ minutos",
    "Identifiqué un disparador y elegí una respuesta diferente",
    "Tomé suficiente agua hoy",
    "Estoy orgulloso/a de mí por intentarlo — aunque hoy no fue perfecto"
  ]
};

const setupTasksI18n = {
  en: [
    "Write down 3 personal reasons for quitting",
    "Set your start date (today counts!)",
    "Buy oral substitutes: strong mints, gum, toothpicks",
    "Get a fidget (stress ball, spinner ring, or worry stone)",
    "Consider buying nicotine gum/lozenges for breakthrough cravings",
    "Tell one person about your goal",
    "Remove the vape from your nightstand / easy-access spots"
  ],
  es: [
    "Escribe 3 razones personales para dejar",
    "Establece tu fecha de inicio (¡hoy cuenta!)",
    "Compra sustitutos orales: mentas fuertes, chicle, palillos",
    "Consigue un fidget (pelota antiestrés, anillo giratorio o piedra)",
    "Considera comprar chicle/pastillas de nicotina para antojos fuertes",
    "Dile a una persona sobre tu meta",
    "Retira el vape de tu mesita de noche / lugares de fácil acceso"
  ]
};

const triggersI18n = {
  en: [
    "After eating a meal", "First thing in the morning", "While driving",
    "When feeling anxious or stressed", "During social events / parties",
    "When drinking alcohol", "When bored / scrolling phone", "Before bed",
    "During work breaks", "After an argument or conflict", "When seeing others vape"
  ],
  es: [
    "Después de comer", "Al despertar", "Mientras conduzco",
    "Cuando me siento ansioso/a o estresado/a", "En eventos sociales / fiestas",
    "Cuando tomo alcohol", "Cuando estoy aburrido/a / viendo el celular", "Antes de dormir",
    "En descansos del trabajo", "Después de una discusión o conflicto", "Cuando veo a otros vapear"
  ]
};

const milestonesI18n = {
  en: [
    { hours: 1,    icon: 'heart',        title: 'Heart rate normalizing',         desc: 'Heart rate and blood pressure begin dropping.' },
    { hours: 8,    icon: 'wind',         title: 'Oxygen levels recover',          desc: 'Carbon monoxide clears. Oxygen returns to normal.' },
    { hours: 24,   icon: 'sparkles',     title: 'Lungs start clearing',           desc: 'Lungs begin clearing mucus and debris.' },
    { hours: 48,   icon: 'sun',          title: 'Taste & smell return',           desc: 'Nerve endings regrow. Food tastes amazing again.' },
    { hours: 72,   icon: 'zap',          title: 'Breathing easier',               desc: 'Bronchial tubes relax. Energy levels rise.' },
    { hours: 336,  icon: 'shield',       title: 'Immune boost (2 weeks)',         desc: 'Circulation improves. Immune function strengthens.' },
    { hours: 720,  icon: 'lightbulb',    title: 'Anxiety decreases (1 month)',    desc: 'Baseline anxiety drops to non-smoker levels.' },
    { hours: 2160, icon: 'trending-up',  title: 'Lung function +30% (3 months)', desc: 'Lung capacity significantly improved.' },
  ],
  es: [
    { hours: 1,    icon: 'heart',        title: 'Ritmo cardíaco normalizándose',         desc: 'El ritmo cardíaco y la presión arterial comienzan a bajar.' },
    { hours: 8,    icon: 'wind',         title: 'Niveles de oxígeno se recuperan',       desc: 'El monóxido de carbono se elimina. El oxígeno vuelve a la normalidad.' },
    { hours: 24,   icon: 'sparkles',     title: 'Los pulmones empiezan a limpiarse',     desc: 'Los pulmones comienzan a eliminar mucosidad y residuos.' },
    { hours: 48,   icon: 'sun',          title: 'El gusto y olfato regresan',            desc: 'Las terminaciones nerviosas se regeneran. La comida sabe increíble otra vez.' },
    { hours: 72,   icon: 'zap',          title: 'Respirar es más fácil',                desc: 'Los tubos bronquiales se relajan. Los niveles de energía suben.' },
    { hours: 336,  icon: 'shield',       title: 'Impulso inmunológico (2 semanas)',      desc: 'La circulación mejora. La función inmune se fortalece.' },
    { hours: 720,  icon: 'lightbulb',    title: 'La ansiedad disminuye (1 mes)',         desc: 'La ansiedad base baja a niveles de no fumador.' },
    { hours: 2160, icon: 'trending-up',  title: 'Función pulmonar +30% (3 meses)',       desc: 'La capacidad pulmonar mejora significativamente.' },
  ]
};

const motivBannersI18n = {
  en: [
    { text: "Every craving you survive is a <strong>neural pathway getting weaker</strong>. You are literally rewiring your brain right now.", sub: "Neuroscience backs this — it's not just motivation, it's biology." },
    { text: "You are not giving something up. You are <strong>getting yourself back</strong>.", sub: "The calm, present, un-addicted version of you is already emerging." },
    { text: "The anxiety you feel isn't you — it's <strong>nicotine withdrawal pretending to be you</strong>.", sub: "Real you is calmer. You'll meet that person soon." },
    { text: "People who quit nicotine see anxiety drop to <strong>the same level as taking medication</strong>.", sub: "Taylor et al., 2014 — this is published, peer-reviewed science." },
    { text: "The craving you're fighting right now will <strong>last 3-5 minutes</strong>. Your freedom lasts forever.", sub: "Set a timer. You'll be shocked how fast it passes." },
    { text: "You didn't come this far to <strong>only come this far</strong>.", sub: "Look at your stats above. That's real progress. That's you." },
    { text: "A bad day doesn't erase a good week. <strong>Progress isn't linear</strong> — and that's okay.", sub: "The overall trend is what matters. Keep showing up." },
    { text: "Your lungs are healing <strong>right now</strong>, even as you read this.", sub: "Your body wants to recover. You just have to let it." },
    { text: "The version of you who started this journey would be <strong>proud of today's you</strong>.", sub: "Don't forget to celebrate how far you've come." },
    { text: "Discipline isn't about perfection. It's about <strong>getting back up one more time than you fall</strong>.", sub: "Every day you try is a day you win." },
    { text: "In 3 months, you'll look back and be <strong>grateful you didn't quit quitting</strong>.", sub: "Future you is counting on present you. Don't let them down." },
    { text: "You are stronger than a <strong>3-minute craving</strong>. You've survived harder things.", sub: "This feeling is temporary. Your strength is not." },
  ],
  es: [
    { text: "Cada antojo que superas es una <strong>vía neuronal debilitándose</strong>. Literalmente estás reconfigurando tu cerebro ahora mismo.", sub: "La neurociencia lo respalda — no es solo motivación, es biología." },
    { text: "No estás renunciando a algo. Estás <strong>recuperándote a ti mismo/a</strong>.", sub: "La versión tranquila, presente y libre de adicción de ti ya está emergiendo." },
    { text: "La ansiedad que sientes no eres tú — es la <strong>abstinencia de nicotina pretendiendo ser tú</strong>.", sub: "El verdadero tú es más tranquilo/a. Pronto conocerás a esa persona." },
    { text: "Las personas que dejan la nicotina ven su ansiedad bajar al <strong>mismo nivel que tomar medicación</strong>.", sub: "Taylor et al., 2014 — esto es ciencia publicada y revisada por pares." },
    { text: "El antojo contra el que luchas ahora <strong>durará 3-5 minutos</strong>. Tu libertad dura para siempre.", sub: "Pon un temporizador. Te sorprenderá lo rápido que pasa." },
    { text: "No llegaste hasta aquí para <strong>solo llegar hasta aquí</strong>.", sub: "Mira tus estadísticas arriba. Eso es progreso real. Eso eres tú." },
    { text: "Un mal día no borra una buena semana. <strong>El progreso no es lineal</strong> — y está bien.", sub: "La tendencia general es lo que importa. Sigue presentándote." },
    { text: "Tus pulmones se están sanando <strong>ahora mismo</strong>, mientras lees esto.", sub: "Tu cuerpo quiere recuperarse. Solo tienes que dejarlo." },
    { text: "La versión de ti que empezó este viaje estaría <strong>orgullosa del tú de hoy</strong>.", sub: "No olvides celebrar lo lejos que has llegado." },
    { text: "La disciplina no se trata de perfección. Se trata de <strong>levantarte una vez más de las que caes</strong>.", sub: "Cada día que intentas es un día que ganas." },
    { text: "En 3 meses, mirarás atrás y estarás <strong>agradecido/a de no haber dejado de intentar</strong>.", sub: "El tú del futuro cuenta con el tú del presente. No lo decepciones." },
    { text: "Eres más fuerte que un <strong>antojo de 3 minutos</strong>. Has sobrevivido cosas más difíciles.", sub: "Este sentimiento es temporal. Tu fuerza no lo es." },
  ]
};

const nameInsertsI18n = {
  en: ['{name}, remember: ', 'Hey {name} — ', '{name}, listen: ', '{name}, ', "You've got this, {name}. "],
  es: ['{name}, recuerda: ', 'Oye {name} — ', '{name}, escucha: ', '{name}, ', 'Tú puedes, {name}. ']
};

const quotesI18n = {
  en: [
    "You don't have to be fearless. You just have to be <strong>brave enough to start</strong>.",
    "Every craving you resist makes the next one <strong>weaker</strong>. That's not motivation — that's <strong>neuroscience</strong>.",
    "The discomfort is temporary. The freedom is <strong>permanent</strong>.",
    "You're not giving something up — you're <strong>getting yourself back</strong>.",
    "Anxiety lies. It says you can't do this. But here you are, <strong>doing it anyway</strong>.",
    "Progress isn't linear. A bad day doesn't erase <strong>a good week</strong>.",
    "Your lungs are healing <strong>right now</strong>, as you read this.",
    "The version of you who started this would be <strong>so proud of today's you</strong>.",
    "Small steps still move you <strong>forward</strong>.",
    "You didn't come this far to <strong>only come this far</strong>.",
    "Courage isn't the absence of fear. It's <strong>acting in spite of it</strong>.",
    "3 months from now, you'll wish you had <strong>started today</strong>. Oh wait — you did.",
    "You are not your addiction. You are the person <strong>fighting it</strong>.",
    "The only person you need to be better than is <strong>who you were yesterday</strong>.",
    "Some days the mountain seems impossible. But you're already <strong>climbing it</strong>.",
  ],
  es: [
    "No tienes que ser valiente. Solo tienes que ser <strong>lo suficientemente valiente para empezar</strong>.",
    "Cada antojo que resistes hace al siguiente <strong>más débil</strong>. Eso no es motivación — es <strong>neurociencia</strong>.",
    "La incomodidad es temporal. La libertad es <strong>permanente</strong>.",
    "No estás renunciando a algo — estás <strong>recuperándote a ti mismo/a</strong>.",
    "La ansiedad miente. Dice que no puedes. Pero aquí estás, <strong>haciéndolo de todos modos</strong>.",
    "El progreso no es lineal. Un mal día no borra <strong>una buena semana</strong>.",
    "Tus pulmones se están sanando <strong>ahora mismo</strong>, mientras lees esto.",
    "La versión de ti que empezó esto estaría <strong>muy orgullosa del tú de hoy</strong>.",
    "Los pasos pequeños igual te mueven <strong>hacia adelante</strong>.",
    "No llegaste hasta aquí para <strong>solo llegar hasta aquí</strong>.",
    "El coraje no es la ausencia de miedo. Es <strong>actuar a pesar de él</strong>.",
    "En 3 meses, desearás haber <strong>empezado hoy</strong>. Ah espera — ya lo hiciste.",
    "No eres tu adicción. Eres la persona que <strong>lucha contra ella</strong>.",
    "La única persona que necesitas superar es <strong>quien eras ayer</strong>.",
    "Algunos días la montaña parece imposible. Pero ya la estás <strong>escalando</strong>.",
  ]
};

const badgesI18n = {
  en: [
    { icon: 'leaf',             title: 'Journey Started',    desc: 'You took the hardest step — the first one.' },
    { icon: 'sun',              title: 'Day One',            desc: 'Your first full day on the plan.' },
    { icon: 'flame',            title: 'Three Day Streak',   desc: 'The first 72 hours are the hardest. You did it.' },
    { icon: 'star',             title: 'One Week Strong',    desc: '7 days of commitment. This is real.' },
    { icon: 'target',           title: 'Two Weeks',          desc: 'Officially through the awareness phase.' },
    { icon: 'trophy',           title: 'One Month',          desc: 'Your brain is actively rewiring. Anxiety is dropping.' },
    { icon: 'gem',              title: 'Two Months',         desc: "Nicotine receptors are downregulating. You're changing." },
    { icon: 'crown',            title: 'Plan Complete',      desc: "12 weeks. You conquered it. You're free." },
    { icon: 'clipboard-check',  title: 'Consistent Tracker', desc: '7 daily check-ins. Awareness is your superpower.' },
    { icon: 'dumbbell',         title: 'Craving Crusher',   desc: '10 cravings beaten. Each one made you stronger.' },
    { icon: 'zap',              title: 'Unstoppable',        desc: '50 cravings defeated. You are a force.' },
    { icon: 'wind',             title: 'Zen Master',         desc: '20 breathing rounds. Your nervous system thanks you.' },
    { icon: 'pencil',           title: 'Reflective Mind',    desc: '5 journal entries. Self-awareness is healing.' },
    { icon: 'book-open',        title: 'Storyteller',        desc: "20 entries. You're writing the story of your freedom." },
  ],
  es: [
    { icon: 'leaf',             title: 'Viaje Iniciado',          desc: 'Diste el paso más difícil — el primero.' },
    { icon: 'sun',              title: 'Día Uno',                 desc: 'Tu primer día completo en el plan.' },
    { icon: 'flame',            title: 'Racha de Tres Días',      desc: 'Las primeras 72 horas son las más difíciles. Lo lograste.' },
    { icon: 'star',             title: 'Una Semana Fuerte',       desc: '7 días de compromiso. Esto es real.' },
    { icon: 'target',           title: 'Dos Semanas',             desc: 'Oficialmente pasaste la fase de consciencia.' },
    { icon: 'trophy',           title: 'Un Mes',                  desc: 'Tu cerebro se está reconfigurando activamente. La ansiedad está bajando.' },
    { icon: 'gem',              title: 'Dos Meses',               desc: 'Los receptores de nicotina se están regulando a la baja. Estás cambiando.' },
    { icon: 'crown',            title: 'Plan Completado',         desc: '12 semanas. Lo conquistaste. Eres libre.' },
    { icon: 'clipboard-check',  title: 'Tracker Consistente',     desc: '7 check-ins diarios. La consciencia es tu superpoder.' },
    { icon: 'dumbbell',         title: 'Destructor de Antojos',   desc: '10 antojos vencidos. Cada uno te hizo más fuerte.' },
    { icon: 'zap',              title: 'Imparable',               desc: '50 antojos derrotados. Eres una fuerza.' },
    { icon: 'wind',             title: 'Maestro Zen',             desc: '20 rondas de respiración. Tu sistema nervioso te lo agradece.' },
    { icon: 'pencil',           title: 'Mente Reflexiva',         desc: '5 entradas de diario. La autoconciencia es sanación.' },
    { icon: 'book-open',        title: 'Narrador/a',              desc: '20 entradas. Estás escribiendo la historia de tu libertad.' },
  ]
};

const timelinePhasesI18n = {
  en: [
    { w: 0, label: 'Awareness', desc: 'Track every puff. Build self-awareness. Prepare your tools.' },
    { w: 2, label: 'First Cut (-25%)', desc: 'Eliminate the automatic, mindless puffs first.' },
    { w: 4, label: 'Half Way (-50%)', desc: 'Down to half. Add 10-min delays. Use replacements.' },
    { w: 6, label: 'Structured Use (-75%)', desc: 'Designated times only. Max 3 sessions per day.' },
    { w: 8, label: 'Almost Free (1-2/day)', desc: 'Once or twice daily. NRT for breakthroughs.' },
    { w: 10, label: 'Full Stop', desc: 'Zero puffs. Every tool in this app is ready for you.' },
    { w: 12, label: 'Freedom', desc: "You did it. The hardest thing you've ever done. Maintain & celebrate." },
  ],
  es: [
    { w: 0, label: 'Consciencia', desc: 'Registra cada calada. Construye autoconciencia. Prepara tus herramientas.' },
    { w: 2, label: 'Primer Corte (-25%)', desc: 'Elimina primero las caladas automáticas e inconscientes.' },
    { w: 4, label: 'A la Mitad (-50%)', desc: 'Reducido a la mitad. Agrega retrasos de 10 min. Usa reemplazos.' },
    { w: 6, label: 'Uso Estructurado (-75%)', desc: 'Solo en tiempos designados. Máx 3 sesiones por día.' },
    { w: 8, label: 'Casi Libre (1-2/día)', desc: 'Una o dos veces al día. Chicle de nicotina para emergencias.' },
    { w: 10, label: 'Alto Total', desc: 'Cero caladas. Cada herramienta en esta app está lista para ti.' },
    { w: 12, label: 'Libertad', desc: 'Lo lograste. Lo más difícil que has hecho. Mantén y celebra.' },
  ]
};

// ===== UTILS =====
function daysBetween(a, b) {
  return Math.floor((new Date(b) - new Date(a)) / 86400000);
}
function today() { const d = new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
function currentWeek() { return daysBetween(data.startDate, today()) / 7; }

function getPhase() {
  const w = currentWeek();
  if (w < 2) return { name: 'Track', color: 'var(--accent)' };
  if (w < 4) return { name: '-25%', color: 'var(--orange)' };
  if (w < 6) return { name: '-50%', color: 'var(--orange)' };
  if (w < 8) return { name: '-75%', color: 'var(--teal)' };
  if (w < 10) return { name: '1-2/day', color: 'var(--teal)' };
  if (w < 12) return { name: 'Free!', color: 'var(--green)' };
  return { name: 'Done!', color: 'var(--green)' };
}

function getTargetPuffs() {
  const w = currentWeek();
  const b = data.baselinePuffs;
  if (w < 2) return b;
  if (w < 4) return Math.round(b * 0.75);
  if (w < 6) return Math.round(b * 0.5);
  if (w < 8) return Math.round(b * 0.25);
  if (w < 10) return Math.round(b * 0.1);
  return 0;
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== MOTIVATIONAL BANNERS =====
// motivBanners now in motivBannersI18n above

function showMotivBanner() {
  const dayIdx = daysBetween(data.startDate, today());
  const banners = motivBannersI18n[data.lang] || motivBannersI18n.en;
  const b = banners[dayIdx % banners.length];
  const name = data.userName;
  let text = b.text;
  let sub = b.sub;
  if (name) {
    const inserts = nameInsertsI18n[data.lang] || nameInsertsI18n.en;
    const insert = inserts[dayIdx % inserts.length].replace('{name}', name);
    text = insert + text.charAt(0).toLowerCase() + text.slice(1);
  }
  document.getElementById('motivText').innerHTML = text;
  document.getElementById('motivSub').textContent = sub;
}

// ===== STATS =====
function updateStats() {
  const days = Math.max(0, daysBetween(data.startDate, today()));
  document.getElementById('daysFree').textContent = days;
  const saved = days * data.costPerDay;
  const formatted = saved >= 1000 ? Math.round(saved).toLocaleString() : saved;
  document.getElementById('moneySaved').textContent = (data.currency || '$') + formatted;
  document.getElementById('cravingsBeaten').textContent = data.cravingsBeaten;
  const phase = getPhase();
  const el = document.getElementById('currentPhase');
  el.textContent = phase.name;
  el.style.color = phase.color;
}

// ===== NAV =====
function showPanel(name, btn) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  if (name === 'progress') { renderChart(); renderSetbackLog(); renderHistory(); }
}

// ===== WEEK GRID =====
function renderWeek() {
  const grid = document.getElementById('weekGrid');
  grid.innerHTML = '';
  const now = new Date();
  const dow = now.getDay();
  const mon = new Date(now);
  mon.setDate(now.getDate() - ((dow + 6) % 7));
  const names = [t('days.mon'),t('days.tue'),t('days.wed'),t('days.thu'),t('days.fri'),t('days.sat'),t('days.sun')];
  for (let i = 0; i < 7; i++) {
    const d = new Date(mon);
    d.setDate(mon.getDate() + i);
    const key = d.toISOString().split('T')[0];
    const el = document.createElement('div');
    el.className = 'week-day' + (key === today() ? ' today' : '') + (data.dailyCheckins[key] ? ' logged' : '');
    el.innerHTML = `<span class="day-name">${names[i]}</span><span class="day-num">${d.getDate()}</span>`;
    if (data.dailyCheckins[key]) el.onclick = () => showDayDetail(key);
    grid.appendChild(el);
  }
}

// ===== PUFF TRACKER =====
function renderPuffCounter() {
  const td = data.dailyCheckins[today()];
  const count = td ? (td.puffs || 0) : 0;
  document.getElementById('puffCount').textContent = count;
  const target = getTargetPuffs();
  const baseline = data.baselinePuffs || 0;
  const w = currentWeek();
  // Show baseline reference next to count
  document.getElementById('puffBaseline').textContent = baseline > 0 ? ` / ${baseline}` : '';
  if (w < 2) {
    document.getElementById('puffTarget').innerHTML = t('puff.tracking');
  } else {
    document.getElementById('puffTarget').innerHTML = t('puff.target') + `<strong>${target}${t('puff.orFewer')}</strong>` + (count <= target ? t('puff.onTrack') : '');
  }
}

function changePuffs(delta) {
  const key = today();
  if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
  data.dailyCheckins[key].puffs = Math.max(0, (data.dailyCheckins[key].puffs || 0) + delta);
  saveData(data);
  renderPuffCounter();
}

// ===== DAILY CHECKIN =====
// dailyTasks now in dailyTasksI18n above

function renderCheckin() {
  const grid = document.getElementById('checkinGrid');
  grid.innerHTML = '';
  const td = data.dailyCheckins[today()] || {};
  const dailyTasks = dailyTasksI18n[data.lang] || dailyTasksI18n.en;
  dailyTasks.forEach((task, i) => {
    const checked = td.tasks && td.tasks[i];
    const el = document.createElement('div');
    el.className = 'checkin-item' + (checked ? ' checked' : '');
    el.innerHTML = `<div class="check-circle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><span class="checkin-text">${task}</span>`;
    el.onclick = () => {
      const key = today();
      if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
      data.dailyCheckins[key].tasks[i] = !data.dailyCheckins[key].tasks[i];
      saveData(data);
      renderCheckin();
    };
    grid.appendChild(el);
  });
}

function saveDailyCheckin() {
  const key = today();
  if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
  data.dailyCheckins[key].anxiety = parseInt(document.getElementById('anxietySlider').value);
  data.dailyCheckins[key].craving = parseInt(document.getElementById('cravingSlider').value);
  saveData(data);
  renderWeek();
  updateStats();
  // Calculate baseline from first 14 days
  const entries = Object.entries(data.dailyCheckins).sort((a,b) => a[0].localeCompare(b[0]));
  if (entries.length >= 3 && currentWeek() < 2) {
    const avg = Math.round(entries.reduce((s,e) => s + (e[1].puffs || 0), 0) / entries.length);
    if (avg > 0) { data.baselinePuffs = avg; saveData(data); }
  }
  const nm = data.userName;
  showToast(nm ? t('toast.checkinSavedName') + nm + '.' : t('toast.checkinSaved'));
}

// ===== SETUP CHECKLIST =====
// setupTasks now in setupTasksI18n above

function renderSetup() {
  const grid = document.getElementById('setupChecklist');
  grid.innerHTML = '';
  const setupTasks = setupTasksI18n[data.lang] || setupTasksI18n.en;
  setupTasks.forEach((task, i) => {
    const checked = data.setupDone[i];
    const el = document.createElement('div');
    el.className = 'checkin-item' + (checked ? ' checked' : '');
    el.innerHTML = `<div class="check-circle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><span class="checkin-text">${task}</span>`;
    el.onclick = () => {
      data.setupDone[i] = !data.setupDone[i];
      saveData(data);
      renderSetup();
    };
    grid.appendChild(el);
  });
}

// ===== TRIGGER CHECKLIST =====
// triggers now in triggersI18n above

function renderTriggers() {
  const grid = document.getElementById('triggerChecklist');
  grid.innerHTML = '';
  const triggers = triggersI18n[data.lang] || triggersI18n.en;
  triggers.forEach((t, i) => {
    const checked = data.triggersDone && data.triggersDone[i];
    const el = document.createElement('div');
    el.className = 'checkin-item' + (checked ? ' checked' : '');
    el.innerHTML = `<div class="check-circle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div><span class="checkin-text">${t}</span>`;
    el.onclick = () => {
      if (!data.triggersDone) data.triggersDone = {};
      data.triggersDone[i] = !data.triggersDone[i];
      saveData(data);
      renderTriggers();
    };
    grid.appendChild(el);
  });
}

// ===== BREATHING =====
let breathInterval = null, breathPhase = 0, breathCount = 0, breathRounds = 0;
const BREATH_TARGET_ROUNDS = 4;
function getBreathPhases() { return [t('breath.in'), t('breath.hold'), t('breath.out'), t('breath.hold')]; }
const breathClasses = ['inhale', 'hold-in', 'exhale', 'hold-out'];

function toggleBreathing() {
  breathInterval ? stopBreathing() : startBreathing();
}
function startBreathing() {
  breathPhase = 0; breathCount = 4; breathRounds = 0;
  document.getElementById('breathBtn').textContent = t('breathe.stop');
  updateBreathDisplay();
  document.getElementById('breathRounds').textContent = `0 / ${BREATH_TARGET_ROUNDS}`;
  breathInterval = setInterval(() => {
    breathCount--;
    if (breathCount <= 0) {
      breathPhase = (breathPhase + 1) % 4;
      if (breathPhase === 0) {
        breathRounds++;
        document.getElementById('breathRounds').textContent = `${breathRounds} / ${BREATH_TARGET_ROUNDS}`;
        data.breathRoundsTotal++;
        saveData(data);
        if (breathRounds >= BREATH_TARGET_ROUNDS) {
          stopBreathing();
          showToast(t('toast.sessionComplete') + BREATH_TARGET_ROUNDS + t('toast.breathComplete'));
          return;
        }
      }
      breathCount = 4;
    }
    updateBreathDisplay();
  }, 1000);
}
function updateBreathDisplay() {
  const outer = document.getElementById('breathOuter');
  outer.className = 'breath-circle-outer ' + breathClasses[breathPhase];
  document.getElementById('breathCircle').className = 'breath-circle';
  const textEl = document.getElementById('breathText');
  textEl.textContent = getBreathPhases()[breathPhase];
  textEl.className = 'breath-text pulsing';
  document.getElementById('breathTimer').textContent = breathCount;
}
function stopBreathing() {
  clearInterval(breathInterval); breathInterval = null;
  document.getElementById('breathBtn').textContent = t('breathe.start');
  document.getElementById('breathOuter').className = 'breath-circle-outer';
  document.getElementById('breathCircle').className = 'breath-circle';
  const textEl = document.getElementById('breathText');
  textEl.textContent = t('breathe.ready');
  textEl.className = 'breath-text';
  document.getElementById('breathTimer').textContent = '4:4:4:4';
  if (breathRounds > 0) showToast(breathRounds + t('toast.breathSession'));
}

// ===== SOS =====
function triggerSOS() {
  const tips = document.getElementById('sosTips');
  tips.classList.toggle('visible');
  if (tips.classList.contains('visible')) {
    data.cravingsBeaten++;
    saveData(data);
    updateStats();
  }
}

// ===== JOURNAL =====
function saveJournalEntry() {
  const input = document.getElementById('journalInput');
  const text = input.value.trim();
  if (!text) return;
  data.journal.unshift({ date: new Date().toLocaleString(), text });
  saveData(data);
  input.value = '';
  renderJournal();
  showToast(t('toast.journalSaved'));
}
function renderJournal() {
  const c = document.getElementById('journalEntries');
  c.innerHTML = '';
  data.journal.forEach(e => {
    const el = document.createElement('div');
    el.className = 'journal-entry';
    el.innerHTML = `<div class="date">${e.date}</div><div class="text">${escapeHtml(e.text)}</div>`;
    c.appendChild(el);
  });
}
function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

// ===== MILESTONES =====
// milestones now in milestonesI18n above

function renderMilestones() {
  const c = document.getElementById('milestones');
  c.innerHTML = '';
  const h = daysBetween(data.startDate, today()) * 24;
  const milestones = milestonesI18n[data.lang] || milestonesI18n.en;
  milestones.forEach(m => {
    const pct = Math.min(100, (h / m.hours) * 100);
    const el = document.createElement('div');
    el.className = 'milestone';
    el.innerHTML = `<div class="milestone-bar" style="width:${pct}%"></div><div class="milestone-icon">${iconBox(m.icon)}</div><div class="milestone-info"><h4>${m.title}</h4><p>${m.desc}</p></div><div class="milestone-time">${pct >= 100 ? t('milestone.unlocked') : Math.round(pct) + '%'}</div>`;
    c.appendChild(el);
  });
}

// ===== TIMELINE =====
function renderTimeline() {
  const c = document.getElementById('progressTimeline');
  c.innerHTML = '';
  const w = currentWeek();
  const phases = timelinePhasesI18n[data.lang] || timelinePhasesI18n.en;
  phases.forEach((p, i) => {
    const status = w >= (phases[i+1]?.w ?? Infinity) ? 'completed' : (w >= p.w && (i === phases.length - 1 || w < phases[i+1].w) ? 'current' : '');
    const el = document.createElement('div');
    el.className = 'timeline-item ' + status;
    el.innerHTML = `<div class="timeline-dot">${status === 'completed' ? '✓' : (i+1)}</div><div class="timeline-content"><h4>Week ${p.w === 0 ? '1-2' : p.w + '-' + (p.w+2)} — ${p.label}</h4><p>${p.desc}</p></div>`;
    c.appendChild(el);
  });
}

// ===== CHART =====
function renderChart() {
  const canvas = document.getElementById('trendChart');
  if (!canvas || !canvas.parentElement) return;
  const ctx = canvas.getContext('2d');
  const rect = canvas.parentElement.getBoundingClientRect();
  canvas.width = rect.width - 56;
  canvas.height = 200;
  const entries = Object.entries(data.dailyCheckins).sort((a,b) => a[0].localeCompare(b[0])).slice(-14);
  if (entries.length < 2) {
    ctx.fillStyle = '#8c87a0';
    ctx.font = '14px Inter, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(t('progress.chartEmpty'), canvas.width/2, 100);
    return;
  }
  const ww = canvas.width, hh = canvas.height;
  const pad = { top: 20, bottom: 30, left: 10, right: 10 };
  const pw = ww - pad.left - pad.right, ph = hh - pad.top - pad.bottom;
  ctx.strokeStyle = 'rgba(0,0,0,0.05)';
  for (let i = 0; i <= 10; i += 2) {
    const y = pad.top + ph - (i/10) * ph;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(ww - pad.right, y); ctx.stroke();
  }
  function drawLine(vals, color) {
    ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = 2.5; ctx.lineJoin = 'round';
    vals.forEach((v, i) => {
      const x = pad.left + (i / (vals.length - 1)) * pw;
      const y = pad.top + ph - (v / 10) * ph;
      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    });
    ctx.stroke();
    vals.forEach((v, i) => {
      const x = pad.left + (i / (vals.length - 1)) * pw;
      const y = pad.top + ph - (v / 10) * ph;
      ctx.beginPath(); ctx.arc(x, y, 4, 0, Math.PI * 2); ctx.fillStyle = color; ctx.fill();
    });
  }
  drawLine(entries.map(e => e[1].craving || 5), '#db2777');
  drawLine(entries.map(e => e[1].anxiety || 5), '#16a34a');
  ctx.font = '12px Inter, sans-serif';
  ctx.fillStyle = '#db2777'; ctx.fillText(t('progress.cravings'), ww - 160, hh - 6);
  ctx.fillStyle = '#16a34a'; ctx.fillText(t('progress.anxiety'), ww - 70, hh - 6);
  ctx.fillStyle = '#8c87a0'; ctx.font = '10px Inter, sans-serif'; ctx.textAlign = 'center';
  entries.forEach((e, i) => {
    if (i % Math.ceil(entries.length / 7) === 0 || i === entries.length - 1) {
      const x = pad.left + (i / (entries.length - 1)) * pw;
      ctx.fillText(e[0].slice(5), x, hh - 6);
    }
  });
}

// ===== ACHIEVEMENTS =====
function renderAchievements() {
  const c = document.getElementById('achievements');
  c.innerHTML = '';
  const days = daysBetween(data.startDate, today());
  const checkins = Object.keys(data.dailyCheckins).length;
  const badgeTexts = badgesI18n[data.lang] || badgesI18n.en;
  const conditions = [true, days >= 1, days >= 3, days >= 7, days >= 14, days >= 30, days >= 60, days >= 84, checkins >= 7, data.cravingsBeaten >= 10, data.cravingsBeaten >= 50, data.breathRoundsTotal >= 20, data.journal.length >= 5, data.journal.length >= 20];
  const badges = badgeTexts.map((b, i) => ({ ...b, cond: conditions[i] }));
  badges.forEach(b => {
    const el = document.createElement('div');
    el.className = 'milestone';
    el.style.opacity = b.cond ? '1' : '0.3';
    el.innerHTML = `<div class="milestone-icon">${iconBox(b.icon)}</div><div class="milestone-info"><h4>${b.title}</h4><p>${b.desc}</p></div><div class="milestone-time" style="color:${b.cond ? 'var(--green)' : 'var(--text-dim)'}">${b.cond ? t('badge.earned') : t('badge.locked')}</div>`;
    c.appendChild(el);
  });
}

// ===== QUOTES =====
// quotes now in quotesI18n above

function showQuote() {
  const quotes = quotesI18n[data.lang] || quotesI18n.en;
  const idx = Math.floor(Math.random() * quotes.length);
  document.getElementById('quoteBar').innerHTML = '"' + quotes[idx] + '"';
}

// ===== SETTINGS =====
function setCurrency(symbol, code) {
  data.currency = symbol;
  data.currencyCode = code;
  document.getElementById('currencyLabel').textContent = symbol;
  document.querySelectorAll('.currency-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

function saveSettings() {
  const name = document.getElementById('userName').value.trim();
  data.userName = name;
  const weekly = parseFloat(document.getElementById('weeklySpend').value);
  if (weekly && weekly > 0) {
    data.weeklySpend = weekly;
    data.costPerDay = Math.round((weekly / 7) * 100) / 100;
  }
  const baseline = parseInt(document.getElementById('baselinePuffsInput').value);
  if (baseline && baseline > 0) {
    data.baselinePuffs = baseline;
  }
  saveData(data);
  updateStats();
  updatePersonalization();
  renderPuffCounter();
  showMotivBanner();
  showToast(name ? t('toast.settingsSavedName') + name + '.' : t('toast.settingsSaved'));
}

function loadSettings() {
  if (data.userName) document.getElementById('userName').value = data.userName;
  if (data.weeklySpend) document.getElementById('weeklySpend').value = data.weeklySpend;
  if (data.baselinePuffs) document.getElementById('baselinePuffsInput').value = data.baselinePuffs;
  document.getElementById('currencyLabel').textContent = data.currency || '$';
  document.querySelectorAll('.currency-btn:not(.lang-btn)').forEach(b => {
    if (b.textContent.includes(data.currencyCode || 'USD')) b.classList.add('active');
  });
  updatePersonalization();
  applyLanguage();
}

function updatePersonalization() {
  const name = data.userName;
  const headerSub = document.querySelector('.header p');
  if (name) {
    headerSub.textContent = name + t('app.subtitle.name');
  } else {
    headerSub.textContent = t('app.subtitle');
  }
}

// ===== LANGUAGE =====
function setLanguage(lang) {
  data.lang = lang;
  saveData(data);
  applyLanguage();
}

function applyLanguage() {
  document.documentElement.lang = data.lang;
  // Update data-i18n elements (plain text)
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  // Update data-i18n-html elements (rich text with <strong> etc)
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    el.innerHTML = t(el.dataset.i18nHtml);
  });
  // Update placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.dataset.i18nPlaceholder);
  });
  // Highlight active language button
  document.querySelectorAll('.lang-btn').forEach(b => {
    b.classList.toggle('active', (b.textContent === 'English' && data.lang === 'en') || (b.textContent === 'Español' && data.lang === 'es'));
  });
  // Re-render all dynamic content
  showMotivBanner();
  updateStats();
  renderWeek();
  renderPuffCounter();
  renderCheckin();
  renderSetup();
  renderTriggers();
  renderMilestones();
  renderTimeline();
  renderAchievements();
  renderChart();
  updatePersonalization();
  showQuote();
}

// ===== RESET =====
function resetApp() {
  if (confirm(t('toast.resetConfirm1'))) {
    if (confirm(t('toast.resetConfirm2'))) {
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    }
  }
}

// ===== INIT =====
function init() {
  showMotivBanner();
  updateStats();
  renderWeek();
  renderPuffCounter();
  renderCheckin();
  renderSetup();
  renderTriggers();
  renderMilestones();
  renderTimeline();
  renderJournal();
  renderAchievements();
  loadSettings();
  showQuote();
  const td = data.dailyCheckins[today()];
  if (td) {
    document.getElementById('anxietySlider').value = td.anxiety || 5;
    document.getElementById('anxietyVal').textContent = td.anxiety || 5;
    document.getElementById('cravingSlider').value = td.craving || 5;
    document.getElementById('cravingVal').textContent = td.craving || 5;
  }
  loadSetbackState();
  checkBackupReminder();
}
init();
window.addEventListener('resize', renderChart);

// ===== DAY DETAIL MODAL =====
function showDayDetail(dateStr) {
  const d = data.dailyCheckins[dateStr];
  if (!d) return;
  const taskLabels = [
    'No vaping first 30 min after waking',
    'Delayed a craving at least once',
    'Drank enough water today',
    'Did a breathing exercise',
    'Avoided main trigger situation',
    'Logged my puff count',
    'Showed up for myself today'
  ];
  const tasksDone = Object.values(d.tasks || {}).filter(Boolean).length;
  let html = '<div class="day-modal-date">' + formatDate(dateStr) + '</div>';
  html += '<div class="day-modal-stats">';
  html += '<div class="day-modal-stat"><div class="label">Puffs</div><div class="value">' + (d.puffs || 0) + '</div></div>';
  html += '<div class="day-modal-stat"><div class="label">Tasks</div><div class="value">' + tasksDone + '/7</div></div>';
  html += '<div class="day-modal-stat"><div class="label">Anxiety</div><div class="value">' + (d.anxiety || '—') + '</div></div>';
  html += '<div class="day-modal-stat"><div class="label">Craving</div><div class="value">' + (d.craving || '—') + '</div></div>';
  html += '</div>';
  if (taskLabels.length > 0) {
    html += '<div class="day-modal-tasks"><h4>Daily Tasks</h4>';
    taskLabels.forEach((label, i) => {
      const done = d.tasks && d.tasks[i];
      html += '<div class="day-modal-task-row"><span class="tick ' + (done ? 'done' : 'skip') + '">' + (done ? '✓' : '–') + '</span>' + label + '</div>';
    });
    html += '</div>';
  }
  if (d.setback) {
    html += '<div class="day-modal-setback"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:6px;color:var(--green)"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>Setback logged' + (d.setbackNote ? '<p>"' + d.setbackNote + '"</p>' : '') + '</div>';
  }
  document.getElementById('dayModalContent').innerHTML = html;
  document.getElementById('dayModal').style.display = 'flex';
}

function closeDayModal(e) {
  if (!e || e.target === document.getElementById('dayModal')) {
    document.getElementById('dayModal').style.display = 'none';
  }
}

// ===== SETBACKS =====
const setbackAffirmations = [
  "You reached out instead of giving up. That's courage.",
  "One hard day doesn't undo everything you've built.",
  "Every person who has ever quit had days like this. You are not alone.",
  "Logging this takes honesty. That honesty is what recovery is made of.",
  "Tomorrow is a fresh start. You're still in this.",
  "The fact that you're logging this means you haven't given up.",
  "Progress isn't a straight line — it never has been for anyone.",
  "You noticed. You logged it. That awareness is already the next step forward."
];

function toggleSetbackForm(checked) {
  const form = document.getElementById('setbackForm');
  const affirmEl = document.getElementById('setbackAffirmation');
  if (checked) {
    form.style.display = 'block';
    const idx = Math.floor(Math.random() * setbackAffirmations.length);
    affirmEl.textContent = setbackAffirmations[idx];
  } else {
    form.style.display = 'none';
    affirmEl.textContent = '';
  }
}

function saveSetback() {
  const key = today();
  if (!data.dailyCheckins[key]) data.dailyCheckins[key] = { tasks: {}, anxiety: 5, craving: 5, puffs: 0 };
  data.dailyCheckins[key].setback = true;
  data.dailyCheckins[key].setbackNote = document.getElementById('setbackNote').value.trim();
  saveData(data);
  showToast('Setback logged. You showed up anyway — that matters.');
}

function loadSetbackState() {
  const td = data.dailyCheckins[today()];
  if (td && td.setback) {
    document.getElementById('setbackToggle').checked = true;
    document.getElementById('setbackForm').style.display = 'block';
    document.getElementById('setbackNote').value = td.setbackNote || '';
    const idx = Math.floor(Math.random() * setbackAffirmations.length);
    document.getElementById('setbackAffirmation').textContent = setbackAffirmations[idx];
  }
}

// ===== SETBACK LOG =====
function renderSetbackLog() {
  const c = document.getElementById('setbackLog');
  if (!c) return;
  const setbacks = Object.entries(data.dailyCheckins)
    .filter(([, d]) => d.setback)
    .sort((a, b) => b[0].localeCompare(a[0]));
  if (setbacks.length === 0) {
    c.innerHTML = '<p class="history-empty">No setbacks logged yet — keep going! 💪</p>';
    return;
  }
  c.innerHTML = '';
  setbacks.forEach(([date, d]) => {
    const el = document.createElement('div');
    el.className = 'setback-entry';
    el.innerHTML =
      '<div class="setback-entry-date">' + formatDate(date) + '</div>' +
      '<div class="setback-entry-puffs">' + (d.puffs || 0) + ' puffs that day</div>' +
      (d.setbackNote ? '<p class="setback-entry-note">"' + d.setbackNote + '"</p>' : '');
    c.appendChild(el);
  });
}

// ===== DAILY HISTORY =====
function renderHistory() {
  const c = document.getElementById('historyLog');
  if (!c) return;
  const entries = Object.entries(data.dailyCheckins)
    .sort((a, b) => b[0].localeCompare(a[0]));
  if (entries.length === 0) {
    c.innerHTML = '<p class="history-empty">No check-ins yet — start tracking today!</p>';
    return;
  }
  c.innerHTML = '';
  entries.forEach(([date, d]) => {
    const tasksDone = Object.values(d.tasks || {}).filter(Boolean).length;
    const el = document.createElement('div');
    el.className = 'history-entry' + (d.setback ? ' setback-day' : '');
    el.innerHTML =
      '<div class="history-date-header">' +
        formatDate(date) +
        (d.setback ? ' <span class="setback-badge">setback</span>' : '') +
      '</div>' +
      '<div class="history-stats">' +
        '<div class="history-stat"><span class="stat-label">Puffs</span><span class="stat-val">' + (d.puffs || 0) + '</span></div>' +
        '<div class="history-stat"><span class="stat-label">Anxiety</span><span class="stat-val">' + (d.anxiety || '—') + '</span></div>' +
        '<div class="history-stat"><span class="stat-label">Craving</span><span class="stat-val">' + (d.craving || '—') + '</span></div>' +
        '<div class="history-stat"><span class="stat-label">Tasks</span><span class="stat-val">' + tasksDone + '/7</span></div>' +
      '</div>' +
      (d.setbackNote ? '<p class="history-note">"' + d.setbackNote + '"</p>' : '');
    c.appendChild(el);
  });
}

function formatDate(dateStr) {
  const d = new Date(dateStr + 'T12:00:00');
  return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
}

// ===== BACKUP & RESTORE =====
function exportData() {
  data.lastBackup = Date.now();
  saveData(data);
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `breathefreely-backup-${today()}.json`;
  a.click();
  URL.revokeObjectURL(url);
  document.getElementById('backupBanner').style.display = 'none';
  showToast('Backup downloaded! Keep that file safe.');
}
function exportDataFromBanner() { exportData(); }
function dismissBackupBanner() {
  data.lastBackupDismissed = Date.now();
  saveData(data);
  document.getElementById('backupBanner').style.display = 'none';
}
function checkBackupReminder() {
  const checkinCount = Object.keys(data.dailyCheckins || {}).length;
  if (checkinCount < 1) return;
  const now = Date.now();
  const threeDays = 3 * 24 * 60 * 60 * 1000;
  const lastBackup = data.lastBackup || 0;
  const lastDismissed = data.lastBackupDismissed || 0;
  const sinceBackup = now - lastBackup;
  const sinceDismissed = now - lastDismissed;
  if (sinceBackup > threeDays && sinceDismissed > threeDays) {
    document.getElementById('backupBanner').style.display = 'flex';
  }
}

function importData(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const imported = JSON.parse(e.target.result);
      if (!imported.startDate || !imported.dailyCheckins) {
        showToast('That file doesn\'t look like a BreatheFreely backup.');
        return;
      }
      localStorage.setItem(STORAGE_KEY, JSON.stringify(imported));
      showToast('Data restored! Reloading...');
      setTimeout(() => location.reload(), 1500);
    } catch {
      showToast('Could not read that file. Make sure it\'s a BreatheFreely backup.');
    }
  };
  reader.readAsText(file);
  input.value = '';
}

// Register service worker for offline/PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(() => {});
}
</script>
</body>
</html>
